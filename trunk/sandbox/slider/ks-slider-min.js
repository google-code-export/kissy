KISSY.add("slider",function(d){var h=YAHOO.util,f=h.Dom,b=h.Event,g=YAHOO.lang;var a={triggersClass:"triggers",currentClass:"current",eventType:"mouse",effect:"none",delay:5000,speed:500,autoPlay:true,startAt:0,direction:"vertical"};var c={none:function(){var j=this,i=j.config;j.scroller[j.direction.x?"scrollLeft":"scrollTop"]=j.next*j.switchSize},fade:function(){var k=this,j=k.config,i=k.panels,m=f.setStyle,n=i[k.current]||i[0],l=i[k.next]||i[i.length-1];if(!this._initFade){m(i,"position","absolute");m(i,"top",j.slideOffsetY||0);m(i,"left",j.slideOffsetX||0);m(i,"z-index",1);m(i,"display","none");this.initFade=true}if(this._anim&&this._fading){this._anim.stop();m(i,"display","none")}this._fading=true;m(n,"z-index",2);m(l,"z-index",1);m(l,"opacity",1);m([n,l],"display","");this._anim=new YAHOO.util.Anim(n,{opacity:{from:1,to:0}},j.speed/1000||0.5,j.easing||h.Easing.easeNone);this._anim.onComplete.subscribe(function(){m(n,"display","none");m([n,l],"z-index",1);this._fading=false},k,true);this._anim.animate()},scroll:function(){var k=this,j=k.config,i={scroll:{to:[]}};i.scroll.to[k.direction.x?0:1]=k.next*k.switchSize;if(this._anim){this._anim.stop()}this._anim=new h.Scroll(this.scroller,i,j.speed/1000||0.5,j.easing||h.Easing.easeOutStrong);this._anim.animate()}};var e=function(i,j){this.container=f.get(i);this.config=g.merge(a,j||{});this._init()};d.mix(e.prototype,{_init:function(){var l=this.config,k=this.container,x;var w={x:(l.direction=="horizontal")||(l.direction=="h"),y:(l.direction=="vertical")||(l.direction=="v")};var t=l.panels||g.merge([],k.getElementsByTagName("li"));var v=t.length;var n=parseInt(this.config.switchSize,10);if(!n){n=t[0][w.x?"clientWidth":"clientHeight"]}var q=l.scroller||t[0].parentNode;var u=l.triggers;if(!u){var u=document.createElement("ul");f.addClass(u,l.triggersClass);for(var p=0;p<v;){var o=document.createElement("li");o.innerHTML=++p;u.appendChild(o)}k.appendChild(u);u=g.merge([],u.getElementsByTagName("li"))}var s=g.isNumber(l.startAt)?l.startAt:0;if(g.isFunction(l.effect)){x=l.effect}else{if(g.isString(l.effect)&&g.isFunction(c[l.effect])){x=c[l.effect]}else{x=x.none}}this.effect=new h.CustomEvent("effect",this,false,h.CustomEvent.FLAT);this.effect.subscribe(x);if(g.isFunction(l.onSwitch)){this.onSwitchEvent=new h.CustomEvent("onSwitchEvent",this,false,h.CustomEvent.FLAT);this.onSwitchEvent.subscribe(l.onSwitch)}b.on(k,"mouseover",function(i){this.sleep()},this,true);b.on(k,"mouseout",function(i){if(l.autoPlay){this.wakeup()}},this,true);for(var p=0,r=u.length,m,j=YAHOO.env.ie;p<r;p++){(function(i){switch(l.eventType.toLowerCase()){case"mouse":b.on(u[i],j?"mouseenter":"mouseover",function(y){if(m){m.cancel()}m=g.later(200,this,function(){this.switchTo(i)})},this,true);b.on(u[i],j?"mouseleave":"mouseout",function(y){if(m){m.cancel()}if(l.autoPlay){this.wakeup()}},this,true);break;default:b.on(u[i],"click",function(y){b.stopEvent(y);if(m){m.cancel()}m=g.later(50,this,function(){this.switchTo(i)})},this,true)}}).call(this,p)}f.addClass(u[s],l.currentClass);q.scrollTop=n*s;q.scrollLeft=n*s;if(l.autoPlay&&v>1){this.pause=false;g.later(l.delay,this,function(){this.switchTo(s+1)})}this.direction=w;this.panels=t;this.switchSize=n;this.scroller=q;this.triggers=u;this.current=s;this.total=v},switchTo:function(j){var i=this.config,k=this;if(k.pause&&!g.isNumber(j)){return}if(this.timer){this.timer.cancel()}this.next=g.isNumber(j)?j:k.current+1;if(this.next>=k.total){this.next=g.isNumber(i.startAt)?i.startAt:0}k.effect.fire();this.current=this.next;if(g.isObject(k.onSwitchEvent)&&k.onSwitchEvent.fire){this.onSwitchEvent.fire()}f.removeClass(k.triggers,i.currentClass);f.addClass(k.triggers[this.current],i.currentClass);if(i.autoPlay){this.timer=g.later(i.delay,this,arguments.callee)}},sleep:function(){this.pause=true;if(this.timer){this.timer.cancel()}},wakeup:function(){if(this.timer){this.timer.cancel()}this.pause=false;this.timer=g.later(this.config.delay,this,function(){this.switchTo(this.current+1)})}});d.Slider=e});
