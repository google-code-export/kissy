KISSY.add("scrollview",function(c){var a=YAHOO.util,e=a.Dom,j=a.Event,g=YAHOO.lang;var d={delay:2000,speed:1000,startDelay:2000,autoStart:true,direction:"vertical",scrollWidth:false,scrollSize:1};function h(p){var m=e.get(p),n=m.offsetLeft,k=m.offsetTop,l=m.offsetParent;while(l){n+=l.offsetLeft;k+=l.offsetTop;l=l.offsetParent}return{top:k,left:n}}var i=function(n,l,o){var m=e[(o=="prev")?"getPreviousSibling":"getNextSibling"];for(var k=0;k<l;k++){n=m(n);if(!n){return false}}return n};var f=function(k,m,n){n=(n=="prev")?"prev":"next";switch(n){case"prev":for(var l=0;l<m;l++){e.insertBefore(e.getLastChild(k),e.getFirstChild(k))}break;default:for(var l=0;l<m;l++){e.insertAfter(e.getFirstChild(k),e.getLastChild(k))}}};var b=function(l,m){this.config=g.merge(d,m||{});this.container=e.get(l);this.horses=this.container.getElementsByTagName("li");this.pointer=this.horses[0];this.total=this.horses.length;if(this.total<this.config.scrollSize){return}this.current=e.getAttribute(this.pointer,"carousel:index");for(var n=0,k=this.total;n<k;){e.setAttribute(this.horses[n],"carousel:index",n++)}this.direction={x:(this.config.direction=="horizontal")||(this.config.direction=="h"),y:(this.config.direction=="vertical")||(this.config.direction=="v")};this._init()};c.mix(b.prototype,{_init:function(){var n=this.config,m=this.container;var p=["onScroll","onPause","onBeforeScroll","onPause","onWakeup"];for(var o=0,k=p.length;o<k;o++){var l=p[o];if(g.isFunction(n[l])){this[l+"Event"]=new a.CustomEvent(l,this,false,a.CustomEvent.FLAT);this[l+"Event"].subscribe(n[l])}}j.on(m,"mouseover",function(){if(n.autoStart){this.pause()}},this,true);j.on(m,"mouseout",function(){if(n.autoStart){this.wakeup()}},this,true);if(n.autoStart){g.later(n.startDelay,this,function(){this.play()})}},play:function(u){var r=this,l=this.container,k=this.pointer,m=this.config,s=arguments.callee,o;u=(u=="prev")?"prev":"next";if(this._scrolling||this.paused){return}var t=i(k,m.scrollSize,u);if(!t){f(k.parentNode,m.scrollSize,u);t=i(k,m.scrollSize,u)}if(g.isNumber(m.scrollWidth)){var n=m.scrollWidth*m.scrollSize}var w=h(k),p=h(l),q=h(t);if(this.direction.y){var v=w.top-p.top;o={scroll:{from:[,v]}};if(n){o.scroll.to=[,v+(n*(u=="next"?1:-1))]}else{o.scroll.to=[,t.offsetTop-l.offsetTop]}}else{var v=w.left-p.left;o={scroll:{from:[v]}};if(n){o.scroll.to=[v+(n*(u=="next"?1:-1))]}else{o.scroll.to=[q.left-p.left]}}this.pointer=t;this.current=e.getAttribute(this.pointer,"carousel:index");if(g.isObject(this.onBeforeScrollEvent)){this.onBeforeScrollEvent.fire()}this._scrolling=true;if(this.anim){this.anim.stop()}this.anim=new a.Scroll(l,o,m.speed/1000,m.easing||a.Easing.easeOut);this.anim.onComplete.subscribe(function(){this._scrolling=false;if(g.isObject(this.onScrollEvent)){this.onScrollEvent.fire()}if(!this.paused&&m.autoStart){this.timer=g.later(m.delay,r,s)}},this,true);this.anim.animate()},pause:function(){this.paused=true;if(this._wakeupTimer){this._wakeupTimer.cancel()}if(g.isObject(this.onPauseEvent)){this.onPauseEvent.fire()}},wakeup:function(){this.paused=false;if(this._wakeupTimer){this._wakeupTimer.cancel()}if(g.isObject(this.onWakeupEvent)){this.onWakeupEvent.fire()}this._wakeupTimer=g.later(0,this,function(){this.timer=g.later(this.config.delay,this,this.play)})},jumpTo:function(p,t){var s=this,k=this.pointer,l=this.config;if(g.isUndefined(t)&&g.isNumber(this._prevIndex)){t=p>this._prevIndex?"next":"prev"}t=(t=="prev")?"prev":"next";var m=(t=="prev")?"next":"prev";if(p>this.total){return}for(var o=0,q=this.total,r=false;o<q;o++){var n=e.getAttribute(this.horses[o],"carousel:index");if(n==p){r=this.horses[o];break}}if(!r){return}this.pointer=i(r,l.scrollSize,m);if(!this.pointer){f(k.parentNode,l.scrollSize,t);this.pointer=i(r,l.scrollSize,m)}this._prevIndex=p;this.play(t)},next:function(){this.play("next")},prev:function(){this.play("prev")}});c.ScrollView=b});