/*
Copyright (c) 2009, Kissy UI Library. All rights reserved.
MIT Licensed.
http://kissy.googlecode.com/

Date: 2009-12-25 17:10:12
Revision: 359
*/
KISSY.add("megamenu",function(f){var c=YAHOO.util,g=c.Dom,k=c.Event,h=YAHOO.lang,j="none",a="block",b='<span class="{hook_cls}"></span>',e="ks-megamenu-",d={triggerType:"mouse",triggerDelay:0.1,hideDelay:0.5,triggerCls:e+"trigger",viewCls:e+"view",contentCls:e+"content",activeTriggerCls:e+"trigger-active",closeBtnCls:e+"closebtn",showCloseBtn:true};function i(m,o){var n=this,l=f.merge(d,o||{});if(!(n instanceof arguments.callee)){return new arguments.callee(m,o)}n.container=g.get(m);n.config=l;n.triggers=g.getElementsByClassName(l.triggerCls,"*",m);n.contents=[];g.getElementsByClassName(l.contentCls,"*",m,function(p){n.contents.push(p.value||p.innerHTML)});n.panels=n.contents;n.activeIndex=-1;n._init()}f.mix(i.prototype,{_init:function(){var l=this;l._initTriggers();l._initView();if(l.config.showCloseBtn){l._initCloseBtn()}},_onFocusTrigger:function(m){var l=this;if(l.activeIndex===m){return}if(l.showTimer){l.showTimer.cancel()}if(l.hideTimer){l.hideTimer.cancel()}l.switchTo(m)},_onMouseEnterTrigger:function(m){var l=this;if(l.hideTimer){l.hideTimer.cancel()}l.showTimer=h.later(l.config.triggerDelay*1000,l,function(){l.switchTo(m)})},_onMouseLeaveTrigger:function(){var l=this;if(l.showTimer){l.showTimer.cancel()}l.hideTimer=h.later(l.config.hideDelay*1000,l,function(){l.hide()})},_initView:function(){var n=this,m=n.config,l=g.getElementsByClassName(m.viewCls,"*",n.container)[0];if(!l){l=document.createElement("DIV");l.className=m.viewCls;n.container.appendChild(l)}k.on(l,"mouseenter",function(){if(n.hideTimer){n.hideTimer.cancel()}});k.on(l,"mouseleave",function(){n.hideTimer=h.later(m.hideDelay*1000,n,"hide")});n.viewContent=l;n.view=l},_initCloseBtn:function(){var m=this,n,l=m.view;l.innerHTML=b.replace("{hook_cls}",m.config.closeBtnCls);k.on(l.firstChild,"click",function(){m.hide()});n=document.createElement("div");l.appendChild(n);m.viewContent=n},_switchContent:function(o,l,n){var m=this;m.view.style.display=a;m.viewContent.innerHTML=l;m.fireEvent("onSwitch",n)},hide:function(){var l=this;g.removeClass(l.triggers[l.activeIndex],l.config.activeTriggerCls);l.view.style.display=j;l.activeIndex=-1}});f.augment(i,f.Triggerable,false);f.MegaMenu=i});
