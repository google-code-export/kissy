/*
Copyright (c) 2009, Kissy UI Library. All rights reserved.
MIT Licensed.
http://kissy.googlecode.com/

Date: 2009-12-29 17:38:45
Revision: 373
*/
KISSY.add("megamenu",function(g){var c=YAHOO.util,h=c.Dom,m=c.Event,j=YAHOO.lang,l="none",a="block",b='<span class="{hook_cls}"></span>',i="switchable",f="ks-megamenu-",e={hideDelay:0.5,viewCls:f+"view",closeBtnCls:f+"closebtn",showCloseBtn:true};function k(n,p){var o=this;if(!(o instanceof arguments.callee)){return new arguments.callee(n,p)}k.superclass.constructor.call(o,n);o.config=g.merge(e,p||{});o.switchable(p);g.mix(o.config,o.config[i]);o.activeIndex=-1;g.mix(o,d);o._init()}g.extend(k,g.Widget);var d={_init:function(){var n=this;n._initView();if(n.config.showCloseBtn){n._initCloseBtn()}},_onFocusTrigger:function(o){var n=this;if(n.activeIndex===o){return}if(n.switchTimer){n.switchTimer.cancel()}if(n.hideTimer){n.hideTimer.cancel()}n.switchTo(o)},_onMouseEnterTrigger:function(o){var n=this;if(n.hideTimer){n.hideTimer.cancel()}n.switchTimer=j.later(n.config.delay*1000,n,function(){n.switchTo(o)})},_onMouseLeaveTrigger:function(){var n=this;if(n.switchTimer){n.switchTimer.cancel()}n.hideTimer=j.later(n.config.hideDelay*1000,n,function(){n.hide()})},_initView:function(){var p=this,o=p.config,n=h.getElementsByClassName(o.viewCls,"*",p.container)[0];if(!n){n=document.createElement("DIV");n.className=o.viewCls;p.container.appendChild(n)}m.on(n,"mouseenter",function(){if(p.hideTimer){p.hideTimer.cancel()}});m.on(n,"mouseleave",function(){p.hideTimer=j.later(o.hideDelay*1000,p,"hide")});p.viewContent=n;p.view=n},_initCloseBtn:function(){var o=this,p,n=o.view;n.innerHTML=b.replace("{hook_cls}",o.config.closeBtnCls);m.on(n.firstChild,"click",function(){o.hide()});p=document.createElement("div");n.appendChild(p);o.viewContent=p},_switchView:function(n,o,q){var p=this;p.view.style.display=a;p.viewContent.innerHTML=o[0].innerHTML;p.fireEvent("onSwitch",q)},hide:function(){var n=this;h.removeClass(n.triggers[n.activeIndex],n.config.activeTriggerCls);n.view.style.display=l;n.activeIndex=-1}};g.MegaMenu=k});
