/*
Copyright (c) 2009, Kissy UI Library. All rights reserved.
MIT Licensed.
http://kissy.googlecode.com/

Date: 2009-12-25 18:42:50
Revision: 362
*/
KISSY.add("datalazyload",function(f){var b=YAHOO.util,g=b.Dom,n=b.Event,j=YAHOO.lang,k=window,m=document,a="data-lazyload-src",l="ks-datalazyload",i="ks-datalazyload-custom",d={AUTO:"auto",MANUAL:"manual"},h="default",e={mod:d.MANUAL,diff:h,placeholder:"http://a.tbcdn.cn/kissy/1.0.2/build/datalazyload/dot.gif"};function c(q,p){var o=this;if(!(o instanceof arguments.callee)){return new arguments.callee(q,p)}if(typeof p==="undefined"){p=q;q=[m]}if(!j.isArray(q)){q=[g.get(q)||m]}o.containers=q;o.config=f.merge(e,p||{});o.callbacks={els:[],fns:[]};o._init()}f.mix(c.prototype,{_init:function(){var o=this;o.threshold=o._getThreshold();o._filterItems();if(o._getItemsLength()){o._initLoadEvent()}},_initLoadEvent:function(){var r,q=this;n.on(k,"scroll",o);n.on(k,"resize",function(){q.threshold=q._getThreshold();o()});if(q._getItemsLength()){n.onDOMReady(function(){p()})}function o(){if(r){return}r=setTimeout(function(){p();r=null},100)}function p(){q._loadItems();if(q._getItemsLength()===0){n.removeListener(k,"scroll",o);n.removeListener(k,"resize",o)}}},_filterItems:function(){var A=this,p=A.containers,v=A.threshold,z=A.config.placeholder,q=A.config.mod===d.MANUAL,o,x,u,t,s,w,r,C,B=[],y=[];for(o=0,x=p.length;o<x;++o){u=p[o].getElementsByTagName("img");for(s=0,w=u.length;s<w;++s){r=u[s];C=r.getAttribute(a);if(q){if(C){r.src=z;B.push(r)}}else{if(g.getY(r)>v&&!C){r.setAttribute(a,r.src);r.src=z;B.push(r)}}}t=p[o].getElementsByTagName("textarea");for(s=0,w=t.length;s<w;++s){if(g.hasClass(t[s],l)){y.push(t[s])}}}A.images=B;A.areaes=y},_loadItems:function(){var o=this;o._loadImgs();o._loadAreaes();o._fireCallbacks()},_loadImgs:function(){var q=this,v=q.images,s=g.getDocumentScrollTop(),o=q.threshold+s,r,p,u,t=[];for(r=0;p=v[r++];){if(g.getY(p)<=o){u=p.getAttribute(a);if(u&&p.src!=u){p.src=u;p.removeAttribute(a)}}else{t.push(p)}}q.images=t},_loadAreaes:function(){var p=this,t=p.areaes,u=g.getDocumentScrollTop(),o=p.threshold+u,q,s,r,v=[];for(q=0;s=t[q++];){r=s.parentNode;if(g.getY(r)<=o){r.innerHTML=s.value}else{v.push(s)}}p.areaes=v},_fireCallbacks:function(){var y=this,u=y.callbacks,r=u.els,x=u.fns,o=g.getDocumentScrollTop(),t=y.threshold+o,s,p,w,v=[],q=[];for(s=0;(p=r[s])&&(w=x[s++]);){if(g.getY(p)<=t){w.call(p)}else{v.push(p);q.push(w)}}u.els=v;u.fns=q},addCallback:function(p,o){p=g.get(p);if(p&&typeof o==="function"){this.callbacks.els.push(p);this.callbacks.fns.push(o)}},_getThreshold:function(){var p=this.config.diff,o=g.getViewportHeight();if(p===h){return 2*o}else{return o+p}},_getItemsLength:function(){var o=this;return o.images.length+o.areaes.length+o.callbacks.els.length},loadCustomLazyData:function(p){var o=p.getElementsByTagName("textarea")[0];if(o&&g.hasClass(o,i)){p.innerHTML=o.value}}});f.DataLazyload=c});KISSY.add("triggerable",function(d){var h=YAHOO.util,e=h.Dom,b=h.Event,f=YAHOO.lang,c="beforeSwitch",a="onSwitch";function g(){}d.mix(g.prototype,{_initTriggers:function(){var i=this;i.createEvent(c);i.createEvent(a);i._bindTriggers()},_bindTriggers:function(){var l=this,k=l.config,o=l.triggers,n,j=o.length,m;for(n=0;n<j;n++){(function(i){m=o[i];b.on(m,"click",function(){l._onFocusTrigger(i)});b.on(m,"focus",function(){l._onFocusTrigger(i)});if(k.triggerType==="mouse"){b.on(m,"mouseenter",function(){l._onMouseEnterTrigger(i)});b.on(m,"mouseleave",function(){l._onMouseLeaveTrigger(i)})}})(n)}},_onFocusTrigger:function(j){var i=this;if(i.activeIndex===j){return}if(i.showTimer){i.showTimer.cancel()}i.switchTo(j)},_onMouseEnterTrigger:function(j){var i=this;if(i.activeIndex!==j){i.showTimer=f.later(i.config.triggerDelay*1000,i,function(){i.switchTo(j)})}},_onMouseLeaveTrigger:function(){var i=this;if(i.showTimer){i.showTimer.cancel()}},switchTo:function(n){var k=this,j=k.config,i=k.activeIndex,o=k.triggers,m=k.panels,l=m[k.activeIndex],p=m[n];if(!k.fireEvent(c,n)){return k}if(i>=0){e.removeClass(o[i],j.activeTriggerCls)}e.addClass(o[n],j.activeTriggerCls);if(k.loadCustomLazyData&&p.nodeType===1){k.loadCustomLazyData(p)}k._switchContent(l,p,n);k.activeIndex=n;return k},_switchContent:function(k,l,j){var i=this;k.style.display="none";l.style.display="block";i.fireEvent(a,j)}});d.augment(g,h.EventProvider);if(d.DataLazyload){d.augment(g,d.DataLazyload,true,["loadCustomLazyData"])}d.Triggerable=g});KISSY.add("tabview",function(d){var g=YAHOO.util,e=g.Dom,f=YAHOO.lang,c="ks-tabview-",a={mackupType:0,navCls:c+"nav",contentCls:c+"content",triggerCls:c+"trigger",panelCls:c+"panel",triggers:[],panels:[],triggerType:"mouse",triggerDelay:0.1,activeIndex:0,activeTriggerCls:c+"trigger-active"};function b(j,l){var k=this;if(f.isArray(j)){for(var n=[],m=0,h=j.length;m<h;m++){n[n.length]=new arguments.callee(j[m],l)}return n}if(!(k instanceof arguments.callee)){return new arguments.callee(j,l)}k.container=e.get(j);if(l.triggerCls){a.mackupType=1}else{if(l.triggers){a.mackupType=2}}k.config=d.merge(a,l||{});k.triggers=[];k.panels=[];k.activeIndex=k.config.activeIndex;k._init()}d.mix(b.prototype,{_init:function(){this._parseMackup();this._initTriggers()},_parseMackup:function(){var v=this,j=v.container,q=v.config,h,r,t=[],s=[],k,l,o,p,u=e.getElementsByClassName;switch(q.mackupType){case 0:h=u(q.navCls,"*",j)[0];r=u(q.contentCls,"*",j)[0];t=e.getChildren(h);s=e.getChildren(r);break;case 1:t=u(q.triggerCls,"*",j);s=u(q.panelCls,"*",j);break;case 2:t=q.triggers;s=q.panels;break}k=t.length;l=s.length;for(o=0,p=k>l?l:k;o<p;o++){v.triggers.push(t[o]);v.panels.push(s[o])}}});d.augment(b,d.Triggerable,false);d.TabView=b});KISSY.add("slideview",function(i){var f=YAHOO.util,e=f.Dom,r=f.Event,h=YAHOO.lang,q="block",k="none",n="opacity",g="z-index",o="relative",p="absolute",d="scrollx",b="scrolly",c="fade",a="ks-slideview-",l={navCls:a+"nav",contentCls:a+"content",triggerType:"mouse",triggerDelay:0.1,autoPlay:true,autoPlayInterval:5,pauseOnMouseOver:true,effectType:k,animDuration:0.5,animEasing:f.Easing.easeNone,activeIndex:0,activeTriggerCls:a+"trigger-active",panelSize:[]},m={none:function(s,t,u){s.style.display=k;t.style.display=q;u()},fade:function(u,v,w){var t=this,s=t.config;if(t.anim){t.anim.stop()}e.setStyle(v,n,1);t.anim=new f.Anim(u,{opacity:{to:0}},s.animDuration,s.animEasing);t.anim.onComplete.subscribe(function(){t.anim=null;e.setStyle(v,g,9);e.setStyle(u,g,1);w()});t.anim.animate()},scroll:function(s,x,y,u){var z=this,v=z.config,A=v.effectType===d,w=z.panelSize[A?0:1]*u,t={};t[A?"left":"top"]={to:-w};if(z.anim){z.anim.stop()}z.anim=new f.Anim(z.content,t,v.animDuration,v.animEasing);z.anim.onComplete.subscribe(function(){z.anim=null;y()});z.anim.animate()}};m[d]=m[b]=m.scroll;function j(s,u){var t=this;u=u||{};if(!(t instanceof arguments.callee)){return new arguments.callee(s,u)}t.container=e.get(s);if(u.effectType===d||u.effectType===b){l.animDuration=0.8;l.animEasing=f.Easing.easeOutStrong}t.config=i.merge(l,u||{});t.triggers=[];t.panels=[];t.panelSize=[];t.activeIndex=t.config.activeIndex;t._init()}i.mix(j.prototype,{_init:function(){var t=this,s=t.config;t._parseMackup();t._initStyle();t._initTriggers();if(s.autoPlay){t._initAutoPlay()}},_parseMackup:function(){var D=this,t=D.container,y=D.config,s,z,B=[],A=[],u,v,w,x,C=e.getElementsByClassName;z=C(y.contentCls,"*",t)[0];A=e.getChildren(z);s=C(y.navCls,"*",t)[0]||D._generateNavMackup(A.length);B=e.getChildren(s);u=B.length;v=A.length;for(w=0,x=u>v?v:u;w<x;w++){D.triggers.push(B[w]);D.panels.push(A[w])}D.nav=s;D.content=z},_generateNavMackup:function(t){var v=this,u=v.config,x=document.createElement("UL"),s,w;x.className=u.navCls;for(w=0;w<t;w++){s=document.createElement("LI");if(w===v.activeIndex){s.className=u.activeTriggerCls}s.innerHTML=w+1;x.appendChild(s)}v.container.appendChild(x);return x},_initStyle:function(){var v=this,u=v.config,y=u.effectType,w=v.panels,x,t=v.triggers.length,s=v.activeIndex;v.panelSize[0]=u.panelSize[0]||w[0].offsetWidth;v.panelSize[1]=u.panelSize[0]||w[0].offsetHeight;if(y===k){for(x=0;x<t;x++){w[x].style.display=x===s?q:k}}else{for(x=0;x<t;x++){w[x].style.display=q}switch(y){case d:case b:v.container.style.position=o;v.content.style.position=p;if(y===d){e.setStyle(w,"float","left");this.content.style.width=v.panelSize[0]*t+"px"}break;case c:for(x=0;x<t;x++){e.setStyle(w[x],n,x===v.activeIndex?1:0);w[x].style.position=p;w[x].style.zIndex=x===v.activeIndex?9:1}break}}},_initAutoPlay:function(){var u=this,t=u.config,s=u.panels.length-1;if(t.pauseOnMouseOver){r.on([u.content,u.nav],"mouseenter",function(){u.paused=true});r.on([u.content,u.nav],"mouseleave",function(){u.paused=false})}u.autoPlayTimer=h.later(t.autoPlayInterval*1000,this,function(){if(u.paused){return}u.switchTo(u.activeIndex<s?u.activeIndex+1:0)},null,true)},_switchContent:function(u,v,t){var s=this;m[s.config.effectType].call(s,u,v,function(){s.fireEvent("onSwitch",t)},t)}});i.augment(j,i.Triggerable,false);i.SlideView=j});KISSY.add("megamenu",function(f){var c=YAHOO.util,g=c.Dom,k=c.Event,h=YAHOO.lang,j="none",a="block",b='<span class="{hook_cls}"></span>',e="ks-megamenu-",d={triggerType:"mouse",triggerDelay:0.1,hideDelay:0.5,triggerCls:e+"trigger",viewCls:e+"view",contentCls:e+"content",activeTriggerCls:e+"trigger-active",closeBtnCls:e+"closebtn",showCloseBtn:true};function i(m,o){var n=this,l=f.merge(d,o||{});if(!(n instanceof arguments.callee)){return new arguments.callee(m,o)}n.container=g.get(m);n.config=l;n.triggers=g.getElementsByClassName(l.triggerCls,"*",m);n.contents=[];g.getElementsByClassName(l.contentCls,"*",m,function(p){n.contents.push(p.value||p.innerHTML)});n.panels=n.contents;n.activeIndex=-1;n._init()}f.mix(i.prototype,{_init:function(){var l=this;l._initTriggers();l._initView();if(l.config.showCloseBtn){l._initCloseBtn()}},_onFocusTrigger:function(m){var l=this;if(l.activeIndex===m){return}if(l.showTimer){l.showTimer.cancel()}if(l.hideTimer){l.hideTimer.cancel()}l.switchTo(m)},_onMouseEnterTrigger:function(m){var l=this;if(l.hideTimer){l.hideTimer.cancel()}l.showTimer=h.later(l.config.triggerDelay*1000,l,function(){l.switchTo(m)})},_onMouseLeaveTrigger:function(){var l=this;if(l.showTimer){l.showTimer.cancel()}l.hideTimer=h.later(l.config.hideDelay*1000,l,function(){l.hide()})},_initView:function(){var n=this,m=n.config,l=g.getElementsByClassName(m.viewCls,"*",n.container)[0];if(!l){l=document.createElement("DIV");l.className=m.viewCls;n.container.appendChild(l)}k.on(l,"mouseenter",function(){if(n.hideTimer){n.hideTimer.cancel()}});k.on(l,"mouseleave",function(){n.hideTimer=h.later(m.hideDelay*1000,n,"hide")});n.viewContent=l;n.view=l},_initCloseBtn:function(){var m=this,n,l=m.view;l.innerHTML=b.replace("{hook_cls}",m.config.closeBtnCls);k.on(l.firstChild,"click",function(){m.hide()});n=document.createElement("div");l.appendChild(n);m.viewContent=n},_switchContent:function(o,l,n){var m=this;m.view.style.display=a;m.viewContent.innerHTML=l;m.fireEvent("onSwitch",n)},hide:function(){var l=this;g.removeClass(l.triggers[l.activeIndex],l.config.activeTriggerCls);l.view.style.display=j;l.activeIndex=-1}});f.augment(i,f.Triggerable,false);f.MegaMenu=i});KISSY.add("scrollview",function(f){var c=YAHOO.util,b=c.Dom,t=c.Event,e=YAHOO.lang,g=b.getFirstChild,a=b.getLastChild,d=b.insertBefore,m=b.insertAfter,l=b.getAttribute,o=b.setAttribute;var q="prev",r="next",n="carousel:index",u="horizontal",k="vertical";var i={delay:2000,speed:500,startDelay:2000,autoStart:true,direction:"vertical",scrollWidth:false,scrollSize:1};function j(x){var x=b.get(x),y=x.offsetLeft,v=x.offsetTop,w=x.offsetParent;while(w){y+=w.offsetLeft;v+=w.offsetTop;w=w.offsetParent}return{top:v,left:y}}var p=function(y,w,z){var x=b[(z=="prev")?"getPreviousSibling":"getNextSibling"];for(var v=0;v<w;v++){y=x(y);if(!y){return false}}return y};var h=function(v,x,y){y=(y==q)?q:r;switch(y){case q:for(var w=0;w<x;w++){d(a(v),g(v))}break;default:for(var w=0;w<x;w++){m(g(v),a(v))}}};var s=function(w,x){var E=this,x=e.merge(i,x||{}),w,B,v,A,C,y,z,D;w=b.get(w),B=w.getElementsByTagName("li");v=B[0]||[],C=B.length;if(C<x.scrollSize){return}for(y=0,z=C;y<z;y++){o(B[y],n,y)}A=l(v,n);D={x:(x.direction==u)||(x.direction=="h"),y:(x.direction==k)||(x.direction=="v")};E.config=x,E.container=w,E.panels=B,E.currentPanel=v,E.current=A,E.total=C,E.direction=D;E._init()};f.mix(s.prototype,{_init:function(){var y=this,A=y.config,x=y.container,z=y.panels,C,v,w;var B=["onScroll","onPause","onBeforeScroll","onPause","onWakeup"];for(C=0,v=B.length;C<v;C++){w=B[C];if(e.isFunction(A[w])){y[w+"Event"]=new c.CustomEvent(w,y,false,c.CustomEvent.FLAT);y[w+"Event"].subscribe(A[w])}}t.on(x,"mouseenter",function(){if(A.autoStart){y.pause()}});t.on(x,"mouseleave",function(){if(A.autoStart){y.wakeup()}});if(A.autoStart){e.later(A.startDelay,y,function(){y.play()})}},play:function(G){var I=this,w=I.container,v=I.currentPanel,B=I.current,x=I.config,F=arguments.callee,z,E;G=(G==q)?q:r;if(I._scrolling||I.paused){return}do{E=p(v,x.scrollSize,G);if(!E){h(v.parentNode,x.scrollSize,G)}}while(!E);if(e.isNumber(x.scrollWidth)){var y=x.scrollWidth*x.scrollSize}var D=j(I.currentPanel),A=j(w),C=j(E);if(I.direction.y){var H=D.top-A.top;z={scroll:{from:[,H]}};z.scroll.to=y?[,H+(y*(G==r?1:-1))]:[,C.top-A.top]}else{var H=D.left-A.left;z={scroll:{from:[H]}};z.scroll.to=y?[H+(y*(G==r?1:-1))]:[C.left-A.left]}I.currentPanel=E;I.current=l(E,n);if(e.isObject(I.onBeforeScrollEvent)){I.onBeforeScrollEvent.fire()}I._scrolling=true;if(I.anim){I.anim.stop()}I.anim=new c.Scroll(w,z,x.speed/1000,x.easing||c.Easing.easeOut);I.anim.onComplete.subscribe(function(){I._scrolling=false;if(e.isObject(I.onScrollEvent)){I.onScrollEvent.fire()}if(!I.paused&&x.autoStart){I.timer=e.later(x.delay,I,F)}});I.anim.animate()},pause:function(){var v=this;v.paused=true;if(v._wakeupTimer){v._wakeupTimer.cancel()}if(e.isObject(v.onPauseEvent)){v.onPauseEvent.fire()}},wakeup:function(){var v=this;v.paused=false;if(v._wakeupTimer){v._wakeupTimer.cancel()}if(e.isObject(this.onWakeupEvent)){v.onWakeupEvent.fire()}v._wakeupTimer=e.later(0,v,function(){v.timer=e.later(v.config.delay,v,v.play)})},jumpTo:function(B,E){var F=this,w=F.config,v=F.currentPanel,D=F.total,C,x,z,y,A;if(e.isUndefined(E)&&e.isNumber(this._prevIndex)){E=B>F._prevIndex?r:q}E=(E==q)?q:r;x=(E==q)?r:q;if(B>F.total){return}for(z=0,A=D;z<A;z++){y=l(F.panels[z],n);if(y==B){C=F.panels[z];break}}if(!C){return}do{F.currentPanel=p(C,w.scrollSize,x);if(!F.currentPanel){h(C.parentNode,w.scrollSize,E)}}while(!F.currentPanel);F._prevIndex=B;F.play(E)},next:function(){this.play("next")},prev:function(){this.play("prev")}});f.ScrollView=s});KISSY.add("suggest",function(a){if(KISSY.Suggest){a.Suggest=KISSY.Suggest;return}a.Suggest=KISSY.Suggest=(function(){var e=YAHOO.util,d=e.Dom,x=e.Event,g=YAHOO.lang,f=window,y=document,i=y.getElementsByTagName("head")[0],q=YAHOO.env.ua.ie,j=(q===6),r="g_ks_suggest_callback",m="suggest-style",b="suggest-container",w="suggest-key",c="suggest-result",p="selected",v="suggest-bottom",u="suggest-close-btn",t="suggest-shim",l="beforeDataRequest",k="onDataReturn",h="beforeShow",s="onItemSelect",o={containerClass:"",containerWidth:"auto",resultFormat:"\u7ea6%result%\u6761\u7ed3\u679c",showCloseBtn:false,closeBtnText:"\u5173\u95ed",useShim:j,timerDelay:200,autoFocus:false,submitFormOnClickSelect:true};function n(A,B,z){if(!(this instanceof arguments.callee)){return new arguments.callee(A,B,z)}this.textInput=d.get(A);this.dataSource=B;this.JSONDataSource=g.isObject(B)?B:null;this.returnedData=null;this.config=g.merge(o,z||{});this.container=null;this.query="";this.queryParams="";this._timer=null;this._isRunning=false;this.dataScript=null;this._dataCache={};this._latestScriptTime="";this._scriptDataIsOut=false;this._onKeyboardSelecting=false;this.selectedItem=null;this._init()}a.mix(n.prototype,{_init:function(){this._initTextInput();this._initContainer();if(this.config.useShim){this._initShim()}this._initStyle();this.createEvent(l);this.createEvent(k);this.createEvent(h);this.createEvent(s);this._initResizeEvent()},_initTextInput:function(){var z=this;this.textInput.setAttribute("autocomplete","off");x.on(this.textInput,"blur",function(){z.stop();z.hide()});if(this.config.autoFocus){this.textInput.focus()}var A=0;x.on(this.textInput,"keydown",function(B){var C=B.keyCode;switch(C){case 27:z.hide();z.textInput.value=z.query;break;case 13:z.textInput.blur();if(z._onKeyboardSelecting){if(z.textInput.value==z._getSelectedItemKey()){z.fireEvent(s,z.textInput.value)}}z._submitForm();break;case 40:case 38:if(A++==0){if(z._isRunning){z.stop()}z._onKeyboardSelecting=true;z.selectItem(C==40)}else{if(A==3){A=0}}break}if(C!=40&&C!=38){if(!z._isRunning){z.start()}z._onKeyboardSelecting=false}});x.on(this.textInput,"keyup",function(){A=0})},_initContainer:function(){var z=y.createElement("div"),A=this.config.containerClass;z.className=b;if(A){z.className+=" "+A}z.style.position="absolute";z.style.visibility="hidden";this.container=z;this._setContainerRegion();this._initContainerEvent();y.body.insertBefore(z,y.body.firstChild)},_setContainerRegion:function(){var B=d.getRegion(this.textInput);var C=B.left,z=B.right-C-2;z=z>0?z:0;var A=y.documentMode;if(A===7&&(q===7||q===8)){C-=2}else{if(YAHOO.env.ua.gecko){C++}}this.container.style.left=C+"px";this.container.style.top=B.bottom+"px";if(this.config.containerWidth=="auto"){this.container.style.width=z+"px"}else{this.container.style.width=this.config.containerWidth}},_initContainerEvent:function(){var z=this;x.on(this.container,"mousemove",function(B){var C=x.getTarget(B);if(C.nodeName!="LI"){C=d.getAncestorByTagName(C,"li")}if(d.isAncestor(z.container,C)){if(C!=z.selectedItem){z._removeSelectedItem();z._setSelectedItem(C)}}});var A=null;this.container.onmousedown=function(B){B=B||f.event;A=B.target||B.srcElement;z.textInput.onbeforedeactivate=function(){f.event.returnValue=false;z.textInput.onbeforedeactivate=null};return false};x.on(this.container,"mouseup",function(B){if(!z._isInContainer(x.getXY(B))){return}var C=x.getTarget(B);if(C!=A){return}if(C.className==u){z.hide();return}if(C.nodeName!="LI"){C=d.getAncestorByTagName(C,"li")}if(d.isAncestor(z.container,C)){z._updateInputFromSelectItem(C);z.fireEvent(s,z.textInput.value);z.textInput.blur();z._submitForm()}})},_submitForm:function(){if(this.config.submitFormOnClickSelect){var A=this.textInput.form;if(!A){return}if(y.createEvent){var z=y.createEvent("MouseEvents");z.initEvent("submit",true,false);A.dispatchEvent(z)}else{if(y.createEventObject){A.fireEvent("onsubmit")}}A.submit()}},_isInContainer:function(A){var z=d.getRegion(this.container);return A[0]>=z.left&&A[0]<=z.right&&A[1]>=z.top&&A[1]<=z.bottom},_initShim:function(){var z=y.createElement("iframe");z.src="about:blank";z.className=t;z.style.position="absolute";z.style.visibility="hidden";z.style.border="none";this.container.shim=z;this._setShimRegion();y.body.insertBefore(z,y.body.firstChild)},_setShimRegion:function(){var z=this.container,A=z.shim;if(A){A.style.left=(parseInt(z.style.left)-2)+"px";A.style.top=z.style.top;A.style.width=(parseInt(z.style.width)+2)+"px"}},_initStyle:function(){var A=d.get(m);if(A){return}var z=".suggest-container{background:white;border:1px solid #999;z-index:99999}.suggest-shim{z-index:99998}.suggest-container li{color:#404040;padding:1px 0 2px;font-size:12px;line-height:18px;float:left;width:100%}.suggest-container li.selected{background-color:#39F;cursor:default}.suggest-key{float:left;text-align:left;padding-left:5px}.suggest-result{float:right;text-align:right;padding-right:5px;color:green}.suggest-container li.selected span{color:#FFF;cursor:default}.suggest-bottom{padding:0 5px 5px}.suggest-close-btn{float:right}.suggest-container li,.suggest-bottom{overflow:hidden;zoom:1;clear:both}.suggest-container{*margin-left:2px;_margin-left:-2px;_margin-top:-3px}";A=y.createElement("style");A.id=m;A.type="text/css";i.appendChild(A);if(A.styleSheet){A.styleSheet.cssText=z}else{A.appendChild(y.createTextNode(z))}},_initResizeEvent:function(){var A=this,z;x.on(f,"resize",function(){if(z){clearTimeout(z)}z=setTimeout(function(){A._setContainerRegion();A._setShimRegion()},50)})},start:function(){n.focusInstance=this;var z=this;z._timer=setTimeout(function(){z.updateContent();z._timer=setTimeout(arguments.callee,z.config.timerDelay)},z.config.timerDelay);this._isRunning=true},stop:function(){n.focusInstance=null;clearTimeout(this._timer);this._isRunning=false},show:function(){if(this.isVisible()){return}var z=this.container,B=z.shim;z.style.visibility="";if(B){if(!B.style.height){var A=d.getRegion(z);B.style.height=(A.bottom-A.top-2)+"px"}B.style.visibility=""}},hide:function(){if(!this.isVisible()){return}var z=this.container,A=z.shim;if(A){A.style.visibility="hidden"}z.style.visibility="hidden"},isVisible:function(){return this.container.style.visibility!="hidden"},updateContent:function(){if(!this._needUpdate()){return}this._updateQueryValueFromInput();var z=this.query;if(!g.trim(z).length){this._fillContainer("");this.hide();return}if(typeof this._dataCache[z]!="undefined"){this.returnedData="using cache";this._fillContainer(this._dataCache[z]);this._displayContainer()}else{if(this.JSONDataSource){this.handleResponse(this.JSONDataSource[z])}else{this.requestData()}}},_needUpdate:function(){return this.textInput.value!=this.query},requestData:function(){if(!q){this.dataScript=null}if(!this.dataScript){var z=y.createElement("script");z.type="text/javascript";z.charset="utf-8";i.insertBefore(z,i.firstChild);this.dataScript=z;if(!q){var A=new Date().getTime();this._latestScriptTime=A;z.setAttribute("time",A);x.on(z,"load",function(){this._scriptDataIsOut=z.getAttribute("time")!=this._latestScriptTime},this,true)}}this.queryParams="q="+encodeURIComponent(this.query)+"&code=utf-8&callback="+r;this.fireEvent(l,this.query);this.dataScript.src=this.dataSource+"?"+this.queryParams},handleResponse:function(F){if(this._scriptDataIsOut){return}this.returnedData=F;this.fireEvent(k,F);this.returnedData=this.formatData(this.returnedData);var D="";var B=this.returnedData.length;if(B>0){var E=y.createElement("ol");for(var C=0;C<B;++C){var A=this.returnedData[C];var z=this.formatItem(A.key,A.result);z.setAttribute("key",A.key);E.appendChild(z)}D=E}this._fillContainer(D);if(B>0){this.appendBottom()}if(g.trim(this.container.innerHTML)){this.fireEvent(h,this.container)}this._dataCache[this.query]=this.container.innerHTML;this._displayContainer()},formatData:function(D){var A=[];if(!D){return A}if(g.isArray(D.result)){D=D.result}var z=D.length;if(!z){return A}var C;for(var B=0;B<z;++B){C=D[B];if(g.isString(C)){A[B]={key:C}}else{if(g.isArray(C)&&C.length>=2){A[B]={key:C[0],result:C[1]}}else{A[B]=C}}}return A},formatItem:function(B,A){var z=y.createElement("li");var D=y.createElement("span");D.className=w;D.appendChild(y.createTextNode(B));z.appendChild(D);if(typeof A!="undefined"){var C=this.config.resultFormat.replace("%result%",A);if(g.trim(C)){var E=y.createElement("span");E.className=c;E.appendChild(y.createTextNode(C));z.appendChild(E)}}return z},appendBottom:function(){var z=y.createElement("div");z.className=v;if(this.config.showCloseBtn){var A=y.createElement("a");A.href="javascript: void(0)";A.setAttribute("target","_self");A.className=u;A.appendChild(y.createTextNode(this.config.closeBtnText));z.appendChild(A)}if(g.trim(z.innerHTML)){this.container.appendChild(z)}},_fillContainer:function(z){if(z.nodeType==1){this.container.innerHTML="";this.container.appendChild(z)}else{this.container.innerHTML=z}this.selectedItem=null},_displayContainer:function(){if(g.trim(this.container.innerHTML)){this.show()}else{this.hide()}},selectItem:function(B){var A=this.container.getElementsByTagName("li");if(A.length==0){return}if(!this.isVisible()){this.show();return}var z;if(!this.selectedItem){z=A[B?0:A.length-1]}else{z=d[B?"getNextSibling":"getPreviousSibling"](this.selectedItem);if(!z){this.textInput.value=this.query}}this._removeSelectedItem();if(z){this._setSelectedItem(z);this._updateInputFromSelectItem()}},_removeSelectedItem:function(){d.removeClass(this.selectedItem,p);this.selectedItem=null},_setSelectedItem:function(z){d.addClass((z),p);this.selectedItem=(z)},_getSelectedItemKey:function(){if(!this.selectedItem){return""}return this.selectedItem.getAttribute("key")},_updateQueryValueFromInput:function(){this.query=this.textInput.value},_updateInputFromSelectItem:function(){this.textInput.value=this._getSelectedItemKey(this.selectedItem)}});a.augment(n,e.EventProvider);f[r]=function(z){if(!n.focusInstance){return}setTimeout(function(){n.focusInstance.handleResponse(z)},0)};return n})()});
