/*
Copyright (c) 2009, Kissy UI Library. All rights reserved.
MIT Licensed.
http://kissy.googlecode.com/

Date: 2009-12-29 17:49:04
Revision: 375
*/
KISSY.add("switchable",function(g){var c=YAHOO.util,i=c.Dom,o=c.Event,k=YAHOO.lang,l="undefined",d="display",a="block",n="none",b="forward",f="backward",j="switchable",m="beforeSwitch",h="onSwitch",e="ks-switchable-",p={};p.Config={mackupType:0,navCls:e+"nav",contentCls:e+"content",triggerCls:e+"trigger",panelCls:e+"panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"active",steps:1,viewSize:[]};g.Widget.prototype.switchable=function(r){var q=this;r=r||{};if(r.panelCls){p.Config.mackupType=1}else{if(r.panels){p.Config.mackupType=2}}q.config[j]=g.merge(p.Config,r||{});q.triggers=q.triggers||[];q.panels=q.panels||[];if(typeof q.activeIndex===l){q.activeIndex=q.config[j].activeIndex}g.mix(q,p);q._initSwitchable();return q};g.mix(p,{_initSwitchable:function(){var r=this,q=r.config[j];if(r.panels.length===0){r._parseSwitchableMackup()}r.createEvent(m);r.createEvent(h);if(q.hasTriggers){r._bindTriggers()}},_parseSwitchableMackup:function(){var A=this,r=A.container,v=A.config[j],B=v.hasTriggers,q,w,y=[],x=[],u,s,t,z=i.getElementsByClassName;switch(v.mackupType){case 0:q=z(v.navCls,"*",r)[0];if(q){y=i.getChildren(q)}w=z(v.contentCls,"*",r)[0];x=i.getChildren(w);break;case 1:y=z(v.triggerCls,"*",r);x=z(v.panelCls,"*",r);break;case 2:y=v.triggers;x=v.panels;break}s=x.length;A.length=s/v.steps;if(B&&s>0&&y.length===0){y=A._generateTriggersMackup(A.length)}if(B){for(u=0,t=y.length;u<t;u++){A.triggers.push(y[u])}}for(u=0;u<s;u++){A.panels.push(x[u])}A.content=w||x[0].parentNode},_generateTriggersMackup:function(r){var t=this,s=t.config[j],v=document.createElement("UL"),q,u;v.className=s.navCls;for(u=0;u<r;u++){q=document.createElement("LI");if(u===t.activeIndex){q.className=s.activeTriggerCls}q.innerHTML=u+1;v.appendChild(q)}t.container.appendChild(v);return i.getChildren(v)},_bindTriggers:function(){var s=this,r=s.config[j],v=s.triggers,t,u,q=v.length;for(u=0;u<q;u++){(function(w){t=v[w];o.on(t,"click",function(){s._onFocusTrigger(w)});o.on(t,"focus",function(){s._onFocusTrigger(w)});if(r.triggerType==="mouse"){o.on(t,"mouseenter",function(){s._onMouseEnterTrigger(w)});o.on(t,"mouseleave",function(){s._onMouseLeaveTrigger(w)})}})(u)}},_onFocusTrigger:function(r){var q=this;if(q.activeIndex===r){return}if(q.switchTimer){q.switchTimer.cancel()}q.switchTo(r)},_onMouseEnterTrigger:function(r){var q=this;if(q.activeIndex!==r){q.switchTimer=k.later(q.config[j].delay*1000,q,function(){q.switchTo(r)})}},_onMouseLeaveTrigger:function(){var q=this;if(q.switchTimer){q.switchTimer.cancel()}},switchTo:function(r,x){var y=this,s=y.config[j],u=y.triggers,t=y.panels,z=y.activeIndex,v=s.steps,w=z*v,q=r*v;if(r===z){return y}if(!y.fireEvent(m,r)){return y}if(s.hasTriggers){y._switchTrigger(z>-1?u[z]:null,u[r])}if(typeof x===l){x=r>z?b:b}y._switchView(t.slice(w,w+v),t.slice(q,q+v),r,x);y.activeIndex=r;return y},_switchTrigger:function(s,q){var r=this.config[j].activeTriggerCls;if(s){i.removeClass(s,r)}i.addClass(q,r)},_switchView:function(s,r,q){i.setStyle(s,d,n);i.setStyle(r,d,a);this.fireEvent(h,q)},prev:function(){var r=this,q=r.activeIndex;r.switchTo(q>0?q-1:r.length-1,f)},next:function(){var r=this,q=r.activeIndex;r.switchTo(q<r.length-1?q+1:0,b)}});g.mix(p,c.EventProvider.prototype);g.Switchable=p});
