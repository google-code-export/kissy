/*
Copyright 2010, KISSY UI Library v1.0.3
MIT Licensed
build: 473 Mar 9 22:20
*/
(function(g,o,h){if(g[o]===h)g[o]={};o=g[o];var a=g.document,k=Array.prototype,i=k.forEach,b=k.indexOf,j=/^\s+|\s+$/g,d=function(c,m,n,p){if(!m||!c)return c;if(n===h)n=true;var r,q,s;if(p&&(s=p.length))for(r=0;r<s;r++){q=p[r];if(q in m)if(n||!(q in c))c[q]=m[q]}else for(q in m)if(n||!(q in c))c[q]=m[q];return c},e=false,l=[],f=false;d(o,{version:"1.0.3",_init:function(){this.Env={mods:{}};this.Config={debug:true}},add:function(c,m){var n=this;n.Env.mods[c]={name:c,fn:m};m(n);return n},ready:function(c){f||
this._bindReady();e?c.call(g,this):l.push(c);return this},_bindReady:function(){var c=this,m=a.documentElement.doScroll,n=m?"onreadystatechange":"DOMContentLoaded";f=true;if(a.attachEvent){if(g!=g.top){function p(){if(a.readyState==="complete"){a.detachEvent(n,p);c._fireReady()}}a.attachEvent(n,p)}else{function r(){try{m("left");c._fireReady()}catch(s){setTimeout(r,1)}}r()}g.attachEvent("onload",function(){c._fireReady()})}else{function q(){a.removeEventListener(n,q,false);c._fireReady()}a.addEventListener(n,
q,false)}},_fireReady:function(){if(!e){e=true;if(l){for(var c,m=0;c=l[m++];)c.call(g,this);l=null}}},mix:d,merge:function(){var c=arguments,m={},n,p=c.length;for(n=0;n<p;++n)d(m,c[n]);return m},extend:function(c,m,n,p){if(!m||!c)return c;var r=Object.prototype,q=m.prototype,s=function(x){function t(){}t.prototype=x;return new t}(q);c.prototype=s;s.constructor=c;c.superclass=q;if(m!==Object&&q.constructor===r.constructor)q.constructor=m;n&&d(s,n);p&&d(c,p);return c},augment:function(c,m,n,p){return d(c.prototype,
m.prototype,n,p)},weave:function(c,m,n,p){var r=[n[p],c];m==="before"&&r.reverse();n[p]=function(){for(var q=0,s;q<2;++q)s=r[q].apply(this,arguments);return s};return this},cloneTo:function(c){var m=g[c]||{};d(m,this);m._init();d(m.Env.mods,this.Env.mods);return g[c]=m},namespace:function(){var c=arguments,m=c.length,n=null,p,r,q;for(p=0;p<m;++p){q=(""+c[p]).split(".");n=this;for(r=g[q[0]]===n?1:0;r<q.length;++r)n=n[q[r]]=n[q[r]]||{}}return n},each:i?function(c,m,n){i.call(c,m,n);return this}:function(c,
m,n){var p=c&&c.length||0,r;for(r=0;r<p;++r)m.call(n||this,c[r],r,c);return this},indexOf:b?function(c,m){return b.call(m,c)}:function(c,m){for(var n=0,p=m.length;n<p;++n)if(m[n]===c)return n;return-1},trim:String.prototype.trim?function(c){return(c||"").trim()}:function(c){return(c||"").replace(j,"")},log:function(c,m,n){if(this.Config.debug){n&&(c=n+": "+c);if(g.console!==h&&console.log)console[m&&console[m]?m:"log"](c)}return this}});o._init()})(window,"KISSY");
KISSY.add("editor",function(g){function o(h,a){var k=o;if(!(this instanceof k))return new k(h,a);k._isReady||k._setup();return new k.Instance(h,a)}g.mix(o,{version:"1.0",lang:{},plugins:{},Env:{mods:{}},add:function(h,a,k){this.Env.mods[h]={name:h,fn:a,details:k||{}};return this},addPlugin:function(h,a){h=typeof h=="string"?[h]:h;var k=this.plugins,i,b,j;b=0;for(j=h.length;b<j;++b){i=h[b];k[i]||(k[i]=g.merge(a,{name:i}))}},_isReady:false,_setup:function(){this._loadModules();this._isReady=true},_attached:{},
_loadModules:function(){var h=KISSY.Editor.Env.mods,a=this._attached,k,i;for(k in h)if(i=h[k]){a[k]=i;i.fn&&i.fn(this)}}});g.Editor=o});
KISSY.Editor.add("config",function(g){g.config={base:"",language:"zh-cn",theme:"default",toolbar:["source","","fontName","fontSize","bold","italic","underline","strikeThrough","foreColor","backColor","","link","smiley","image","","insertOrderedList","insertUnorderedList","outdent","indent","justifyLeft","justifyCenter","justifyRight"],statusbar:["wordcount","resize"],pluginsConfig:{}}});
KISSY.Editor.add("lang~en",function(g){g.lang.en={source:{text:"Source",title:"Source"},undo:{text:"Undo",title:"Undo (Ctrl+Z)"},redo:{text:"Redo",title:"Redo (Ctrl+Y)"},fontName:{text:"Font Name",title:"Font Name",options:{Arial:"Arial","Times New Roman":"Times New Roman","Arial Black":"Arial Black","Arial Narrow":"Arial Narrow","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Garamond:"Garamond",Georgia:"Georgia",Tahoma:"Tahoma","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"}},fontSize:{text:"Size",
title:"Font size",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"Bold",title:"Bold (Ctrl+B)"},italic:{text:"Italic",title:"Italick (Ctrl+I)"},underline:{text:"Underline",title:"Underline (Ctrl+U)"},strikeThrough:{text:"Strikeout",title:"Strikeout"},link:{text:"Link",title:"Insert/Edit link",href:"URL:",target:"Open link in new window",remove:"Remove link"},blockquote:{text:"Blockquote",title:"Insert blockquote"},smiley:{text:"Smiley",title:"Insert smiley"},image:{text:"Image",
title:"Insert image",tab_link:"Web Image",tab_local:"Local Image",tab_album:"Album Image",label_link:"Enter image web address:",label_local:"Browse your computer for the image file to upload:",label_album:"Select the image from your album:",uploading:"Uploading...",upload_error:"Exception occurs when uploading file.",upload_filter:"Only allow PNG, GIF, JPG image type.",ok:"Insert"},insertOrderedList:{text:"Numbered List",title:"Numbered List (Ctrl+7)"},insertUnorderedList:{text:"Bullet List",title:"Bullet List (Ctrl+8)"},
outdent:{text:"Decrease Indent",title:"Decrease Indent"},indent:{text:"Increase Indent",title:"Increase Indent"},justifyLeft:{text:"Left Justify",title:"Left Justify (Ctrl+L)"},justifyCenter:{text:"Center Justify",title:"Center Justify (Ctrl+E)"},justifyRight:{text:"Right Justify",title:"Right Justify (Ctrl+R)"},foreColor:{text:"Text Color",title:"Text Color"},backColor:{text:"Text Background Color",title:"Text Background Color"},maximize:{text:"Maximize",title:"Maximize"},removeformat:{text:"Remove Format",
title:"Remove Format"},wordcount:{tmpl:"Remain %remain% words (include html code)"},resize:{larger_text:"Larger",larger_title:"Enlarge the editor",smaller_text:"Smaller",smaller_title:"Shrink the editor"},common:{ok:"OK",cancel:"Cancel"}}});
KISSY.Editor.add("lang~zh-cn",function(g){g.lang["zh-cn"]={source:{text:"\u6e90\u7801",title:"\u6e90\u7801"},undo:{text:"\u64a4\u9500",title:"\u64a4\u9500"},redo:{text:"\u91cd\u505a",title:"\u91cd\u505a"},fontName:{text:"\u5b57\u4f53",title:"\u5b57\u4f53",options:{"\u5b8b\u4f53":"\u5b8b\u4f53","\u9ed1\u4f53":"\u9ed1\u4f53","\u96b6\u4e66":"\u96b6\u4e66","\u6977\u4f53":"\u6977\u4f53_GB2312","\u5fae\u8f6f\u96c5\u9ed1":"\u5fae\u8f6f\u96c5\u9ed1",Georgia:"Georgia","Times New Roman":"Times New Roman",Impact:"Impact","Courier New":"Courier New",Arial:"Arial",Verdana:"Verdana",Tahoma:"Tahoma"}},fontSize:{text:"\u5927\u5c0f",title:"\u5927\u5c0f",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"\u7c97\u4f53",
title:"\u7c97\u4f53"},italic:{text:"\u659c\u4f53",title:"\u659c\u4f53"},underline:{text:"\u4e0b\u5212\u7ebf",title:"\u4e0b\u5212\u7ebf"},strikeThrough:{text:"\u5220\u9664\u7ebf",title:"\u5220\u9664\u7ebf"},link:{text:"\u94fe\u63a5",title:"\u63d2\u5165/\u7f16\u8f91\u94fe\u63a5",href:"URL:",target:"\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5",remove:"\u79fb\u9664\u94fe\u63a5"},blockquote:{text:"\u5f15\u7528",title:"\u5f15\u7528"},smiley:{text:"\u8868\u60c5",title:"\u63d2\u5165\u8868\u60c5"},image:{text:"\u56fe\u7247",title:"\u63d2\u5165\u56fe\u7247",tab_link:"\u7f51\u7edc\u56fe\u7247",tab_local:"\u672c\u5730\u4e0a\u4f20",tab_album:"\u6211\u7684\u76f8\u518c",label_link:"\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a",label_local:"\u8bf7\u9009\u62e9\u672c\u5730\u56fe\u7247\uff1a",label_album:"\u8bf7\u9009\u62e9\u76f8\u518c\u56fe\u7247\uff1a",uploading:"\u6b63\u5728\u4e0a\u4f20...",upload_error:"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u6587\u4ef6\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",upload_filter:"\u4ec5\u652f\u6301 JPG, PNG \u548c GIF \u56fe\u7247\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002",
ok:"\u63d2\u5165"},insertOrderedList:{text:"\u6709\u5e8f\u5217\u8868",title:"\u6709\u5e8f\u5217\u8868"},insertUnorderedList:{text:"\u65e0\u5e8f\u5217\u8868",title:"\u65e0\u5e8f\u5217\u8868"},outdent:{text:"\u51cf\u5c11\u7f29\u8fdb",title:"\u51cf\u5c11\u7f29\u8fdb"},indent:{text:"\u589e\u52a0\u7f29\u8fdb",title:"\u589e\u52a0\u7f29\u8fdb"},justifyLeft:{text:"\u5de6\u5bf9\u9f50",title:"\u5de6\u5bf9\u9f50"},justifyCenter:{text:"\u5c45\u4e2d\u5bf9\u9f50",title:"\u5c45\u4e2d\u5bf9\u9f50"},justifyRight:{text:"\u53f3\u5bf9\u9f50",title:"\u53f3\u5bf9\u9f50"},foreColor:{text:"\u6587\u672c\u989c\u8272",title:"\u6587\u672c\u989c\u8272"},backColor:{text:"\u80cc\u666f\u989c\u8272",title:"\u80cc\u666f\u989c\u8272"},maximize:{text:"\u5168\u5c4f\u7f16\u8f91",title:"\u5168\u5c4f\u7f16\u8f91"},removeformat:{text:"\u6e05\u9664\u683c\u5f0f",title:"\u6e05\u9664\u683c\u5f0f"},wordcount:{tmpl:"\u8fd8\u53ef\u4ee5\u8f93\u5165 %remain% \u5b57\uff08\u542b html \u4ee3\u7801\uff09"},resize:{larger_text:"\u589e\u5927",
larger_title:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller_text:"\u7f29\u5c0f",smaller_title:"\u7f29\u5c0f\u7f16\u8f91\u533a\u57df"},common:{ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88"}}});KISSY.Editor.add("core~plugin",function(g){g.PLUGIN_TYPE={CUSTOM:0,TOOLBAR_SEPARATOR:1,TOOLBAR_BUTTON:2,TOOLBAR_MENU_BUTTON:4,TOOLBAR_SELECT:8,STATUSBAR_ITEM:16,FUNC:32}});
KISSY.Editor.add("core~dom",function(g){var o=YAHOO.env.ua;g.Dom={getText:function(h){return h?h.textContent||"":""},setItemUnselectable:function(h){var a,k,i,b,j;a=h.getElementsByTagName("*");k=-1;for(i=a.length;k<i;++k){j=k==-1?h:a[k];(b=j.nodeName)&&b!="INPUT"&&j.setAttribute("unselectable","on")}return h},BLOCK_ELEMENTS:{blockquote:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,p:1,address:1,center:1,pre:1,form:1,fieldset:1,caption:1,table:1,tbody:1,tr:1,th:1,td:1,ul:1,ol:1,dl:1,dt:1,dd:1,li:1}};
if(o.ie)g.Dom.getText=function(h){return h?h.innerText||"":""}});
KISSY.Editor.add("core~color",function(g){var o=parseInt,h=RegExp;g.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(a){this.re_RGB.test(a)||(a=this.toHex(a));if(this.re_hex.exec(a))a=
"rgb("+[o(h.$1,16),o(h.$2,16),o(h.$3,16)].join(", ")+")";return a},toHex:function(a){a=this.KEYWORDS[a]||a;if(this.re_RGB.exec(a)){a=(h.$1>>0).toString(16);var k=(h.$2>>0).toString(16),i=(h.$3>>0).toString(16);a=[a.length==1?"0"+a:a,k.length==1?"0"+k:k,i.length==1?"0"+i:i].join("")}if(a.length<6)a=a.replace(this.re_hex3,"$1$1");if(a!=="transparent"&&a.indexOf("#")<0)a="#"+a;return a.toLowerCase()},int2hex:function(a){a>>=0;return this.toHex("rgb("+(a&255)+","+(a>>8&255)+","+(a>>16&255)+")")}}});
KISSY.Editor.add("core~command",function(g){var o=YAHOO.env.ua,h={backColor:o.gecko?"hiliteColor":"backColor"};g.Command={exec:function(a,k,i,b){k=h[k]||k;this._preExec(a,k,b);a.execCommand(k,false,i)},_preExec:function(a,k,i){if(o.gecko){k=typeof i==="undefined"?"bold,italic,underline,strikeThrough".indexOf(k)===-1:i;a.execCommand("styleWithCSS",false,k)}}}});
KISSY.Editor.add("core~range",function(g){var o=YAHOO.env.ua.ie;g.Range={getSelectionRange:function(h){var a=h.document,k;if(h.getSelection){h=h.getSelection();if(h.getRangeAt)k=h.getRangeAt(0);else{k=a.createRange();k.setStart(h.anchorNode,h.anchorOffset);k.setEnd(h.focusNode,h.focusOffset)}}else if(a.selection)k=a.selection.createRange();return k},getCommonAncestor:function(h){return h.startContainer||h.parentElement&&h.parentElement()||h.commonParentElement&&h.commonParentElement()},getSelectedText:function(h){if("text"in
h)return h.text;return h.toString?h.toString():""},saveRange:function(h){o&&h.contentWin.focus();return h.getSelectionRange()}}});
KISSY.Editor.add("core~instance",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.lang,i=YAHOO.env.ua,b=i.ie;g.Instance=function(j,d){this.textarea=h.get(j);this.config=k.merge(g.config,d||{});this.sourceMode=false;this.toolbar=new g.Toolbar(this);this.statusbar=new g.Statusbar(this);this._init()};k.augmentObject(g.Instance.prototype,{_init:function(){this._renderUI();this._initPlugins();this._initAutoFocus()},_renderUI:function(){this._renderContainer();this._setupContentPanel()},_initPlugins:function(){var j,
d;d=g.plugins;var e=[];for(j in d)e[j]=k.merge(d[j]);this.plugins=e;this.toolbar.init();this.statusbar.init();for(j in e){d=e[j];if(!d.inited)if(d.type===g.PLUGIN_TYPE.FUNC){d.editor=this;d.init&&d.init();d.inited=true}}},_renderContainer:function(){var j=this.textarea,d=h.getRegion(j),e=d.right-d.left-2+"px",l=d.bottom-d.top-2+"px";d=document.createElement("div");d.className="ks-editor";d.style.width=e;d.innerHTML='<div class="ks-editor-toolbar"></div><div class="ks-editor-content"><iframe frameborder="0" allowtransparency="1"></iframe></div><div class="ks-editor-statusbar"></div>';
e=d.childNodes[1];e.style.width="100%";e.style.height=l;e=e.childNodes[0];e.style.width="100%";e.style.height="100%";e.setAttribute("frameBorder",0);j.style.display="none";h.insertBefore(d,j);this.container=d;this.toolbar.domEl=d.childNodes[0];this.contentWin=e.contentWindow;this.contentDoc=e.contentWindow.document;this.statusbar.domEl=d.childNodes[2]},_setupContentPanel:function(){var j=this.contentDoc,d=this.config;d=d.base+"themes/"+d.theme+"/"+("content"+(d.debug?"":"-min")+".css");var e=this;
j.open();j.write('<!doctype html><html><head><title>Rich Text Area</title><meta charset="charset=gbk" /><link href="{CONTENT_CSS}" rel="stylesheet" /></head><body spellcheck="false" class="ks-editor-post">{CONTENT}</body></html>'.replace("{CONTENT_CSS}",d).replace("{CONTENT}",this.textarea.value));j.close();if(b)j.body.contentEditable="true";else j.designMode="on";b&&a.on(j,"click",function(){j.activeElement.parentNode.nodeType===9&&e._focusToEnd()})},_initAutoFocus:function(){this.config.autoFocus&&
this._focusToEnd()},_focusToEnd:function(){this.contentWin.focus();var j=this.contentDoc.body.lastChild,d=g.Range.getSelectionRange(this.contentWin);if(i.ie){try{d.moveToElementText(j)}catch(e){}d.collapse(false);d.select()}else{try{d.setEnd(j,j.childNodes.length)}catch(l){}d.collapse(false)}},focus:function(){this._focusToEnd()},execCommand:function(j,d,e){this.contentWin.focus();g.Command.exec(this.contentDoc,j,d,e)},getData:function(){if(this.sourceMode)return this.textarea.value;return this.getContentDocData()},
getContentDocData:function(){var j="",d=g.plugins.save;j=this.contentDoc.body.innerHTML;if(j=="<br>")j="";if(d&&d.filterData)j=d.filterData(j);return j},getSelectionRange:function(){return g.Range.getSelectionRange(this.contentWin)}})});
KISSY.Editor.add("core~toolbar",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.lang,i=YAHOO.env.ua.ie,b=i===6,j=g.PLUGIN_TYPE,d=document.createElement("div");g.Toolbar=function(e){this.editor=e;this.config=e.config;this.lang=g.lang[this.config.language];this.items=[];this.stateItems=[]};k.augmentObject(g.Toolbar.prototype,{init:function(){for(var e=this.config.toolbar,l=this.editor.plugins,f,c=0,m=e.length;c<m;++c)if(f=e[c]){if(f in l){f=l[f];this._addItem(f);this.items.push(f);"fontName,fontSize,bold,italic,underline,strikeThroughinsertOrderedList,insertUnorderedListjustifyLeft,justifyCenter,justifyRight".indexOf(f.name)!==
-1&&this.stateItems.push(f)}}else this._addSeparator();this._initUpdateState()},_addItem:function(e){var l,f=e.type;l=this.lang;if(!e.lang)e.lang=k.merge(l.common,this.lang[e.name]||{});l='<div class="ks-editor-toolbar-button ks-inline-block" title="{TITLE}"><div class="ks-editor-toolbar-button-outer-box"><div class="ks-editor-toolbar-button-inner-box"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div></div></div>'.replace("{TITLE}",e.lang.title||"").replace("{NAME}",
e.name).replace("{TEXT}",e.lang.text||"");if(b)l=l.replace("outer-box","outer-box ks-inline-block").replace("inner-box","inner-box ks-inline-block");d.innerHTML=l;e.domEl=l=d.firstChild;if(f==j.TOOLBAR_MENU_BUTTON||f==j.TOOLBAR_SELECT){this._renderMenuButton(e);f==j.TOOLBAR_SELECT&&this._renderSelect(e)}this._bindItemUI(e);this._addToToolbar(l);e.editor=this.editor;e.init&&e.init();e.inited=true},_renderMenuButton:function(e){var l=e.domEl,f=l.getElementsByTagName("span")[0].parentNode;h.addClass(l,
"ks-editor-toolbar-menu-button");f.innerHTML='<div class="ks-editor-toolbar-menu-button-caption ks-inline-block"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div><div class="ks-editor-toolbar-menu-button-dropdown ks-inline-block"></div>'.replace("{NAME}",e.name).replace("{TEXT}",e.lang.text||"")},_renderSelect:function(e){h.addClass(e.domEl,"ks-editor-toolbar-select")},_bindItemUI:function(e){var l=e.domEl;e.exec&&a.on(l,"click",function(){e.exec()});a.on(l,"mousedown",
function(){h.addClass(l,"ks-editor-toolbar-button-active")});a.on(l,"mouseup",function(){h.removeClass(l,"ks-editor-toolbar-button-active")});a.on(l,"mouseout",function(f){f=a.getRelatedTarget(f);var c;try{if(l.contains)c=l.contains(f);else if(l.compareDocumentPosition)c=l.compareDocumentPosition(f)&8}catch(m){c=false}c||h.removeClass(l,"ks-editor-toolbar-button-active")});if(b){a.on(l,"mouseenter",function(){h.addClass(l,"ks-editor-toolbar-button-hover")});a.on(l,"mouseleave",function(){h.removeClass(l,
"ks-editor-toolbar-button-hover")})}},_addSeparator:function(){d.innerHTML='<div class="ks-editor-stripbar-sep ks-inline-block"></div>';this._addToToolbar(d.firstChild)},_addToToolbar:function(e){if(i)e=g.Dom.setItemUnselectable(e);this.domEl.appendChild(e)},_initUpdateState:function(){var e=this.editor.contentDoc,l=this;a.on(e,"click",function(){l.updateState()});a.on(e,"keyup",function(f){f=f.keyCode;if(f>=33&&f<=40||f===8||f===13||f===46)l.updateState()})},updateState:function(e){var l=this.stateItems,
f;e=e?e.join("|"):"";for(var c=0,m=l.length;c<m;c++){f=l[c];e&&e.indexOf(f.name)===-1||(f.updateState?f.updateState():this.updateItemState(f))}},updateItemState:function(e){var l=this.editor.contentDoc;try{if(l.queryCommandEnabled(e.name))l.queryCommandState(e.name)?h.addClass(e.domEl,"ks-editor-toolbar-button-selected"):h.removeClass(e.domEl,"ks-editor-toolbar-button-selected")}catch(f){}}})});
KISSY.Editor.add("core~statusbar",function(g){var o=YAHOO.lang,h=YAHOO.env.ua.ie,a=document.createElement("div");g.Statusbar=function(k){this.editor=k;this.config=k.config;this.lang=g.lang[this.config.language]};o.augmentObject(g.Statusbar.prototype,{init:function(){for(var k=this.config.statusbar,i=this.editor.plugins,b,j=0,d=k.length;j<d;++j)if(b=k[j])b in i&&this._addItem(i[b]);else this._addSep()},_addItem:function(k){var i;i=this.lang;if(!k.lang)k.lang=o.merge(i.common,this.lang[k.name]||{});
a.innerHTML='<div class="ks-editor-statusbar-item ks-editor-{NAME} ks-inline-block"></div>'.replace("{NAME}",k.name);k.domEl=i=a.firstChild;this._addToToolbar(i);k.editor=this.editor;k.init&&k.init();k.inited=true},_addSep:function(){a.innerHTML='<div class="ks-editor-stripbar-sep kissy-inline-block"></div>';this._addToToolbar(a.firstChild)},_addToToolbar:function(k){if(h)k=g.Dom.setItemUnselectable(k);this.domEl.appendChild(k)}})});
KISSY.Editor.add("core~menu",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.env.ua,i;g.Menu={generateDropMenu:function(b,j,d){var e=document.createElement("div"),l=this;e.innerHTML='<div class="ks-editor-drop-menu-shadow"></div><div class="ks-editor-drop-menu-content"></div>';e.className="ks-editor-drop-menu";e.style.display="none";document.body.appendChild(e);a.on(j,"click",function(f){a.stopPropagation(f);b.activeDropMenu&&l._hide(b);if(b.activeDropMenu!=e){l._setDropMenuPosition(j,e,d);
b.activeDropMenu=e;b.activeDropButton=j;l._show(b)}else{b.activeDropMenu=null;b.activeDropButton=null}});a.on([document,b.contentDoc],"click",function(){if(b.activeDropMenu){l.hideActiveDropMenu(b);this==b.contentDoc&&b.contentWin.focus()}});this._initResizeEvent(j,e,d);return e.childNodes[1]},_setDropMenuPosition:function(b,j,d){var e=h.getRegion(b);b=e.left;e=e.bottom;if(d){b+=d[0];e+=d[1]}j.style.left=b+"px";j.style.top=e+"px"},_isVisible:function(b){if(!b)return false;return b.style.display!=
"none"},hideActiveDropMenu:function(b){this._hide(b);b.activeDropMenu=null;b.activeDropButton=null},_hide:function(b){var j=b.activeDropMenu;b=b.activeDropButton;if(j){i&&(i.style.display="none");j.style.display="none"}b&&h.removeClass(b,"ks-editor-toolbar-button-selected")},_show:function(b){var j=b.activeDropMenu;b=b.activeDropButton;if(j){j.style.display="";if(k.ie===6){this._updateShimRegion(j);i.style.display=""}}b&&h.addClass(b,"ks-editor-toolbar-button-selected")},_updateShimRegion:function(b){if(b)if(k.ie===
6){i||this._initShim();this._setShimRegion(b)}},_initResizeEvent:function(b,j,d){var e=this,l;a.on(window,"resize",function(){l&&clearTimeout(l);l=setTimeout(function(){e._isVisible(j)&&e._setDropMenuPosition(b,j,d)},50)})},_initShim:function(){i=document.createElement("iframe");i.src="about:blank";i.className="ks-editor-drop-menu-shim";i.style.position="absolute";i.style.display="none";i.style.border="none";document.body.appendChild(i)},_setShimRegion:function(b){if(i&&this._isVisible(b)){b=h.getRegion(b);
if(b.width>0){i.style.left=b.left+"px";i.style.top=b.top+"px";i.style.width=b.width-1+"px";i.style.height=b.height-1+"px"}}}}});KISSY.Editor.add("smilies~config~default",function(g){g.Smilies=g.Smilies||{};g.Smilies["default"]={name:"default",mode:"icons",cols:5,fileNames:["smile","confused","cool","cry","eek","angry","wink","sweat","lol","stun","razz","shy","rolleyes","sad","happy","yes","no","heart","idea","rose"],fileExt:"gif"}});
KISSY.Editor.add("smilies~config~wangwang",function(g){g.Smilies=g.Smilies||{};g.Smilies.wangwang={name:"wangwang",mode:"sprite",base:"http://a.tbcdn.cn/sys/wangwang/smiley/48x48/",spriteStyle:"background: url(http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png) no-repeat -1px 0; width: 288px; height: 235px",unitStyle:"width: 24px; height: 24px",filePattern:{start:0,end:98,step:1},fileExt:"gif"}});
KISSY.Editor.add("plugins~base",function(g){var o=g.PLUGIN_TYPE;g.addPlugin("bold,italic,underline,strikeThrough,insertOrderedList,insertUnorderedList".split(","),{type:o.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~color",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.env.ua.ie,i=["000","444","666","999","CCC","EEE","F3F3F3","FFF"],b=["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],j=["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000",
"B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"];g.addPlugin(["foreColor","backColor"],{type:g.PLUGIN_TYPE.TOOLBAR_MENU_BUTTON,color:"",_indicator:null,swatches:null,dropMenu:null,range:null,init:function(){var d=this.domEl,e=d.getElementsByTagName("span")[0].parentNode;this.color=this._getDefaultColor();h.addClass(d,"ks-editor-toolbar-color-button");e.innerHTML='<div class="ks-editor-toolbar-color-button-indicator" style="border-bottom-color:'+
this.color+'">'+e.innerHTML+"</div>";this._indicator=e.firstChild;this._renderUI();this._bindUI();this.swatches=h.getElementsByClassName("ks-editor-palette-colorswatch","div",this.dropMenu)},_renderUI:function(){this.dropMenu=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._generatePalettes();k&&g.Dom.setItemUnselectable(this.dropMenu)},_bindUI:function(){this._bindPickEvent();a.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();k&&this.editor.contentDoc.selection.empty();
this._updateSelectedColor(this.color)},this,true)},_generatePalettes:function(){var d="";d+=this._getPaletteTable(i);d+=this._getPaletteTable(b);d+=this._getPaletteTable(j);this.dropMenu.innerHTML=d},_getPaletteTable:function(d){var e,l=d.length,f,c="<tr>";e=0;for(l=d.length;e<l;++e){if(e!=0&&e%8==0)c+="</tr><tr>";f=g.Color.toRGB("#"+d[e]).toUpperCase();c+='<td class="ks-editor-palette-cell"><div class="ks-editor-palette-colorswatch" title="{COLOR}" style="background-color:{COLOR}"></div></td>'.replace(/{COLOR}/g,
f)}c+="</tr>";return'<div class="ks-editor-palette-table"><table><tbody>{TR}</tbody></table></div>'.replace("{TR}",c)},_bindPickEvent:function(){var d=this;a.on(this.dropMenu,"click",function(e){var l=a.getTarget(e).getAttribute("title");l&&l.indexOf("RGB")===0&&d._doAction(l);a.stopPropagation(e);g.Menu.hideActiveDropMenu(d.editor)})},_doAction:function(d){if(d){this.setColor(g.Color.toHex(d));d=this.range;k&&d.select&&d.select();this.editor.execCommand(this.name,this.color)}},setColor:function(d){this.color=
d;this._updateIndicatorColor(d);this._updateSelectedColor(d)},_updateIndicatorColor:function(d){this._indicator.style.borderBottomColor=d},_updateSelectedColor:function(d){var e,l,f,c=this.swatches;e=0;for(l=c.length;e<l;++e){f=c[e];g.Color.toHex(f.style.backgroundColor)==d?h.addClass(f.parentNode,"ks-editor-palette-cell-selected"):h.removeClass(f.parentNode,"ks-editor-palette-cell-selected")}},_getDefaultColor:function(){return this.name=="foreColor"?"#000000":"#ffffff"}})});
KISSY.Editor.add("plugins~font",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.env.ua,i={"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7};g.addPlugin(["fontName","fontSize"],{type:g.PLUGIN_TYPE.TOOLBAR_SELECT,selectedValue:"",selectHead:null,selectList:null,options:[],items:null,selectedItem:null,range:null,init:function(){this.options=this.lang.options;this.selectHead=this.domEl.getElementsByTagName("span")[0];this._renderUI();this._bindUI()},_renderUI:function(){this.selectList=
g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._renderSelectList();this.items=this.selectList.getElementsByTagName("li")},_bindUI:function(){this._bindPickEvent();a.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();k.ie&&this.editor.contentDoc.selection.empty();if(this.selectedValue)this._updateSelectedOption(this.selectedValue);else if(this.selectedItem){h.removeClass(this.selectedItem,"ks-editor-option-selected");this.selectedItem=null}},this,true)},_renderSelectList:function(){var b=
"",j=this.options,d,e;for(d in j){e=j[d];b+='<li class="ks-editor-option" data-value="{VALUE}"><span class="ks-editor-option-checkbox"></span><span style="{STYLE}">{KEY}</span></li>'.replace("{VALUE}",e).replace("{STYLE}",this._getOptionStyle(d,e)).replace("{KEY}",d)}this.selectList.innerHTML='<ul class="ks-editor-select-list">{LI}</ul>'.replace("{LI}",b);h.addClass(this.selectList,"ks-editor-drop-menu-"+this.name)},_bindPickEvent:function(){var b=this;a.on(this.selectList,"click",function(j){var d=
a.getTarget(j);if(d.nodeName!="LI")d=h.getAncestorByTagName(d,"li");if(d){b._doAction(d.getAttribute("data-value"));a.stopPropagation(j);g.Menu.hideActiveDropMenu(b.editor)}});if(k.ie===6){a.on(this.items,"mouseenter",function(){h.addClass(this,"ks-editor-option-hover")});a.on(this.items,"mouseleave",function(){h.removeClass(this,"ks-editor-option-hover")})}},_doAction:function(b){if(b){this.selectedValue=b;this._setOption(b);b=this.range;k.ie&&b.select&&b.select();this.editor.execCommand(this.name,
this.selectedValue)}},_setOption:function(b){this._updateHeadText(this._getOptionKey(b));this._updateSelectedOption(b)},_getOptionStyle:function(b,j){return this.name=="fontName"?"font-family:"+j:"font-size:"+b+"px"},_getOptionKey:function(b){var j=this.options,d;for(d in j)if(j[d]==b)return d;return null},_updateHeadText:function(b){this.selectHead.innerHTML=b},_updateSelectedOption:function(b){var j=this.items,d,e=j.length,l;for(d=0;d<e;++d){l=j[d];if(l.getAttribute("data-value")==b){h.addClass(l,
"ks-editor-option-selected");this.selectedItem=l}else h.removeClass(l,"ks-editor-option-selected")}},updateState:function(){var b=this.editor.contentDoc,j=this.options,d=this.name,e,l;try{if(b.queryCommandEnabled(d)){l=b.queryCommandValue(d);if(k.webkit&&d=="fontSize")l=this._getWebkitFontSize(l);l&&(e=this._getOptionKey(l));if(e in j){if(l!=this.selectedValue){this.selectedValue=l;this._updateHeadText(e)}}else{this.selectedValue="";this._updateHeadText(this.lang.text)}}}catch(f){}},_getWebkitFontSize:function(b){if(b in
i)return i[b];return null}})});
KISSY.Editor.add("plugins~image",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=o.Connect,i=YAHOO.lang,b=YAHOO.env.ua,j=b.ie,d="ks-editor-image-tab-selected",e={local:'<li rel="local" class="'+d+'">{tab_local}</li>',link:'<li rel="link">{tab_link}</li>',album:'<li rel="album">{tab_album}</li>'},l={tabs:["link"],upload:{actionUrl:"",filter:"png|gif|jpg|jpeg",filterMsg:"",enableXdr:false,connectionSwf:"http://a.tbcdn.cn/yui/2.8.0r4/build/connection/connection.swf",formatResponse:function(f){var c=[];
for(var m in f)c.push(f[m]);return c},extraCode:""}};g.addPlugin("image",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,form:null,range:null,currentTab:null,currentPanel:null,uploadingPanel:null,actionsBar:null,init:function(){var f=this.editor.config.pluginsConfig[this.name]||{};l.upload.filterMsg=this.lang.upload_filter;this.config=i.merge(l,f);this.config.upload=i.merge(l.upload,f.upload||{});this._renderUI();this._bindUI();this.actionsBar=h.getElementsByClassName("ks-editor-dialog-actions",
"div",this.dialog)[0];this.uploadingPanel=h.getElementsByClassName("ks-editor-image-uploading","div",this.dialog)[0];this.config.upload.enableXdr&&this._initXdrUpload()},_renderUI:function(){var f=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),c=this.lang;c.local_extraCode=this.config.upload.extraCode;f.className+=" ks-editor-image";f.innerHTML='<form action="javascript: void(0)"><ul class="ks-editor-image-tabs ks-clearfix"></ul><div class="ks-editor-image-tab-content" rel="local" style="display: none"><label>{label_local}</label><input type="file" size="40" name="imgFile" unselectable="on" />{local_extraCode}</div><div class="ks-editor-image-tab-content" rel="link"><label>{label_link}</label><input name="imgUrl" size="50" /></div><div class="ks-editor-image-tab-content" rel="album" style="display: none"><label>{label_album}</label><p style="width: 300px">\u5c1a\u672a\u5b9e\u73b0...</p></div><div class="ks-editor-image-uploading" style="display: none"><p style="width: 300px">{uploading}</p></div><div class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span></div></form>'.replace(/\{([^}]+)\}/g,
function(m,n){return n in c?c[n]:n});this.dialog=f;this.form=f.getElementsByTagName("form")[0];j&&g.Dom.setItemUnselectable(f);this._renderTabs()},_renderTabs:function(){function f(w){for(var u=0,y=w.getAttribute("rel"),v=0;v<z;v++){t[v]&&h.removeClass(t[v],d);p[v].style.display="none";if(p[v].getAttribute("rel")==y)u=v}b.ie===6&&g.Menu._updateShimRegion(m.dialog);h.addClass(w,d);p[u].style.display="";m.currentTab=w.getAttribute("rel");m.currentPanel=p[u]}for(var c=this.lang,m=this,n=h.getElementsByClassName("ks-editor-image-tabs",
"ul",this.dialog)[0],p=h.getElementsByClassName("ks-editor-image-tab-content","div",this.dialog),r=this.config.tabs,q="",s=0,x=r.length;s<x;s++)q+=e[r[s]];n.innerHTML=q.replace(/\{([^}]+)\}/g,function(w,u){return u in c?c[u]:u});var t=n.childNodes,z=p.length;t.length===1&&h.addClass(this.dialog,"ks-editor-image-no-tab");f(t[0]);a.on(t,"click",function(){f(this)})},_bindUI:function(){var f=this;a.on(this.domEl,"click",function(){if(f.dialog.style.visibility===j?"hidden":"visible")f._syncUI()});a.on(this.dialog,
"click",function(c){var m=a.getTarget(c),n=f.currentTab;switch(m.className){case "ks-editor-btn-ok":if(n==="local"){a.stopPropagation(c);f._insertLocalImage()}else f._insertWebImage();break;case "ks-editor-btn-cancel":break;default:a.stopPropagation(c)}})},_initXdrUpload:function(){for(var f=this.config.tabs,c=0,m=f.length;c<m;c++)if(f[c]==="local"){k.transport(this.config.upload.connectionSwf);break}},_insertLocalImage:function(){var f=this.form,c=this.config.upload,m=f.imgFile.value,n=c.actionUrl,
p=this;if(m&&n){if(c.filter!=="*"){m=m.substring(m.lastIndexOf(".")+1).toLowerCase();if(c.filter.indexOf(m)==-1){alert(c.filterMsg);p.form.reset();return}}this.uploadingPanel.style.display="";this.currentPanel.style.display="none";this.actionsBar.style.display="none";b.ie===6&&g.Menu._updateShimRegion(this.dialog);k.setForm(f,true);k.asyncRequest("post",n,{upload:function(r){try{var q=c.formatResponse(i.JSON.parse(r.responseText));if(q[0]=="0"){p._insertImage(q[1]);p._hideDialog()}else p._onUploadError(q[1])}catch(s){p._onUploadError(i.dump(s)+
"\no = "+i.dump(r)+"\n[from upload catch code]")}},xdr:c.enableXdr})}else p._hideDialog()},_onUploadError:function(f){alert(this.lang.upload_error+"\n\n"+f);this._hideDialog()},_insertWebImage:function(){var f=this.form.imgUrl.value;f&&this._insertImage(f)},_hideDialog:function(){var f=this.editor.activeDropMenu;f&&h.isAncestor(f,this.dialog)&&g.Menu.hideActiveDropMenu(this.editor);this.editor.contentWin.focus()},_syncUI:function(){this.range=g.Range.saveRange(this.editor);this.form.reset();this.uploadingPanel.style.display=
"none";this.currentPanel.style.display="";this.actionsBar.style.display=""},_insertImage:function(f,c){f=i.trim(f);if(f.length!==0){var m=this.editor,n=this.range;if(window.getSelection){var p=m.contentDoc.createElement("img");p.src=f;c&&p.setAttribute("alt",c);n.deleteContents();n.insertNode(p);if(b.webkit){c=m.contentWin.getSelection();c.addRange(n);c.collapseToEnd()}else n.setStartAfter(p);m.contentWin.focus()}else if(document.selection){m.contentWin.focus();if("text"in n){n.select();m='<img src="'+
f+'"';c&&(m+=' "alt="'+c+'"');m+=">";n.pasteHTML(m)}else n.execCommand("insertImage",false,f)}}}})});KISSY.Editor.add("plugins~indent",function(g){g.addPlugin(["indent","outdent"],{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~justify",function(g){var o=["justifyLeft","justifyCenter","justifyRight"];g.addPlugin(o,{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState(o)}})});
KISSY.Editor.add("plugins~keystroke",function(g){var o=YAHOO.util.Event,h=YAHOO.env.ua;g.addPlugin("keystroke",{type:g.PLUGIN_TYPE.FUNC,init:function(){var a=this.editor;h.ie&&h.ie<8&&o.on(a.contentDoc,"keydown",function(i){i.keyCode==9&&this.selection.empty()});var k=a.textarea.form;k&&(new YAHOO.util.KeyListener(a.contentDoc,{ctrl:true,keys:13},{fn:function(){if(!a.sourceMode)a.textarea.value=a.getData();k.submit()}})).enable()}})});
KISSY.Editor.add("plugins~link",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.lang,i=YAHOO.env.ua,b=i.ie;o=g.PLUGIN_TYPE;var j=g.Range,d=(new Date).getTime(),e=/^\w+:\/\/.*|#.*$/,l=['<form onsubmit="return false"><ul><li class="ks-editor-link-href"><label>{href}</label><input name="href" style="width: 220px" value="http://" type="text" /></li><li class="ks-editor-link-target"><input name="target" id="target_"',d,' type="checkbox" /> <label for="target_"',d,'>{target}</label></li><li class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span><span class="ks-editor-link-remove">{remove}</span></li></ul></form>'].join("");
g.addPlugin("link",{type:o.TOOLBAR_BUTTON,dialog:null,form:null,range:null,init:function(){this._renderUI();this._bindUI()},_renderUI:function(){var f=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),c=this.lang;f.className+=" ks-editor-link";f.innerHTML=l.replace(/\{([^}]+)\}/g,function(m,n){return c[n]?c[n]:n});this.dialog=f;this.form=f.getElementsByTagName("form")[0];i.webkit&&(this.form.target.parentNode.style.display="none");b&&g.Dom.setItemUnselectable(f)},_bindUI:function(){var f=this.form,
c=this;a.on(this.domEl,"click",function(){if(c.dialog.style.visibility===b?"hidden":"visible")c._syncUI()});a.on(this.dialog,"click",function(m){switch(a.getTarget(m).className){case "ks-editor-btn-ok":c._createLink(f.href.value,f.target.checked);break;case "ks-editor-btn-cancel":break;case "ks-editor-link-remove":c._unLink();break;default:a.stopPropagation(m)}})},_syncUI:function(){this.range=g.Range.saveRange(this.editor);var f=this.form,c;c=j.getCommonAncestor(this.range);if(c=c.nodeName=="A"?
c:h.getAncestorByTagName(c,"A")){f.href.value=c.href;f.target.checked=c.target==="_blank";h.removeClass(f,"ks-editor-link-newlink-mode")}else{f.href.value="http://";f.target.checked=false;h.addClass(f,"ks-editor-link-newlink-mode")}setTimeout(function(){f.href.select()},50)},_createLink:function(f,c){f=this._getValidHref(f);if(f.length===0)this._unLink();else{var m=this.range,n=document.createElement("div"),p;p=j.getCommonAncestor(m);if(p=p.nodeName=="A"?p:h.getAncestorByTagName(p,"A")){p.href=f;
c?p.setAttribute("target","_blank"):p.removeAttribute("target")}else{p=document.createElement("a");p.href=f;c&&p.setAttribute("target","_blank");if(b){m.select&&m.select();if("text"in m){p.innerHTML=m.htmlText||f;n.innerHTML="";n.appendChild(p);m.pasteHTML(n.innerHTML)}else this.editor.execCommand("createLink",f)}else if(i.webkit)this.editor.execCommand("createLink",f);else{if(m.collapsed)p.innerHTML=f;else for(f=m.cloneContents();f.firstChild;)p.appendChild(f.firstChild);m.deleteContents();m.insertNode(p);
m.selectNode(p)}}}},_getValidHref:function(f){if((f=k.trim(f))&&!e.test(f))f="http://"+f;return f},_unLink:function(){var f=this.editor,c=this.range,m=j.getSelectedText(c),n=j.getCommonAncestor(c);if(!m&&n.nodeType==3){f=n.parentNode;f.nodeName=="A"&&f.parentNode.replaceChild(n,f)}else{c.select&&c.select();f.execCommand("unLink",null)}}})});
KISSY.Editor.add("plugins~resize",function(g){var o=YAHOO.util.Event;g.addPlugin("resize",{type:g.PLUGIN_TYPE.STATUSBAR_ITEM,contentEl:null,currentHeight:0,init:function(){this.contentEl=this.editor.container.childNodes[1];this.currentHeight=parseInt(this.contentEl.style.height);this.renderUI();this.bindUI()},renderUI:function(){var h=this.lang;this.domEl.innerHTML='<span class="ks-editor-resize-larger" title="{larger_title}">{larger_text}</span><span class="ks-editor-resize-smaller" title="{smaller_title}">{smaller_text}</span>'.replace(/\{([^}]+)\}/g,
function(a,k){return h[k]?h[k]:k})},bindUI:function(){var h=this.domEl.getElementsByTagName("span"),a=h[1];o.on(h[0],"click",function(){this.currentHeight+=100;this._doResize()},this,true);o.on(a,"click",function(){if(this.currentHeight<100)this.currentHeight=0;else this.currentHeight-=100;this._doResize()},this,true)},_doResize:function(){this.contentEl.style.height=this.currentHeight+"px";this.editor.textarea.style.height=this.currentHeight+"px"}})});
KISSY.Editor.add("plugins~save",function(g){var o=YAHOO.util.Event,h={b:{tag:"strong"},i:{tag:"em"},u:{tag:"span",style:"text-decoration:underline"},strike:{tag:"span",style:"text-decoration:line-through"}};g.addPlugin("save",{type:g.PLUGIN_TYPE.FUNC,init:function(){var a=this.editor,k=a.textarea,i=k.form;i&&o.on(i,"submit",function(){if(!a.sourceMode)k.value=a.getData()})},filterData:function(a){a=a.replace(/<(\/?)([^>\s]+)([^>]*)>/g,function(k,i,b,j){b=b.toLowerCase();k=h[b];b=b;if(k&&!j){b=k.tag;
if(!i&&k.style)b+=' style="'+k.style+'"'}return"<"+i+b+j+">"});if(a.indexOf("mso")>0)a=this.filterWord(a);return a},filterWord:function(a){a=a.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3");a=a.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3");a=a.replace(/<H(\d)([^>]*)>/gi,"<h$1>");a=a.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>");a=a.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");a=a.replace(/<meta[^>]*>/ig,"");a=a.replace(/<link rel="\S+" href="file:[^>]*">/ig,
"");a=a.replace(/<!--\[if gte mso [0-9]{1,2}\]>[\s\S]*?<!\[endif\]--\>/ig,"");a=a.replace(/<style>[\s\S]*?mso[\s\S]*?<\/style>/ig,"");a=a.replace(/ lang=".+?"/ig,"");a=a.replace(/<o:p><\/o:p>/ig,"");return a=a.replace(/ class="Mso.+?"/ig,"")}})});
KISSY.Editor.add("plugins~smiley",function(g){var o=YAHOO.util.Event,h=YAHOO.lang,a=YAHOO.env.ua,k={tabs:["default"]};g.addPlugin("smiley",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,range:null,init:function(){this.config=h.merge(k,this.editor.config.pluginsConfig[this.name]||{});this._renderUI();this._bindUI()},_renderUI:function(){var i=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);i.className+=" ks-editor-smiley-dialog";this.dialog=i;this._renderDialog();a.ie&&g.Dom.setItemUnselectable(i)},
_renderDialog:function(){var i=g.Smilies[this.config.tabs[0]],b=i.mode;if(b==="icons")this._renderIcons(i);else b==="sprite"&&this._renderSprite(i)},_renderIcons:function(i){var b=this.editor.config.base+"smilies/"+i.name+"/",j=i.fileNames,d="."+i.fileExt;i=i.cols;var e=[],l,f=j.length,c;e.push('<div class="ks-editor-smiley-icons">');for(l=0;l<f;l++){c=j[l];e.push('<img src="'+b+c+d+'" alt="'+c+'" title="'+c+'" />');l%i===i-1&&e.push("<br />")}e.push("</div");this.dialog.innerHTML=e.join("")},_renderSprite:function(i){var b=
i.base,j=i.filePattern,d="."+i.fileExt,e=j.end+1;j=j.step;var l,f=[];f.push('<div class="ks-editor-smiley-sprite ks-clearfix" style="'+i.spriteStyle+'">');for(l=0;l<e;l+=j)f.push('<span data-icon="'+b+l+d+'" style="'+i.unitStyle+'"></span>');f.push("</div");this.dialog.innerHTML=f.join("")},_bindUI:function(){var i=this;o.on(this.domEl,"click",function(){i.range=g.Range.saveRange(i.editor)});o.on(this.dialog,"click",function(b){var j=o.getTarget(b);switch(j.nodeName){case "IMG":i._insertImage(j.src,
j.getAttribute("alt"));break;case "SPAN":i._insertImage(j.getAttribute("data-icon"),"");break;default:o.stopPropagation(b)}})},_insertImage:function(i,b){i=h.trim(i);if(i.length!==0){var j=this.editor,d=this.range;if(window.getSelection){var e=j.contentDoc.createElement("img");e.src=i;e.setAttribute("alt",b);d.deleteContents();d.insertNode(e);if(a.webkit){i=j.contentWin.getSelection();i.addRange(d);i.collapseToEnd()}else d.setStartAfter(e);j.contentWin.focus()}else if(document.selection)"text"in d?
d.pasteHTML('<img src="'+i+'" alt="'+b+'" />'):j.execCommand("insertImage",i)}}})});
KISSY.Editor.add("plugins~source",function(g){var o=YAHOO.util.Dom,h=YAHOO.env.ua;g.addPlugin("source",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,init:function(){var a=this.editor;this.iframe=a.contentWin.frameElement;this.textarea=a.textarea;this.iframe.parentNode.appendChild(a.textarea);o.addClass(this.domEl,"ks-editor-toolbar-source-button")},exec:function(){var a=this.editor,k=a.sourceMode;if(k)a.contentDoc.body.innerHTML=this.textarea.value;else this.textarea.value=a.getContentDocData();h.ie&&h.ie<8&&
a.contentDoc.selection.empty();this.textarea.style.display=k?"none":"";this.iframe.style.display=k?"":"none";a.sourceMode=!k;this._updateButtonState()},_updateButtonState:function(){var a=this.editor;if(a.sourceMode){o.addClass(a.container,"ks-editor-src-mode");o.addClass(this.domEl,"ks-editor-toolbar-button-selected")}else{o.removeClass(a.container,"ks-editor-src-mode");o.removeClass(this.domEl,"ks-editor-toolbar-button-selected")}}})});
KISSY.Editor.add("plugins~undo",function(g){g.addPlugin(["undo","redo"],{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name)}})});
KISSY.Editor.add("plugins~wordcount",function(g){var o=YAHOO.util,h=o.Dom,a=o.Event,k=YAHOO.lang,i={total:5E4,threshold:100};g.addPlugin("wordcount",{type:g.PLUGIN_TYPE.STATUSBAR_ITEM,total:Infinity,remain:Infinity,threshold:0,remainEl:null,init:function(){var b=k.merge(i,this.editor.config.pluginsConfig[this.name]||{});this.total=b.total;this.threshold=b.threshold;this.renderUI();this.bindUI();var j=this;setTimeout(function(){j.syncUI()},50)},renderUI:function(){this.domEl.innerHTML=this.lang.tmpl.replace("%remain%",
"<em>"+this.total+"</em>");this.remainEl=this.domEl.getElementsByTagName("em")[0]},bindUI:function(){var b=this.editor;a.on(b.textarea,"keyup",this.syncUI,this,true);a.on(b.contentDoc,"keyup",this.syncUI,this,true);a.on(b.container,"click",this.syncUI,this,true)},syncUI:function(){this.remain=this.total-this.editor.getData().length;this.remainEl.innerHTML=this.remain;this.remain<=this.threshold?h.addClass(this.domEl,"ks-editor-wordcount-alarm"):h.removeClass(this.domEl,"ks-editor-wordcount-alarm")}})});
