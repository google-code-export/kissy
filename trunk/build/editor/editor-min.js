/*
Copyright 2010, KISSY UI Library v1.0.4
MIT Licensed
build: 480 Mar 11 14:06
*/
(function(f,o,g){if(f[o]===g)f[o]={};o=f[o];var a=f.document,j=Array.prototype,h=j.forEach,c=j.indexOf,i=/^\s+|\s+$/g,d=function(b,k,n,p){if(!k||!b)return b;if(n===g)n=true;var q,r,s;if(p&&(s=p.length))for(q=0;q<s;q++){r=p[q];if(r in k)if(n||!(r in b))b[r]=k[r]}else for(r in k)if(n||!(r in b))b[r]=k[r];return b},e=false,m=[],l=false;d(o,{version:"1.0.4",_init:function(){this.Env={mods:{}};this.Config={debug:true}},add:function(b,k){var n=this;n.Env.mods[b]={name:b,fn:k};k(n);return n},ready:function(b){l||
this._bindReady();e?b.call(f,this):m.push(b);return this},_bindReady:function(){var b=this,k=a.documentElement.doScroll,n=k?"onreadystatechange":"DOMContentLoaded";l=true;if(a.attachEvent){if(f!=f.top){function p(){if(a.readyState==="complete"){a.detachEvent(n,p);b._fireReady()}}a.attachEvent(n,p)}else{function q(){try{k("left");b._fireReady()}catch(s){setTimeout(q,1)}}q()}f.attachEvent("onload",function(){b._fireReady()})}else{function r(){a.removeEventListener(n,r,false);b._fireReady()}a.addEventListener(n,
r,false)}},_fireReady:function(){if(!e){e=true;if(m){for(var b,k=0;b=m[k++];)b.call(f,this);m=null}}},mix:d,merge:function(){var b=arguments,k={},n,p=b.length;for(n=0;n<p;++n)d(k,b[n]);return k},extend:function(b,k,n,p){if(!k||!b)return b;var q=Object.prototype,r=k.prototype,s=function(t){function x(){}x.prototype=t;return new x}(r);b.prototype=s;s.constructor=b;b.superclass=r;if(k!==Object&&r.constructor===q.constructor)r.constructor=k;n&&d(s,n);p&&d(b,p);return b},augment:function(b,k,n,p){return d(b.prototype,
k.prototype,n,p)},weave:function(b,k,n,p){var q=[n[p],b];k==="before"&&q.reverse();n[p]=function(){for(var r=0,s;r<2;++r)s=q[r].apply(this,arguments);return s};return this},cloneTo:function(b){var k=f[b]||{};d(k,this);k._init();d(k.Env.mods,this.Env.mods);return f[b]=k},namespace:function(){var b=arguments,k=b.length,n=null,p,q,r;for(p=0;p<k;++p){r=(""+b[p]).split(".");n=this;for(q=f[r[0]]===n?1:0;q<r.length;++q)n=n[r[q]]=n[r[q]]||{}}return n},each:h?function(b,k,n){h.call(b,k,n);return this}:function(b,
k,n){var p=b&&b.length||0,q;for(q=0;q<p;++q)k.call(n||this,b[q],q,b);return this},indexOf:c?function(b,k){return c.call(k,b)}:function(b,k){for(var n=0,p=k.length;n<p;++n)if(k[n]===b)return n;return-1},trim:String.prototype.trim?function(b){return(b||"").trim()}:function(b){return(b||"").replace(i,"")},log:function(b,k,n){if(this.Config.debug){n&&(b=n+": "+b);if(f.console!==g&&console.log)console[k&&console[k]?k:"log"](b)}return this}});o._init()})(window,"KISSY");
KISSY.add("editor",function(f){function o(g,a){var j=o;if(!(this instanceof j))return new j(g,a);j._isReady||j._setup();return new j.Instance(g,a)}f.mix(o,{version:"1.0",lang:{},plugins:{},Env:{mods:{}},add:function(g,a,j){this.Env.mods[g]={name:g,fn:a,details:j||{}};return this},addPlugin:function(g,a){g=typeof g=="string"?[g]:g;var j=this.plugins,h,c,i;c=0;for(i=g.length;c<i;++c){h=g[c];j[h]||(j[h]=f.merge(a,{name:h}))}},_isReady:false,_setup:function(){this._loadModules();this._isReady=true},_attached:{},
_loadModules:function(){var g=KISSY.Editor.Env.mods,a=this._attached,j,h;for(j in g)if(h=g[j]){a[j]=h;h.fn&&h.fn(this)}}});f.Editor=o});
KISSY.Editor.add("config",function(f){f.config={base:"",language:"zh-cn",theme:"default",toolbar:["source","","fontName","fontSize","bold","italic","underline","strikeThrough","foreColor","backColor","","link","smiley","image","","insertOrderedList","insertUnorderedList","outdent","indent","justifyLeft","justifyCenter","justifyRight"],statusbar:["wordcount","resize"],pluginsConfig:{}}});
KISSY.Editor.add("lang~en",function(f){f.lang.en={source:{text:"Source",title:"Source"},undo:{text:"Undo",title:"Undo (Ctrl+Z)"},redo:{text:"Redo",title:"Redo (Ctrl+Y)"},fontName:{text:"Font Name",title:"Font Name",options:{Arial:"Arial","Times New Roman":"Times New Roman","Arial Black":"Arial Black","Arial Narrow":"Arial Narrow","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Garamond:"Garamond",Georgia:"Georgia",Tahoma:"Tahoma","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"}},fontSize:{text:"Size",
title:"Font size",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"Bold",title:"Bold (Ctrl+B)"},italic:{text:"Italic",title:"Italick (Ctrl+I)"},underline:{text:"Underline",title:"Underline (Ctrl+U)"},strikeThrough:{text:"Strikeout",title:"Strikeout"},link:{text:"Link",title:"Insert/Edit link",href:"URL:",target:"Open link in new window",remove:"Remove link"},blockquote:{text:"Blockquote",title:"Insert blockquote"},smiley:{text:"Smiley",title:"Insert smiley"},image:{text:"Image",
title:"Insert image",tab_link:"Web Image",tab_local:"Local Image",tab_album:"Album Image",label_link:"Enter image web address:",label_local:"Browse your computer for the image file to upload:",label_album:"Select the image from your album:",uploading:"Uploading...",upload_error:"Exception occurs when uploading file.",upload_filter:"Only allow PNG, GIF, JPG image type.",upload_linkFilter:"The image link is not in our whitelist. Please upload as local image.",ok:"Insert"},insertOrderedList:{text:"Numbered List",
title:"Numbered List (Ctrl+7)"},insertUnorderedList:{text:"Bullet List",title:"Bullet List (Ctrl+8)"},outdent:{text:"Decrease Indent",title:"Decrease Indent"},indent:{text:"Increase Indent",title:"Increase Indent"},justifyLeft:{text:"Left Justify",title:"Left Justify (Ctrl+L)"},justifyCenter:{text:"Center Justify",title:"Center Justify (Ctrl+E)"},justifyRight:{text:"Right Justify",title:"Right Justify (Ctrl+R)"},foreColor:{text:"Text Color",title:"Text Color"},backColor:{text:"Text Background Color",
title:"Text Background Color"},maximize:{text:"Maximize",title:"Maximize"},removeformat:{text:"Remove Format",title:"Remove Format"},wordcount:{tmpl:"Remain %remain% words (include html code)"},resize:{larger_text:"Larger",larger_title:"Enlarge the editor",smaller_text:"Smaller",smaller_title:"Shrink the editor"},common:{ok:"OK",cancel:"Cancel"}}});
KISSY.Editor.add("lang~zh-cn",function(f){f.lang["zh-cn"]={source:{text:"\u6e90\u7801",title:"\u6e90\u7801"},undo:{text:"\u64a4\u9500",title:"\u64a4\u9500"},redo:{text:"\u91cd\u505a",title:"\u91cd\u505a"},fontName:{text:"\u5b57\u4f53",title:"\u5b57\u4f53",options:{"\u5b8b\u4f53":"\u5b8b\u4f53","\u9ed1\u4f53":"\u9ed1\u4f53","\u96b6\u4e66":"\u96b6\u4e66","\u6977\u4f53":"\u6977\u4f53_GB2312","\u5fae\u8f6f\u96c5\u9ed1":"\u5fae\u8f6f\u96c5\u9ed1",Georgia:"Georgia","Times New Roman":"Times New Roman",Impact:"Impact","Courier New":"Courier New",Arial:"Arial",Verdana:"Verdana",Tahoma:"Tahoma"}},fontSize:{text:"\u5927\u5c0f",title:"\u5927\u5c0f",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"\u7c97\u4f53",
title:"\u7c97\u4f53"},italic:{text:"\u659c\u4f53",title:"\u659c\u4f53"},underline:{text:"\u4e0b\u5212\u7ebf",title:"\u4e0b\u5212\u7ebf"},strikeThrough:{text:"\u5220\u9664\u7ebf",title:"\u5220\u9664\u7ebf"},link:{text:"\u94fe\u63a5",title:"\u63d2\u5165/\u7f16\u8f91\u94fe\u63a5",href:"URL:",target:"\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5",remove:"\u79fb\u9664\u94fe\u63a5"},blockquote:{text:"\u5f15\u7528",title:"\u5f15\u7528"},smiley:{text:"\u8868\u60c5",title:"\u63d2\u5165\u8868\u60c5"},image:{text:"\u56fe\u7247",title:"\u63d2\u5165\u56fe\u7247",tab_link:"\u7f51\u7edc\u56fe\u7247",tab_local:"\u672c\u5730\u4e0a\u4f20",tab_album:"\u6211\u7684\u76f8\u518c",label_link:"\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a",label_local:"\u8bf7\u9009\u62e9\u672c\u5730\u56fe\u7247\uff1a",label_album:"\u8bf7\u9009\u62e9\u76f8\u518c\u56fe\u7247\uff1a",uploading:"\u6b63\u5728\u4e0a\u4f20...",upload_error:"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u6587\u4ef6\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",upload_filter:"\u4ec5\u652f\u6301 JPG, PNG \u548c GIF \u56fe\u7247\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002",
upload_linkFilter:'\u5bf9\u4e0d\u8d77\uff0c\u56fe\u7247\u6240\u5728\u7f51\u7ad9\u4e0d\u5728\u5141\u8bb8\u8303\u56f4\u5185\u3002\n\u8bf7\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u518d\u901a\u8fc7"\u672c\u5730\u4e0a\u4f20"\u4e0a\u4f20\u56fe\u7247\u3002',ok:"\u63d2\u5165"},insertOrderedList:{text:"\u6709\u5e8f\u5217\u8868",title:"\u6709\u5e8f\u5217\u8868"},insertUnorderedList:{text:"\u65e0\u5e8f\u5217\u8868",title:"\u65e0\u5e8f\u5217\u8868"},outdent:{text:"\u51cf\u5c11\u7f29\u8fdb",title:"\u51cf\u5c11\u7f29\u8fdb"},indent:{text:"\u589e\u52a0\u7f29\u8fdb",title:"\u589e\u52a0\u7f29\u8fdb"},justifyLeft:{text:"\u5de6\u5bf9\u9f50",title:"\u5de6\u5bf9\u9f50"},justifyCenter:{text:"\u5c45\u4e2d\u5bf9\u9f50",title:"\u5c45\u4e2d\u5bf9\u9f50"},justifyRight:{text:"\u53f3\u5bf9\u9f50",title:"\u53f3\u5bf9\u9f50"},foreColor:{text:"\u6587\u672c\u989c\u8272",title:"\u6587\u672c\u989c\u8272"},backColor:{text:"\u80cc\u666f\u989c\u8272",title:"\u80cc\u666f\u989c\u8272"},maximize:{text:"\u5168\u5c4f\u7f16\u8f91",title:"\u5168\u5c4f\u7f16\u8f91"},removeformat:{text:"\u6e05\u9664\u683c\u5f0f",title:"\u6e05\u9664\u683c\u5f0f"},wordcount:{tmpl:"\u8fd8\u53ef\u4ee5\u8f93\u5165 %remain% \u5b57\uff08\u542b html \u4ee3\u7801\uff09"},
resize:{larger_text:"\u589e\u5927",larger_title:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller_text:"\u7f29\u5c0f",smaller_title:"\u7f29\u5c0f\u7f16\u8f91\u533a\u57df"},common:{ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88"}}});KISSY.Editor.add("core~plugin",function(f){f.PLUGIN_TYPE={CUSTOM:0,TOOLBAR_SEPARATOR:1,TOOLBAR_BUTTON:2,TOOLBAR_MENU_BUTTON:4,TOOLBAR_SELECT:8,STATUSBAR_ITEM:16,FUNC:32}});
KISSY.Editor.add("core~dom",function(f){var o=YAHOO.env.ua;f.Dom={getText:function(g){return g?g.textContent||"":""},setItemUnselectable:function(g){var a,j,h,c,i;a=g.getElementsByTagName("*");j=-1;for(h=a.length;j<h;++j){i=j==-1?g:a[j];(c=i.nodeName)&&c!="INPUT"&&i.setAttribute("unselectable","on")}return g},BLOCK_ELEMENTS:{blockquote:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,p:1,address:1,center:1,pre:1,form:1,fieldset:1,caption:1,table:1,tbody:1,tr:1,th:1,td:1,ul:1,ol:1,dl:1,dt:1,dd:1,li:1}};
if(o.ie)f.Dom.getText=function(g){return g?g.innerText||"":""}});
KISSY.Editor.add("core~color",function(f){var o=parseInt,g=RegExp;f.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(a){this.re_RGB.test(a)||(a=this.toHex(a));if(this.re_hex.exec(a))a=
"rgb("+[o(g.$1,16),o(g.$2,16),o(g.$3,16)].join(", ")+")";return a},toHex:function(a){a=this.KEYWORDS[a]||a;if(this.re_RGB.exec(a)){a=(g.$1>>0).toString(16);var j=(g.$2>>0).toString(16),h=(g.$3>>0).toString(16);a=[a.length==1?"0"+a:a,j.length==1?"0"+j:j,h.length==1?"0"+h:h].join("")}if(a.length<6)a=a.replace(this.re_hex3,"$1$1");if(a!=="transparent"&&a.indexOf("#")<0)a="#"+a;return a.toLowerCase()},int2hex:function(a){a>>=0;return this.toHex("rgb("+(a&255)+","+(a>>8&255)+","+(a>>16&255)+")")}}});
KISSY.Editor.add("core~command",function(f){var o=YAHOO.env.ua,g={backColor:o.gecko?"hiliteColor":"backColor"};f.Command={exec:function(a,j,h,c){j=g[j]||j;this._preExec(a,j,c);a.execCommand(j,false,h)},_preExec:function(a,j,h){if(o.gecko){j=typeof h==="undefined"?"bold,italic,underline,strikeThrough".indexOf(j)===-1:h;a.execCommand("styleWithCSS",false,j)}}}});
KISSY.Editor.add("core~range",function(f){var o=YAHOO.env.ua.ie;f.Range={getSelectionRange:function(g){var a=g.document,j;if(g.getSelection){g=g.getSelection();if(g.getRangeAt)j=g.getRangeAt(0);else{j=a.createRange();j.setStart(g.anchorNode,g.anchorOffset);j.setEnd(g.focusNode,g.focusOffset)}}else if(a.selection)j=a.selection.createRange();return j},getCommonAncestor:function(g){return g.startContainer||g.parentElement&&g.parentElement()||g.commonParentElement&&g.commonParentElement()},getSelectedText:function(g){if("text"in
g)return g.text;return g.toString?g.toString():""},saveRange:function(g){o&&g.contentWin.focus();return g.getSelectionRange()}}});
KISSY.Editor.add("core~instance",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.lang,h=YAHOO.env.ua,c=h.ie;f.Instance=function(i,d){this.textarea=g.get(i);this.config=j.merge(f.config,d||{});this.sourceMode=false;this.toolbar=new f.Toolbar(this);this.statusbar=new f.Statusbar(this);this._init()};j.augmentObject(f.Instance.prototype,{_init:function(){this._renderUI();this._initPlugins();this._initAutoFocus()},_renderUI:function(){this._renderContainer();this._setupContentPanel()},_initPlugins:function(){var i,
d;d=f.plugins;var e=[];for(i in d)e[i]=j.merge(d[i]);this.plugins=e;this.toolbar.init();this.statusbar.init();for(i in e){d=e[i];if(!d.inited)if(d.type===f.PLUGIN_TYPE.FUNC){d.editor=this;d.init&&d.init();d.inited=true}}},_renderContainer:function(){var i=this.textarea,d=g.getRegion(i),e=d.right-d.left-2+"px",m=d.bottom-d.top-2+"px";d=document.createElement("div");d.className="ks-editor";d.style.width=e;d.innerHTML='<div class="ks-editor-toolbar"></div><div class="ks-editor-content"><iframe frameborder="0" allowtransparency="1"></iframe></div><div class="ks-editor-statusbar"></div>';
e=d.childNodes[1];e.style.width="100%";e.style.height=m;e=e.childNodes[0];e.style.width="100%";e.style.height="100%";e.setAttribute("frameBorder",0);i.style.display="none";g.insertBefore(d,i);this.container=d;this.toolbar.domEl=d.childNodes[0];this.contentWin=e.contentWindow;this.contentDoc=e.contentWindow.document;this.statusbar.domEl=d.childNodes[2]},_setupContentPanel:function(){var i=this.contentDoc,d=this.config;d=d.base+"themes/"+d.theme+"/"+("content"+(d.debug?"":"-min")+".css");var e=this;
i.open();i.write('<!doctype html><html><head><title>Rich Text Area</title><meta charset="charset=gbk" /><link href="{CONTENT_CSS}" rel="stylesheet" /></head><body spellcheck="false" class="ks-editor-post">{CONTENT}</body></html>'.replace("{CONTENT_CSS}",d).replace("{CONTENT}",this.textarea.value));i.close();if(c)i.body.contentEditable="true";else i.designMode="on";c&&a.on(i,"click",function(){i.activeElement.parentNode.nodeType===9&&e._focusToEnd()})},_initAutoFocus:function(){this.config.autoFocus&&
this._focusToEnd()},_focusToEnd:function(){this.contentWin.focus();var i=this.contentDoc.body.lastChild,d=f.Range.getSelectionRange(this.contentWin);if(h.ie){try{d.moveToElementText(i)}catch(e){}d.collapse(false);d.select()}else{try{d.setEnd(i,i.childNodes.length)}catch(m){}d.collapse(false)}},focus:function(){this._focusToEnd()},execCommand:function(i,d,e){this.contentWin.focus();f.Command.exec(this.contentDoc,i,d,e)},getData:function(){if(this.sourceMode)return this.textarea.value;return this.getContentDocData()},
getContentDocData:function(){var i="",d=f.plugins.save;i=this.contentDoc.body.innerHTML;if(i=="<br>")i="";if(d&&d.filterData)i=d.filterData(i);return i},getSelectionRange:function(){return f.Range.getSelectionRange(this.contentWin)}})});
KISSY.Editor.add("core~toolbar",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.lang,h=YAHOO.env.ua.ie,c=h===6,i=f.PLUGIN_TYPE,d=document.createElement("div");f.Toolbar=function(e){this.editor=e;this.config=e.config;this.lang=f.lang[this.config.language];this.items=[];this.stateItems=[]};j.augmentObject(f.Toolbar.prototype,{init:function(){for(var e=this.config.toolbar,m=this.editor.plugins,l,b=0,k=e.length;b<k;++b)if(l=e[b]){if(l in m){l=m[l];this._addItem(l);this.items.push(l);"fontName,fontSize,bold,italic,underline,strikeThroughinsertOrderedList,insertUnorderedListjustifyLeft,justifyCenter,justifyRight".indexOf(l.name)!==
-1&&this.stateItems.push(l)}}else this._addSeparator();this._initUpdateState()},_addItem:function(e){var m,l=e.type;m=this.lang;if(!e.lang)e.lang=j.merge(m.common,this.lang[e.name]||{});m='<div class="ks-editor-toolbar-button ks-inline-block" title="{TITLE}"><div class="ks-editor-toolbar-button-outer-box"><div class="ks-editor-toolbar-button-inner-box"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div></div></div>'.replace("{TITLE}",e.lang.title||"").replace("{NAME}",
e.name).replace("{TEXT}",e.lang.text||"");if(c)m=m.replace("outer-box","outer-box ks-inline-block").replace("inner-box","inner-box ks-inline-block");d.innerHTML=m;e.domEl=m=d.firstChild;if(l==i.TOOLBAR_MENU_BUTTON||l==i.TOOLBAR_SELECT){this._renderMenuButton(e);l==i.TOOLBAR_SELECT&&this._renderSelect(e)}this._bindItemUI(e);this._addToToolbar(m);e.editor=this.editor;e.init&&e.init();e.inited=true},_renderMenuButton:function(e){var m=e.domEl,l=m.getElementsByTagName("span")[0].parentNode;g.addClass(m,
"ks-editor-toolbar-menu-button");l.innerHTML='<div class="ks-editor-toolbar-menu-button-caption ks-inline-block"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div><div class="ks-editor-toolbar-menu-button-dropdown ks-inline-block"></div>'.replace("{NAME}",e.name).replace("{TEXT}",e.lang.text||"")},_renderSelect:function(e){g.addClass(e.domEl,"ks-editor-toolbar-select")},_bindItemUI:function(e){var m=e.domEl;e.exec&&a.on(m,"click",function(){e.exec()});a.on(m,"mousedown",
function(){g.addClass(m,"ks-editor-toolbar-button-active")});a.on(m,"mouseup",function(){g.removeClass(m,"ks-editor-toolbar-button-active")});a.on(m,"mouseout",function(l){l=a.getRelatedTarget(l);var b;try{if(m.contains)b=m.contains(l);else if(m.compareDocumentPosition)b=m.compareDocumentPosition(l)&8}catch(k){b=false}b||g.removeClass(m,"ks-editor-toolbar-button-active")});if(c){a.on(m,"mouseenter",function(){g.addClass(m,"ks-editor-toolbar-button-hover")});a.on(m,"mouseleave",function(){g.removeClass(m,
"ks-editor-toolbar-button-hover")})}},_addSeparator:function(){d.innerHTML='<div class="ks-editor-stripbar-sep ks-inline-block"></div>';this._addToToolbar(d.firstChild)},_addToToolbar:function(e){if(h)e=f.Dom.setItemUnselectable(e);this.domEl.appendChild(e)},_initUpdateState:function(){var e=this.editor.contentDoc,m=this;a.on(e,"click",function(){m.updateState()});a.on(e,"keyup",function(l){l=l.keyCode;if(l>=33&&l<=40||l===8||l===13||l===46)m.updateState()})},updateState:function(e){var m=this.stateItems,
l;e=e?e.join("|"):"";for(var b=0,k=m.length;b<k;b++){l=m[b];e&&e.indexOf(l.name)===-1||(l.updateState?l.updateState():this.updateItemState(l))}},updateItemState:function(e){var m=this.editor.contentDoc;try{if(m.queryCommandEnabled(e.name))m.queryCommandState(e.name)?g.addClass(e.domEl,"ks-editor-toolbar-button-selected"):g.removeClass(e.domEl,"ks-editor-toolbar-button-selected")}catch(l){}}})});
KISSY.Editor.add("core~statusbar",function(f){var o=YAHOO.lang,g=YAHOO.env.ua.ie,a=document.createElement("div");f.Statusbar=function(j){this.editor=j;this.config=j.config;this.lang=f.lang[this.config.language]};o.augmentObject(f.Statusbar.prototype,{init:function(){for(var j=this.config.statusbar,h=this.editor.plugins,c,i=0,d=j.length;i<d;++i)if(c=j[i])c in h&&this._addItem(h[c]);else this._addSep()},_addItem:function(j){var h;h=this.lang;if(!j.lang)j.lang=o.merge(h.common,this.lang[j.name]||{});
a.innerHTML='<div class="ks-editor-statusbar-item ks-editor-{NAME} ks-inline-block"></div>'.replace("{NAME}",j.name);j.domEl=h=a.firstChild;this._addToToolbar(h);j.editor=this.editor;j.init&&j.init();j.inited=true},_addSep:function(){a.innerHTML='<div class="ks-editor-stripbar-sep kissy-inline-block"></div>';this._addToToolbar(a.firstChild)},_addToToolbar:function(j){if(g)j=f.Dom.setItemUnselectable(j);this.domEl.appendChild(j)}})});
KISSY.Editor.add("core~menu",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.env.ua,h;f.Menu={generateDropMenu:function(c,i,d){var e=document.createElement("div"),m=this;e.innerHTML='<div class="ks-editor-drop-menu-shadow"></div><div class="ks-editor-drop-menu-content"></div>';e.className="ks-editor-drop-menu";e.style.display="none";document.body.appendChild(e);a.on(i,"click",function(l){a.stopPropagation(l);c.activeDropMenu&&m._hide(c);if(c.activeDropMenu!=e){m._setDropMenuPosition(i,e,d);
c.activeDropMenu=e;c.activeDropButton=i;m._show(c)}else{c.activeDropMenu=null;c.activeDropButton=null}});a.on([document,c.contentDoc],"click",function(){if(c.activeDropMenu){m.hideActiveDropMenu(c);this==c.contentDoc&&c.contentWin.focus()}});this._initResizeEvent(i,e,d);return e.childNodes[1]},_setDropMenuPosition:function(c,i,d){var e=g.getRegion(c);c=e.left;e=e.bottom;if(d){c+=d[0];e+=d[1]}i.style.left=c+"px";i.style.top=e+"px"},_isVisible:function(c){if(!c)return false;return c.style.display!=
"none"},hideActiveDropMenu:function(c){this._hide(c);c.activeDropMenu=null;c.activeDropButton=null},_hide:function(c){var i=c.activeDropMenu;c=c.activeDropButton;if(i){h&&(h.style.display="none");i.style.display="none"}c&&g.removeClass(c,"ks-editor-toolbar-button-selected")},_show:function(c){var i=c.activeDropMenu;c=c.activeDropButton;if(i){i.style.display="";if(j.ie===6){this._updateShimRegion(i);h.style.display=""}}c&&g.addClass(c,"ks-editor-toolbar-button-selected")},_updateShimRegion:function(c){if(c)if(j.ie===
6){h||this._initShim();this._setShimRegion(c)}},_initResizeEvent:function(c,i,d){var e=this,m;a.on(window,"resize",function(){m&&clearTimeout(m);m=setTimeout(function(){e._isVisible(i)&&e._setDropMenuPosition(c,i,d)},50)})},_initShim:function(){h=document.createElement("iframe");h.src="about:blank";h.className="ks-editor-drop-menu-shim";h.style.position="absolute";h.style.display="none";h.style.border="none";document.body.appendChild(h)},_setShimRegion:function(c){if(h&&this._isVisible(c)){c=g.getRegion(c);
if(c.width>0){h.style.left=c.left+"px";h.style.top=c.top+"px";h.style.width=c.width-1+"px";h.style.height=c.height-1+"px"}}}}});KISSY.Editor.add("smilies~config~default",function(f){f.Smilies=f.Smilies||{};f.Smilies["default"]={name:"default",mode:"icons",cols:5,fileNames:["smile","confused","cool","cry","eek","angry","wink","sweat","lol","stun","razz","shy","rolleyes","sad","happy","yes","no","heart","idea","rose"],fileExt:"gif"}});
KISSY.Editor.add("smilies~config~wangwang",function(f){f.Smilies=f.Smilies||{};f.Smilies.wangwang={name:"wangwang",mode:"sprite",base:"http://a.tbcdn.cn/sys/wangwang/smiley/48x48/",spriteStyle:"background: url(http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png) no-repeat -1px 0; width: 288px; height: 235px",unitStyle:"width: 24px; height: 24px",filePattern:{start:0,end:98,step:1},fileExt:"gif"}});
KISSY.Editor.add("plugins~base",function(f){var o=f.PLUGIN_TYPE;f.addPlugin("bold,italic,underline,strikeThrough,insertOrderedList,insertUnorderedList".split(","),{type:o.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~color",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.env.ua.ie,h=["000","444","666","999","CCC","EEE","F3F3F3","FFF"],c=["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],i=["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000",
"B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"];f.addPlugin(["foreColor","backColor"],{type:f.PLUGIN_TYPE.TOOLBAR_MENU_BUTTON,color:"",_indicator:null,swatches:null,dropMenu:null,range:null,init:function(){var d=this.domEl,e=d.getElementsByTagName("span")[0].parentNode;this.color=this._getDefaultColor();g.addClass(d,"ks-editor-toolbar-color-button");e.innerHTML='<div class="ks-editor-toolbar-color-button-indicator" style="border-bottom-color:'+
this.color+'">'+e.innerHTML+"</div>";this._indicator=e.firstChild;this._renderUI();this._bindUI();this.swatches=g.getElementsByClassName("ks-editor-palette-colorswatch","div",this.dropMenu)},_renderUI:function(){this.dropMenu=f.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._generatePalettes();j&&f.Dom.setItemUnselectable(this.dropMenu)},_bindUI:function(){this._bindPickEvent();a.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();j&&this.editor.contentDoc.selection.empty();
this._updateSelectedColor(this.color)},this,true)},_generatePalettes:function(){var d="";d+=this._getPaletteTable(h);d+=this._getPaletteTable(c);d+=this._getPaletteTable(i);this.dropMenu.innerHTML=d},_getPaletteTable:function(d){var e,m=d.length,l,b="<tr>";e=0;for(m=d.length;e<m;++e){if(e!=0&&e%8==0)b+="</tr><tr>";l=f.Color.toRGB("#"+d[e]).toUpperCase();b+='<td class="ks-editor-palette-cell"><div class="ks-editor-palette-colorswatch" title="{COLOR}" style="background-color:{COLOR}"></div></td>'.replace(/{COLOR}/g,
l)}b+="</tr>";return'<div class="ks-editor-palette-table"><table><tbody>{TR}</tbody></table></div>'.replace("{TR}",b)},_bindPickEvent:function(){var d=this;a.on(this.dropMenu,"click",function(e){var m=a.getTarget(e).getAttribute("title");m&&m.indexOf("RGB")===0&&d._doAction(m);a.stopPropagation(e);f.Menu.hideActiveDropMenu(d.editor)})},_doAction:function(d){if(d){this.setColor(f.Color.toHex(d));d=this.range;j&&d.select&&d.select();this.editor.execCommand(this.name,this.color)}},setColor:function(d){this.color=
d;this._updateIndicatorColor(d);this._updateSelectedColor(d)},_updateIndicatorColor:function(d){this._indicator.style.borderBottomColor=d},_updateSelectedColor:function(d){var e,m,l,b=this.swatches;e=0;for(m=b.length;e<m;++e){l=b[e];f.Color.toHex(l.style.backgroundColor)==d?g.addClass(l.parentNode,"ks-editor-palette-cell-selected"):g.removeClass(l.parentNode,"ks-editor-palette-cell-selected")}},_getDefaultColor:function(){return this.name=="foreColor"?"#000000":"#ffffff"}})});
KISSY.Editor.add("plugins~font",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.env.ua,h={"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7};f.addPlugin(["fontName","fontSize"],{type:f.PLUGIN_TYPE.TOOLBAR_SELECT,selectedValue:"",selectHead:null,selectList:null,options:[],items:null,selectedItem:null,range:null,init:function(){this.options=this.lang.options;this.selectHead=this.domEl.getElementsByTagName("span")[0];this._renderUI();this._bindUI()},_renderUI:function(){this.selectList=
f.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._renderSelectList();this.items=this.selectList.getElementsByTagName("li")},_bindUI:function(){this._bindPickEvent();a.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();j.ie&&this.editor.contentDoc.selection.empty();if(this.selectedValue)this._updateSelectedOption(this.selectedValue);else if(this.selectedItem){g.removeClass(this.selectedItem,"ks-editor-option-selected");this.selectedItem=null}},this,true)},_renderSelectList:function(){var c=
"",i=this.options,d,e;for(d in i){e=i[d];c+='<li class="ks-editor-option" data-value="{VALUE}"><span class="ks-editor-option-checkbox"></span><span style="{STYLE}">{KEY}</span></li>'.replace("{VALUE}",e).replace("{STYLE}",this._getOptionStyle(d,e)).replace("{KEY}",d)}this.selectList.innerHTML='<ul class="ks-editor-select-list">{LI}</ul>'.replace("{LI}",c);g.addClass(this.selectList,"ks-editor-drop-menu-"+this.name)},_bindPickEvent:function(){var c=this;a.on(this.selectList,"click",function(i){var d=
a.getTarget(i);if(d.nodeName!="LI")d=g.getAncestorByTagName(d,"li");if(d){c._doAction(d.getAttribute("data-value"));a.stopPropagation(i);f.Menu.hideActiveDropMenu(c.editor)}});if(j.ie===6){a.on(this.items,"mouseenter",function(){g.addClass(this,"ks-editor-option-hover")});a.on(this.items,"mouseleave",function(){g.removeClass(this,"ks-editor-option-hover")})}},_doAction:function(c){if(c){this.selectedValue=c;this._setOption(c);c=this.range;j.ie&&c.select&&c.select();this.editor.execCommand(this.name,
this.selectedValue)}},_setOption:function(c){this._updateHeadText(this._getOptionKey(c));this._updateSelectedOption(c)},_getOptionStyle:function(c,i){return this.name=="fontName"?"font-family:"+i:"font-size:"+c+"px"},_getOptionKey:function(c){var i=this.options,d;for(d in i)if(i[d]==c)return d;return null},_updateHeadText:function(c){this.selectHead.innerHTML=c},_updateSelectedOption:function(c){var i=this.items,d,e=i.length,m;for(d=0;d<e;++d){m=i[d];if(m.getAttribute("data-value")==c){g.addClass(m,
"ks-editor-option-selected");this.selectedItem=m}else g.removeClass(m,"ks-editor-option-selected")}},updateState:function(){var c=this.editor.contentDoc,i=this.options,d=this.name,e,m;try{if(c.queryCommandEnabled(d)){m=c.queryCommandValue(d);if(j.webkit&&d=="fontSize")m=this._getWebkitFontSize(m);m&&(e=this._getOptionKey(m));if(e in i){if(m!=this.selectedValue){this.selectedValue=m;this._updateHeadText(e)}}else{this.selectedValue="";this._updateHeadText(this.lang.text)}}}catch(l){}},_getWebkitFontSize:function(c){if(c in
h)return h[c];return null}})});
KISSY.Editor.add("plugins~image",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=o.Connect,h=YAHOO.lang,c=YAHOO.env.ua,i=c.ie,d="ks-editor-image-tab-selected",e=/^(?:.*?:\/\/)?(.*?)\/.*$/,m={local:'<li rel="local" class="'+d+'">{tab_local}</li>',link:'<li rel="link">{tab_link}</li>',album:'<li rel="album">{tab_album}</li>'},l={tabs:["link"],upload:{actionUrl:"",filter:"png|gif|jpg|jpeg",filterMsg:"",linkFilter:"",linkFilterMsg:"",enableXdr:false,connectionSwf:"http://a.tbcdn.cn/yui/2.8.0r4/build/connection/connection.swf",formatResponse:function(b){var k=
[];for(var n in b)k.push(b[n]);return k},extraCode:""}};f.addPlugin("image",{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,form:null,range:null,currentTab:null,currentPanel:null,uploadingPanel:null,actionsBar:null,init:function(){var b=this.editor.config.pluginsConfig[this.name]||{};l.upload.filterMsg=this.lang.upload_filter;l.upload.linkFilterMsg=this.lang.upload_linkFilter;this.config=h.merge(l,b);this.config.upload=h.merge(l.upload,b.upload||{});this._renderUI();this._bindUI();this.actionsBar=
g.getElementsByClassName("ks-editor-dialog-actions","div",this.dialog)[0];this.uploadingPanel=g.getElementsByClassName("ks-editor-image-uploading","div",this.dialog)[0];this.config.upload.enableXdr&&this._initXdrUpload()},_renderUI:function(){var b=f.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),k=this.lang;k.local_extraCode=this.config.upload.extraCode;b.className+=" ks-editor-image";b.innerHTML='<form action="javascript: void(0)"><ul class="ks-editor-image-tabs ks-clearfix"></ul><div class="ks-editor-image-tab-content" rel="local" style="display: none"><label>{label_local}</label><input type="file" size="40" name="imgFile" unselectable="on" />{local_extraCode}</div><div class="ks-editor-image-tab-content" rel="link"><label>{label_link}</label><input name="imgUrl" size="50" /></div><div class="ks-editor-image-tab-content" rel="album" style="display: none"><label>{label_album}</label><p style="width: 300px">\u5c1a\u672a\u5b9e\u73b0...</p></div><div class="ks-editor-image-uploading" style="display: none"><p style="width: 300px">{uploading}</p></div><div class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span></div></form>'.replace(/\{([^}]+)\}/g,
function(n,p){return p in k?k[p]:p});this.dialog=b;this.form=b.getElementsByTagName("form")[0];i&&f.Dom.setItemUnselectable(b);this._renderTabs()},_renderTabs:function(){function b(y){for(var u=0,z=y.getAttribute("rel"),v=0;v<A;v++){w[v]&&g.removeClass(w[v],d);q[v].style.display="none";if(q[v].getAttribute("rel")==z)u=v}c.ie===6&&f.Menu._updateShimRegion(n.dialog);g.addClass(y,d);q[u].style.display="";n.currentTab=y.getAttribute("rel");n.currentPanel=q[u]}for(var k=this.lang,n=this,p=g.getElementsByClassName("ks-editor-image-tabs",
"ul",this.dialog)[0],q=g.getElementsByClassName("ks-editor-image-tab-content","div",this.dialog),r=this.config.tabs,s="",t=0,x=r.length;t<x;t++)s+=m[r[t]];p.innerHTML=s.replace(/\{([^}]+)\}/g,function(y,u){return u in k?k[u]:u});var w=p.childNodes,A=q.length;w.length===1&&g.addClass(this.dialog,"ks-editor-image-no-tab");b(w[0]);a.on(w,"click",function(){b(this)})},_bindUI:function(){var b=this;a.on(this.domEl,"click",function(){if(b.dialog.style.visibility===i?"hidden":"visible")b._syncUI()});a.on(this.dialog,
"click",function(k){var n=a.getTarget(k),p=b.currentTab;switch(n.className){case "ks-editor-btn-ok":if(p==="local"){a.stopPropagation(k);b._insertLocalImage()}else b._insertWebImage();break;case "ks-editor-btn-cancel":break;default:a.stopPropagation(k)}})},_initXdrUpload:function(){for(var b=this.config.tabs,k=0,n=b.length;k<n;k++)if(b[k]==="local"){j.transport(this.config.upload.connectionSwf);break}},_insertLocalImage:function(){var b=this.form,k=this.config.upload,n=b.imgFile.value,p=k.actionUrl,
q=this;if(n&&p){if(k.filter!=="*"){n=n.substring(n.lastIndexOf(".")+1).toLowerCase();if(k.filter.indexOf(n)==-1){alert(k.filterMsg);q.form.reset();return}}this.uploadingPanel.style.display="";this.currentPanel.style.display="none";this.actionsBar.style.display="none";c.ie===6&&f.Menu._updateShimRegion(this.dialog);j.setForm(b,true);j.asyncRequest("post",p,{upload:function(r){try{var s=k.formatResponse(h.JSON.parse(r.responseText));if(s[0]=="0"){q._insertImage(s[1]);q._hideDialog()}else q._onUploadError(s[1])}catch(t){q._onUploadError(h.dump(t)+
"\no = "+h.dump(r)+"\n[from upload catch code]")}},xdr:k.enableXdr})}else q._hideDialog()},_onUploadError:function(b){alert(this.lang.upload_error+"\n\n"+b);this._hideDialog()},_insertWebImage:function(){var b=this.form.imgUrl.value||"",k=this.config.upload,n=k.linkFilter,p,q;if(p=e.exec(b))q=p[1];if(b&&q){if(n&&n!=="*")if(("|"+n.toLowerCase()+"|").indexOf("|"+q.toLowerCase()+"|")===-1){alert(k.linkFilterMsg);return}this._insertImage(b)}},_hideDialog:function(){var b=this.editor.activeDropMenu;b&&
g.isAncestor(b,this.dialog)&&f.Menu.hideActiveDropMenu(this.editor);this.editor.contentWin.focus()},_syncUI:function(){this.range=f.Range.saveRange(this.editor);this.form.reset();this.uploadingPanel.style.display="none";this.currentPanel.style.display="";this.actionsBar.style.display=""},_insertImage:function(b,k){b=h.trim(b);if(b.length!==0){var n=this.editor,p=this.range;if(window.getSelection){var q=n.contentDoc.createElement("img");q.src=b;k&&q.setAttribute("alt",k);p.deleteContents();p.insertNode(q);
if(c.webkit){k=n.contentWin.getSelection();k.addRange(p);k.collapseToEnd()}else p.setStartAfter(q);n.contentWin.focus()}else if(document.selection){n.contentWin.focus();if("text"in p){p.select();n='<img src="'+b+'"';k&&(n+=' "alt="'+k+'"');n+=">";p.pasteHTML(n)}else p.execCommand("insertImage",false,b)}}}})});KISSY.Editor.add("plugins~indent",function(f){f.addPlugin(["indent","outdent"],{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~justify",function(f){var o=["justifyLeft","justifyCenter","justifyRight"];f.addPlugin(o,{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState(o)}})});
KISSY.Editor.add("plugins~keystroke",function(f){var o=YAHOO.util.Event,g=YAHOO.env.ua;f.addPlugin("keystroke",{type:f.PLUGIN_TYPE.FUNC,init:function(){var a=this.editor;g.ie&&g.ie<8&&o.on(a.contentDoc,"keydown",function(h){h.keyCode==9&&this.selection.empty()});var j=a.textarea.form;j&&(new YAHOO.util.KeyListener(a.contentDoc,{ctrl:true,keys:13},{fn:function(){if(!a.sourceMode)a.textarea.value=a.getData();j.submit()}})).enable()}})});
KISSY.Editor.add("plugins~link",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.lang,h=YAHOO.env.ua,c=h.ie;o=f.PLUGIN_TYPE;var i=f.Range,d=(new Date).getTime(),e=/^\w+:\/\/.*|#.*$/,m=['<form onsubmit="return false"><ul><li class="ks-editor-link-href"><label>{href}</label><input name="href" style="width: 220px" value="http://" type="text" /></li><li class="ks-editor-link-target"><input name="target" id="target_"',d,' type="checkbox" /> <label for="target_"',d,'>{target}</label></li><li class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span><span class="ks-editor-link-remove">{remove}</span></li></ul></form>'].join("");
f.addPlugin("link",{type:o.TOOLBAR_BUTTON,dialog:null,form:null,range:null,init:function(){this._renderUI();this._bindUI()},_renderUI:function(){var l=f.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),b=this.lang;l.className+=" ks-editor-link";l.innerHTML=m.replace(/\{([^}]+)\}/g,function(k,n){return b[n]?b[n]:n});this.dialog=l;this.form=l.getElementsByTagName("form")[0];h.webkit&&(this.form.target.parentNode.style.display="none");c&&f.Dom.setItemUnselectable(l)},_bindUI:function(){var l=this.form,
b=this;a.on(this.domEl,"click",function(){if(b.dialog.style.visibility===c?"hidden":"visible")b._syncUI()});a.on(this.dialog,"click",function(k){switch(a.getTarget(k).className){case "ks-editor-btn-ok":b._createLink(l.href.value,l.target.checked);break;case "ks-editor-btn-cancel":break;case "ks-editor-link-remove":b._unLink();break;default:a.stopPropagation(k)}})},_syncUI:function(){this.range=f.Range.saveRange(this.editor);var l=this.form,b;b=i.getCommonAncestor(this.range);if(b=b.nodeName=="A"?
b:g.getAncestorByTagName(b,"A")){l.href.value=b.href;l.target.checked=b.target==="_blank";g.removeClass(l,"ks-editor-link-newlink-mode")}else{l.href.value="http://";l.target.checked=false;g.addClass(l,"ks-editor-link-newlink-mode")}setTimeout(function(){l.href.select()},50)},_createLink:function(l,b){l=this._getValidHref(l);if(l.length===0)this._unLink();else{var k=this.range,n=document.createElement("div"),p;p=i.getCommonAncestor(k);if(p=p.nodeName=="A"?p:g.getAncestorByTagName(p,"A")){p.href=l;
b?p.setAttribute("target","_blank"):p.removeAttribute("target")}else{p=document.createElement("a");p.href=l;b&&p.setAttribute("target","_blank");if(c){k.select&&k.select();if("text"in k){p.innerHTML=k.htmlText||l;n.innerHTML="";n.appendChild(p);k.pasteHTML(n.innerHTML)}else this.editor.execCommand("createLink",l)}else if(h.webkit)this.editor.execCommand("createLink",l);else{if(k.collapsed)p.innerHTML=l;else for(l=k.cloneContents();l.firstChild;)p.appendChild(l.firstChild);k.deleteContents();k.insertNode(p);
k.selectNode(p)}}}},_getValidHref:function(l){if((l=j.trim(l))&&!e.test(l))l="http://"+l;return l},_unLink:function(){var l=this.editor,b=this.range,k=i.getSelectedText(b),n=i.getCommonAncestor(b);if(!k&&n.nodeType==3){l=n.parentNode;l.nodeName=="A"&&l.parentNode.replaceChild(n,l)}else{b.select&&b.select();l.execCommand("unLink",null)}}})});
KISSY.Editor.add("plugins~resize",function(f){var o=YAHOO.util.Event;f.addPlugin("resize",{type:f.PLUGIN_TYPE.STATUSBAR_ITEM,contentEl:null,currentHeight:0,init:function(){this.contentEl=this.editor.container.childNodes[1];this.currentHeight=parseInt(this.contentEl.style.height);this.renderUI();this.bindUI()},renderUI:function(){var g=this.lang;this.domEl.innerHTML='<span class="ks-editor-resize-larger" title="{larger_title}">{larger_text}</span><span class="ks-editor-resize-smaller" title="{smaller_title}">{smaller_text}</span>'.replace(/\{([^}]+)\}/g,
function(a,j){return g[j]?g[j]:j})},bindUI:function(){var g=this.domEl.getElementsByTagName("span"),a=g[1];o.on(g[0],"click",function(){this.currentHeight+=100;this._doResize()},this,true);o.on(a,"click",function(){if(this.currentHeight<100)this.currentHeight=0;else this.currentHeight-=100;this._doResize()},this,true)},_doResize:function(){this.contentEl.style.height=this.currentHeight+"px";this.editor.textarea.style.height=this.currentHeight+"px"}})});
KISSY.Editor.add("plugins~save",function(f){var o=YAHOO.util.Event,g={b:{tag:"strong"},i:{tag:"em"},u:{tag:"span",style:"text-decoration:underline"},strike:{tag:"span",style:"text-decoration:line-through"}};f.addPlugin("save",{type:f.PLUGIN_TYPE.FUNC,init:function(){var a=this.editor,j=a.textarea,h=j.form;h&&o.on(h,"submit",function(){if(!a.sourceMode)j.value=a.getData()})},filterData:function(a){a=a.replace(/<(\/?)([^>\s]+)([^>]*)>/g,function(j,h,c,i){c=c.toLowerCase();j=g[c];c=c;if(j&&!i){c=j.tag;
if(!h&&j.style)c+=' style="'+j.style+'"'}return"<"+h+c+i+">"});if(a.indexOf("mso")>0)a=this.filterWord(a);return a},filterWord:function(a){a=a.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3");a=a.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3");a=a.replace(/<H(\d)([^>]*)>/gi,"<h$1>");a=a.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>");a=a.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");a=a.replace(/<meta[^>]*>/ig,"");a=a.replace(/<link rel="\S+" href="file:[^>]*">/ig,
"");a=a.replace(/<!--\[if gte mso [0-9]{1,2}\]>[\s\S]*?<!\[endif\]--\>/ig,"");a=a.replace(/<style>[\s\S]*?mso[\s\S]*?<\/style>/ig,"");a=a.replace(/ lang=".+?"/ig,"");a=a.replace(/<o:p><\/o:p>/ig,"");a=a.replace(/ class="Mso.+?"/ig,"");return a=a.replace(/<\\?\?xml[^>]*>/ig,"")}})});
KISSY.Editor.add("plugins~smiley",function(f){var o=YAHOO.util.Event,g=YAHOO.lang,a=YAHOO.env.ua,j={tabs:["default"]};f.addPlugin("smiley",{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,range:null,init:function(){this.config=g.merge(j,this.editor.config.pluginsConfig[this.name]||{});this._renderUI();this._bindUI()},_renderUI:function(){var h=f.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);h.className+=" ks-editor-smiley-dialog";this.dialog=h;this._renderDialog();a.ie&&f.Dom.setItemUnselectable(h)},
_renderDialog:function(){var h=f.Smilies[this.config.tabs[0]],c=h.mode;if(c==="icons")this._renderIcons(h);else c==="sprite"&&this._renderSprite(h)},_renderIcons:function(h){var c=this.editor.config.base+"smilies/"+h.name+"/",i=h.fileNames,d="."+h.fileExt;h=h.cols;var e=[],m,l=i.length,b;e.push('<div class="ks-editor-smiley-icons">');for(m=0;m<l;m++){b=i[m];e.push('<img src="'+c+b+d+'" alt="'+b+'" title="'+b+'" />');m%h===h-1&&e.push("<br />")}e.push("</div");this.dialog.innerHTML=e.join("")},_renderSprite:function(h){var c=
h.base,i=h.filePattern,d="."+h.fileExt,e=i.end+1;i=i.step;var m,l=[];l.push('<div class="ks-editor-smiley-sprite ks-clearfix" style="'+h.spriteStyle+'">');for(m=0;m<e;m+=i)l.push('<span data-icon="'+c+m+d+'" style="'+h.unitStyle+'"></span>');l.push("</div");this.dialog.innerHTML=l.join("")},_bindUI:function(){var h=this;o.on(this.domEl,"click",function(){h.range=f.Range.saveRange(h.editor)});o.on(this.dialog,"click",function(c){var i=o.getTarget(c);switch(i.nodeName){case "IMG":h._insertImage(i.src,
i.getAttribute("alt"));break;case "SPAN":h._insertImage(i.getAttribute("data-icon"),"");break;default:o.stopPropagation(c)}})},_insertImage:function(h,c){h=g.trim(h);if(h.length!==0){var i=this.editor,d=this.range;if(window.getSelection){var e=i.contentDoc.createElement("img");e.src=h;e.setAttribute("alt",c);d.deleteContents();d.insertNode(e);if(a.webkit){h=i.contentWin.getSelection();h.addRange(d);h.collapseToEnd()}else d.setStartAfter(e);i.contentWin.focus()}else if(document.selection)"text"in d?
d.pasteHTML('<img src="'+h+'" alt="'+c+'" />'):i.execCommand("insertImage",h)}}})});
KISSY.Editor.add("plugins~source",function(f){var o=YAHOO.util.Dom,g=YAHOO.env.ua;f.addPlugin("source",{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,init:function(){var a=this.editor;this.iframe=a.contentWin.frameElement;this.textarea=a.textarea;this.iframe.parentNode.appendChild(a.textarea);o.addClass(this.domEl,"ks-editor-toolbar-source-button")},exec:function(){var a=this.editor,j=a.sourceMode;if(j)a.contentDoc.body.innerHTML=this.textarea.value;else this.textarea.value=a.getContentDocData();g.ie&&g.ie<8&&
a.contentDoc.selection.empty();this.textarea.style.display=j?"none":"";this.iframe.style.display=j?"":"none";a.sourceMode=!j;this._updateButtonState()},_updateButtonState:function(){var a=this.editor;if(a.sourceMode){o.addClass(a.container,"ks-editor-src-mode");o.addClass(this.domEl,"ks-editor-toolbar-button-selected")}else{o.removeClass(a.container,"ks-editor-src-mode");o.removeClass(this.domEl,"ks-editor-toolbar-button-selected")}}})});
KISSY.Editor.add("plugins~undo",function(f){f.addPlugin(["undo","redo"],{type:f.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name)}})});
KISSY.Editor.add("plugins~wordcount",function(f){var o=YAHOO.util,g=o.Dom,a=o.Event,j=YAHOO.lang,h={total:5E4,threshold:100};f.addPlugin("wordcount",{type:f.PLUGIN_TYPE.STATUSBAR_ITEM,total:Infinity,remain:Infinity,threshold:0,remainEl:null,init:function(){var c=j.merge(h,this.editor.config.pluginsConfig[this.name]||{});this.total=c.total;this.threshold=c.threshold;this.renderUI();this.bindUI();var i=this;setTimeout(function(){i.syncUI()},50)},renderUI:function(){this.domEl.innerHTML=this.lang.tmpl.replace("%remain%",
"<em>"+this.total+"</em>");this.remainEl=this.domEl.getElementsByTagName("em")[0]},bindUI:function(){var c=this.editor;a.on(c.textarea,"keyup",this.syncUI,this,true);a.on(c.contentDoc,"keyup",this.syncUI,this,true);a.on(c.container,"click",this.syncUI,this,true)},syncUI:function(){this.remain=this.total-this.editor.getData().length;this.remainEl.innerHTML=this.remain;this.remain<=this.threshold?g.addClass(this.domEl,"ks-editor-wordcount-alarm"):g.removeClass(this.domEl,"ks-editor-wordcount-alarm")}})});
