/*
Copyright 2010, KISSY UI Library v1.0.8
MIT Licensed
build: 846 Jul 11 00:09
*/
(function(g,n,e){if(g[n]===e)g[n]={};n=g[n];var b=g.document,i=function(a,d,h,l){if(!d||!a)return a;if(h===e)h=true;var m,o,p;if(l&&(p=l.length))for(m=0;m<p;m++){o=l[m];if(o in d)if(h||!(o in a))a[o]=d[o]}else for(o in d)if(h||!(o in a))a[o]=d[o];return a},j=false,c=[],k=false,f=0;i(n,{id:function(){return f++},version:"1.0.8",_init:function(){this.Env={mods:{}}},add:function(a,d){this.Env.mods[a]={name:a,fn:d};d(this);return this},ready:function(a){k||this._bindReady();j?a.call(g,this):c.push(a);
return this},_bindReady:function(){var a=this,d=b.documentElement.doScroll,h=d?"onreadystatechange":"DOMContentLoaded",l=function(){a._fireReady()};k=true;if(b.readyState==="complete")return l();if(b.addEventListener){var m=function(){b.removeEventListener(h,m,false);l()};b.addEventListener(h,m,false)}else{var o=function(){if(b.readyState==="complete"){b.detachEvent(h,o);l()}};b.attachEvent(h,o);g.attachEvent("onload",l);if(g==g.top){var p=function(){try{d("left");l()}catch(q){setTimeout(p,1)}};p()}}},
_fireReady:function(){if(!j){j=true;if(c){for(var a,d=0;a=c[d++];)a.call(g,this);c=null}}},mix:i,merge:function(){var a={},d,h=arguments.length;for(d=0;d<h;++d)i(a,arguments[d]);return a},augment:function(){var a=arguments,d=a.length-2,h=a[0],l=a[d],m=a[d+1],o=1;if(!n.isArray(m)){l=m;m=e;d++}if(!n.isBoolean(l)){l=e;d++}for(;o<d;o++)i(h.prototype,a[o].prototype||a[o],l,m);return h},extend:function(a,d,h,l){if(!d||!a)return a;var m=Object.prototype,o=d.prototype,p=function(q){function r(){}r.prototype=
q;return new r}(o);a.prototype=p;p.constructor=a;a.superclass=o;if(d!==Object&&o.constructor===m.constructor)o.constructor=d;h&&i(p,h);l&&i(a,l);return a},namespace:function(){var a=arguments.length,d=null,h,l,m;for(h=0;h<a;++h){m=(""+arguments[h]).split(".");d=this;for(l=g[m[0]]===d?1:0;l<m.length;++l)d=d[m[l]]=d[m[l]]||{}}return d},app:function(a,d){var h=g[a]||{};i(h,this,true,["_init","add","namespace"]);h._init();return i(g[a]=h,typeof d==="function"?d():d)},log:function(a,d,h){if(this.Config.debug){if(h)a=
h+": "+a;if(g.console!==e&&console.log)console[d&&console[d]?d:"log"](a)}return this},error:function(a){if(this.Config.debug)throw a;}});n._init();n.Config={debug:"@DEBUG@"}})(window,"KISSY");
KISSY.add("editor",function(g){function n(e,b){var i=n;if(!(this instanceof i))return new i(e,b);i._isReady||i._setup();return new i.Instance(e,b)}g.mix(n,{version:"1.0",lang:{},plugins:{},Env:{mods:{}},add:function(e,b,i){this.Env.mods[e]={name:e,fn:b,details:i||{}};return this},addPlugin:function(e,b){e=typeof e=="string"?[e]:e;var i=this.plugins,j,c,k;c=0;for(k=e.length;c<k;++c){j=e[c];i[j]||(i[j]=g.merge(b,{name:j}))}},_isReady:false,_setup:function(){this._loadModules();this._isReady=true},_attached:{},
_loadModules:function(){var e=KISSY.Editor.Env.mods,b=this._attached,i,j;for(i in e)if(j=e[i]){b[i]=j;j.fn&&j.fn(this)}}});g.Editor=n});
KISSY.Editor.add("config",function(g){g.config={base:"",language:"zh-cn",theme:"default",toolbar:["source","","fontName","fontSize","bold","italic","underline","strikeThrough","foreColor","backColor","","link","smiley","image","","insertOrderedList","insertUnorderedList","outdent","indent","justifyLeft","justifyCenter","justifyRight"],statusbar:["wordcount","resize"],pluginsConfig:{}}});
KISSY.Editor.add("lang~en",function(g){g.lang.en={source:{text:"Source",title:"Source"},undo:{text:"Undo",title:"Undo (Ctrl+Z)"},redo:{text:"Redo",title:"Redo (Ctrl+Y)"},fontName:{text:"Font Name",title:"Font Name",options:{Arial:"Arial","Times New Roman":"Times New Roman","Arial Black":"Arial Black","Arial Narrow":"Arial Narrow","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Garamond:"Garamond",Georgia:"Georgia",Tahoma:"Tahoma","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"}},fontSize:{text:"Size",
title:"Font size",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"Bold",title:"Bold (Ctrl+B)"},italic:{text:"Italic",title:"Italick (Ctrl+I)"},underline:{text:"Underline",title:"Underline (Ctrl+U)"},strikeThrough:{text:"Strikeout",title:"Strikeout"},link:{text:"Link",title:"Insert/Edit link",href:"URL:",target:"Open link in new window",remove:"Remove link"},blockquote:{text:"Blockquote",title:"Insert blockquote"},smiley:{text:"Smiley",title:"Insert smiley"},image:{text:"Image",
title:"Insert image",tab_link:"Web Image",tab_local:"Local Image",tab_album:"Album Image",label_link:"Enter image web address:",label_local:"Browse your computer for the image file to upload:",label_album:"Select the image from your album:",uploading:"Uploading...",upload_error:"Exception occurs when uploading file.",upload_filter:"Only allow PNG, GIF, JPG image type.",upload_linkFilter:"The image link is not in our whitelist. Please upload as local image.",ok:"Insert"},insertOrderedList:{text:"Numbered List",
title:"Numbered List (Ctrl+7)"},insertUnorderedList:{text:"Bullet List",title:"Bullet List (Ctrl+8)"},outdent:{text:"Decrease Indent",title:"Decrease Indent"},indent:{text:"Increase Indent",title:"Increase Indent"},justifyLeft:{text:"Left Justify",title:"Left Justify (Ctrl+L)"},justifyCenter:{text:"Center Justify",title:"Center Justify (Ctrl+E)"},justifyRight:{text:"Right Justify",title:"Right Justify (Ctrl+R)"},foreColor:{text:"Text Color",title:"Text Color"},backColor:{text:"Text Background Color",
title:"Text Background Color"},maximize:{text:"Maximize",title:"Maximize"},removeformat:{text:"Remove Format",title:"Remove Format"},wordcount:{tmpl:"Remain %remain% words (include html code)"},resize:{larger_text:"Larger",larger_title:"Enlarge the editor",smaller_text:"Smaller",smaller_title:"Shrink the editor"},common:{ok:"OK",cancel:"Cancel"}}});
KISSY.Editor.add("lang~zh-cn",function(g){g.lang["zh-cn"]={source:{text:"\u0534\ufffd\ufffd",title:"\u0534\ufffd\ufffd"},undo:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd"},redo:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd"},fontName:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd",options:{"\ufffd\ufffd\ufffd\ufffd":"\ufffd\ufffd\ufffd\ufffd","\ufffd\ufffd\ufffd\ufffd":"\ufffd\ufffd\ufffd\ufffd","\ufffd\ufffd\ufffd\ufffd":"\ufffd\ufffd\ufffd\ufffd",
"\ufffd\ufffd\ufffd\ufffd":"\ufffd\ufffd\ufffd\ufffd_GB2312","\u03a2\ufffd\ufffd\ufffd\u017a\ufffd":"\u03a2\ufffd\ufffd\ufffd\u017a\ufffd",Georgia:"Georgia","Times New Roman":"Times New Roman",Impact:"Impact","Courier New":"Courier New",Arial:"Arial",Verdana:"Verdana",Tahoma:"Tahoma"}},fontSize:{text:"\ufffd\ufffd\u0421",title:"\ufffd\ufffd\u0421",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd"},italic:{text:"\u0431\ufffd\ufffd",
title:"\u0431\ufffd\ufffd"},underline:{text:"\ufffd\u00bb\ufffd\ufffd\ufffd",title:"\ufffd\u00bb\ufffd\ufffd\ufffd"},strikeThrough:{text:"\u027e\ufffd\ufffd\ufffd\ufffd",title:"\u027e\ufffd\ufffd\ufffd\ufffd"},link:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd/\ufffd\u0f2d\ufffd\ufffd\ufffd\ufffd",href:"URL:",target:"\ufffd\ufffd\ufffd\u00b4\ufffd\ufffd\u06b4\ufffd\ufffd\ufffd\ufffd\ufffd",remove:"\ufffd\u01b3\ufffd\ufffd\ufffd\ufffd\ufffd"},blockquote:{text:"\ufffd\ufffd\ufffd\ufffd",
title:"\ufffd\ufffd\ufffd\ufffd"},smiley:{text:"\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd"},image:{text:"\u037c\u01ac",title:"\ufffd\ufffd\ufffd\ufffd\u037c\u01ac",tab_link:"\ufffd\ufffd\ufffd\ufffd\u037c\u01ac",tab_local:"\ufffd\ufffd\ufffd\ufffd\ufffd\u03f4\ufffd",tab_album:"\ufffd\u04b5\ufffd\ufffd\ufffd\ufffd",label_link:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u037c\u01ac\ufffd\ufffd\u05b7\ufffd\ufffd",label_local:"\ufffd\ufffd\u0461\ufffd\ud987\udfb5\ufffd\u037c\u01ac\ufffd\ufffd",
label_album:"\ufffd\ufffd\u0461\ufffd\ufffd\ufffd\ufffd\ufffd\u037c\u01ac\ufffd\ufffd",uploading:"\ufffd\ufffd\ufffd\ufffd\ufffd\u03f4\ufffd...",upload_error:"\ufffd\u0532\ufffd\ufffd\ufffd\ufffd\u03f4\ufffd\ufffd\u013c\ufffd\u02b1\ufffd\ufffd\ufffd\ufffd\ufffd\u02f4\ufffd\ufffd\ufffd",upload_filter:"\ufffd\ufffd\u05a7\ufffd\ufffd JPG, PNG \ufffd\ufffd GIF \u037c\u01ac\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u0461\ufffd\ufffd",upload_linkFilter:'\ufffd\u0532\ufffd\ufffd\ufffd\u037c\u01ac\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u057e\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd?\u03a7\ufffd\u06a1\ufffd\n\ufffd\ufffd\ufffd\ufffd\ufffd\u0635\ufffd\ufffd\ufffd\ufffd\u0623\ufffd\ufffd\ufffd\u0368\ufffd\ufffd"\ufffd\ufffd\ufffd\ufffd\ufffd\u03f4\ufffd"\ufffd\u03f4\ufffd\u037c\u01ac\ufffd\ufffd',
ok:"\ufffd\ufffd\ufffd\ufffd"},insertOrderedList:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd\u0431\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\u0431\ufffd"},insertUnorderedList:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd\u0431\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\u0431\ufffd"},outdent:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd"},indent:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd"},
justifyLeft:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\ufffd\ufffd"},justifyCenter:{text:"\ufffd\ufffd\ufffd\u0436\ufffd\ufffd\ufffd",title:"\ufffd\ufffd\ufffd\u0436\ufffd\ufffd\ufffd"},justifyRight:{text:"\ufffd\u04b6\ufffd\ufffd\ufffd",title:"\ufffd\u04b6\ufffd\ufffd\ufffd"},foreColor:{text:"\ufffd\u0131\ufffd\ufffd\ufffd\u026b",title:"\ufffd\u0131\ufffd\ufffd\ufffd\u026b"},backColor:{text:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u026b",title:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u026b"},
maximize:{text:"\u022b\ufffd\ufffd\ufffd\u0f2d",title:"\u022b\ufffd\ufffd\ufffd\u0f2d"},removeformat:{text:"\ufffd\ufffd\ufffd\ufffd\u02bd",title:"\ufffd\ufffd\ufffd\ufffd\u02bd"},wordcount:{tmpl:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd %remain% \ufffd\u05a3\ufffd\ufffd\ufffd html \ufffd\ufffd\ufffd\ub8e9"},resize:{larger_text:"\ufffd\ufffd\ufffd\ufffd",larger_title:"\ufffd\ufffd\ufffd\ufffd\u0f2d\ufffd\ufffd\ufffd\ufffd",smaller_text:"\ufffd\ufffd\u0421",smaller_title:"\ufffd\ufffd\u0421\ufffd\u0f2d\ufffd\ufffd\ufffd\ufffd"},
common:{ok:"\u0237\ufffd\ufffd",cancel:"\u0221\ufffd\ufffd"}}});KISSY.Editor.add("core~plugin",function(g){g.PLUGIN_TYPE={CUSTOM:0,TOOLBAR_SEPARATOR:1,TOOLBAR_BUTTON:2,TOOLBAR_MENU_BUTTON:4,TOOLBAR_SELECT:8,STATUSBAR_ITEM:16,FUNC:32}});
KISSY.Editor.add("core~dom",function(g){var n=YAHOO.env.ua;g.Dom={getText:function(e){return e?e.textContent||"":""},setItemUnselectable:function(e){var b,i,j,c,k;b=e.getElementsByTagName("*");i=-1;for(j=b.length;i<j;++i){k=i==-1?e:b[i];(c=k.nodeName)&&c!="INPUT"&&k.setAttribute("unselectable","on")}return e},BLOCK_ELEMENTS:{blockquote:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,p:1,address:1,center:1,pre:1,form:1,fieldset:1,caption:1,table:1,tbody:1,tr:1,th:1,td:1,ul:1,ol:1,dl:1,dt:1,dd:1,li:1}};
if(n.ie)g.Dom.getText=function(e){return e?e.innerText||"":""}});
KISSY.Editor.add("core~color",function(g){var n=parseInt,e=RegExp;g.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(b){this.re_RGB.test(b)||(b=this.toHex(b));if(this.re_hex.exec(b))b=
"rgb("+[n(e.$1,16),n(e.$2,16),n(e.$3,16)].join(", ")+")";return b},toHex:function(b){b=this.KEYWORDS[b]||b;if(this.re_RGB.exec(b)){b=(e.$1>>0).toString(16);var i=(e.$2>>0).toString(16),j=(e.$3>>0).toString(16);b=[b.length==1?"0"+b:b,i.length==1?"0"+i:i,j.length==1?"0"+j:j].join("")}if(b.length<6)b=b.replace(this.re_hex3,"$1$1");if(b!=="transparent"&&b.indexOf("#")<0)b="#"+b;return b.toLowerCase()},int2hex:function(b){b>>=0;return this.toHex("rgb("+(b&255)+","+(b>>8&255)+","+(b>>16&255)+")")}}});
KISSY.Editor.add("core~command",function(g){var n=YAHOO.env.ua,e={backColor:n.gecko?"hiliteColor":"backColor"};g.Command={exec:function(b,i,j,c){i=e[i]||i;this._preExec(b,i,c);b.execCommand(i,false,j)},_preExec:function(b,i,j){if(n.gecko){i=typeof j==="undefined"?"bold,italic,underline,strikeThrough".indexOf(i)===-1:j;b.execCommand("styleWithCSS",false,i)}}}});
KISSY.Editor.add("core~range",function(g){var n=YAHOO.env.ua.ie;g.Range={getSelectionRange:function(e){var b=e.document,i;if(e.getSelection){e=e.getSelection();if(e.getRangeAt)i=e.getRangeAt(0);else{i=b.createRange();i.setStart(e.anchorNode,e.anchorOffset);i.setEnd(e.focusNode,e.focusOffset)}}else if(b.selection)i=b.selection.createRange();return i},getCommonAncestor:function(e){return e.startContainer||e.parentElement&&e.parentElement()||e.commonParentElement&&e.commonParentElement()},getSelectedText:function(e){if("text"in
e)return e.text;return e.toString?e.toString():""},saveRange:function(e){n&&e.contentWin.focus();return e.getSelectionRange()}}});
KISSY.Editor.add("core~instance",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua,c=j.ie;g.Instance=function(k,f){this.textarea=e.get(k);this.config=i.merge(g.config,f||{});this.sourceMode=false;this.toolbar=new g.Toolbar(this);this.statusbar=new g.Statusbar(this);this._init()};i.augmentObject(g.Instance.prototype,{_init:function(){this._renderUI();this._initPlugins();this._initAutoFocus()},_renderUI:function(){this._renderContainer();this._setupContentPanel()},_initPlugins:function(){var k,
f;f=g.plugins;var a=[];for(k in f)a[k]=i.merge(f[k]);this.plugins=a;this.toolbar.init();this.statusbar.init();for(k in a){f=a[k];if(!f.inited)if(f.type===g.PLUGIN_TYPE.FUNC){f.editor=this;f.init&&f.init();f.inited=true}}},_renderContainer:function(){var k=this.textarea,f=e.getRegion(k),a=f.right-f.left-2+"px",d=f.bottom-f.top-2+"px";f=document.createElement("div");f.className="ks-editor";f.style.width=a;f.innerHTML='<div class="ks-editor-toolbar"></div><div class="ks-editor-content"><iframe frameborder="0" allowtransparency="1"></iframe></div><div class="ks-editor-statusbar"></div>';
a=f.childNodes[1];a.style.width="100%";a.style.height=d;a=a.childNodes[0];a.style.width="100%";a.style.height="100%";a.setAttribute("frameBorder",0);k.style.display="none";e.insertBefore(f,k);this.container=f;this.toolbar.domEl=f.childNodes[0];this.contentWin=a.contentWindow;this.contentDoc=a.contentWindow.document;this.statusbar.domEl=f.childNodes[2]},_setupContentPanel:function(){var k=this.contentDoc,f=this.config;f=f.base+"themes/"+f.theme+"/"+("content"+(f.debug?"":"-min")+".css");var a=this;
k.open();k.write('<!doctype html><html><head><title>Rich Text Area</title><meta charset="charset=gbk" /><link href="{CONTENT_CSS}" rel="stylesheet" /></head><body spellcheck="false" class="ks-editor-post">{CONTENT}</body></html>'.replace("{CONTENT_CSS}",f).replace("{CONTENT}",this.textarea.value));k.close();if(c)k.body.contentEditable="true";else k.designMode="on";c&&b.on(k,"click",function(){k.activeElement.parentNode.nodeType===9&&a._focusToEnd()})},_initAutoFocus:function(){this.config.autoFocus&&
this._focusToEnd()},_focusToEnd:function(){this.contentWin.focus();var k=this.contentDoc.body.lastChild,f=g.Range.getSelectionRange(this.contentWin);if(j.ie){try{f.moveToElementText(k)}catch(a){}f.collapse(false);f.select()}else{try{f.setEnd(k,k.childNodes.length)}catch(d){}f.collapse(false)}},focus:function(){this._focusToEnd()},execCommand:function(k,f,a){this.contentWin.focus();g.Command.exec(this.contentDoc,k,f,a)},getData:function(){if(this.sourceMode)return this.textarea.value;return this.getContentDocData()},
getContentDocData:function(){var k="",f=g.plugins.save;k=this.contentDoc.body.innerHTML;if(k=="<br>")k="";if(f&&f.filterData)k=f.filterData(k);return k},getSelectionRange:function(){return g.Range.getSelectionRange(this.contentWin)}})});
KISSY.Editor.add("core~toolbar",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua.ie,c=j===6,k=g.PLUGIN_TYPE,f=document.createElement("div");g.Toolbar=function(a){this.editor=a;this.config=a.config;this.lang=g.lang[this.config.language];this.items=[];this.stateItems=[]};i.augmentObject(g.Toolbar.prototype,{init:function(){for(var a=this.config.toolbar,d=this.editor.plugins,h,l=0,m=a.length;l<m;++l)if(h=a[l]){if(h in d){h=d[h];this._addItem(h);this.items.push(h);"fontName,fontSize,bold,italic,underline,strikeThroughinsertOrderedList,insertUnorderedListjustifyLeft,justifyCenter,justifyRight".indexOf(h.name)!==
-1&&this.stateItems.push(h)}}else this._addSeparator();this._initUpdateState()},_addItem:function(a){var d,h=a.type;d=this.lang;if(!a.lang)a.lang=i.merge(d.common,this.lang[a.name]||{});d='<div class="ks-editor-toolbar-button ks-inline-block" title="{TITLE}"><div class="ks-editor-toolbar-button-outer-box"><div class="ks-editor-toolbar-button-inner-box"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div></div></div>'.replace("{TITLE}",a.lang.title||"").replace("{NAME}",
a.name).replace("{TEXT}",a.lang.text||"");if(c)d=d.replace("outer-box","outer-box ks-inline-block").replace("inner-box","inner-box ks-inline-block");f.innerHTML=d;a.domEl=d=f.firstChild;if(h==k.TOOLBAR_MENU_BUTTON||h==k.TOOLBAR_SELECT){this._renderMenuButton(a);h==k.TOOLBAR_SELECT&&this._renderSelect(a)}this._bindItemUI(a);this._addToToolbar(d);a.editor=this.editor;a.init&&a.init();a.inited=true},_renderMenuButton:function(a){var d=a.domEl,h=d.getElementsByTagName("span")[0].parentNode;e.addClass(d,
"ks-editor-toolbar-menu-button");h.innerHTML='<div class="ks-editor-toolbar-menu-button-caption ks-inline-block"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div><div class="ks-editor-toolbar-menu-button-dropdown ks-inline-block"></div>'.replace("{NAME}",a.name).replace("{TEXT}",a.lang.text||"")},_renderSelect:function(a){e.addClass(a.domEl,"ks-editor-toolbar-select")},_bindItemUI:function(a){var d=a.domEl;a.exec&&b.on(d,"click",function(){a.exec()});b.on(d,"mousedown",
function(){e.addClass(d,"ks-editor-toolbar-button-active")});b.on(d,"mouseup",function(){e.removeClass(d,"ks-editor-toolbar-button-active")});b.on(d,"mouseout",function(h){h=b.getRelatedTarget(h);var l;try{if(d.contains)l=d.contains(h);else if(d.compareDocumentPosition)l=d.compareDocumentPosition(h)&8}catch(m){l=false}l||e.removeClass(d,"ks-editor-toolbar-button-active")});if(c){b.on(d,"mouseenter",function(){e.addClass(d,"ks-editor-toolbar-button-hover")});b.on(d,"mouseleave",function(){e.removeClass(d,
"ks-editor-toolbar-button-hover")})}},_addSeparator:function(){f.innerHTML='<div class="ks-editor-stripbar-sep ks-inline-block"></div>';this._addToToolbar(f.firstChild)},_addToToolbar:function(a){if(j)a=g.Dom.setItemUnselectable(a);this.domEl.appendChild(a)},_initUpdateState:function(){var a=this.editor.contentDoc,d=this;b.on(a,"click",function(){d.updateState()});b.on(a,"keyup",function(h){h=h.keyCode;if(h>=33&&h<=40||h===8||h===13||h===46)d.updateState()})},updateState:function(a){var d=this.stateItems,
h;a=a?a.join("|"):"";for(var l=0,m=d.length;l<m;l++){h=d[l];a&&a.indexOf(h.name)===-1||(h.updateState?h.updateState():this.updateItemState(h))}},updateItemState:function(a){var d=this.editor.contentDoc;try{if(d.queryCommandEnabled(a.name))d.queryCommandState(a.name)?e.addClass(a.domEl,"ks-editor-toolbar-button-selected"):e.removeClass(a.domEl,"ks-editor-toolbar-button-selected")}catch(h){}}})});
KISSY.Editor.add("core~statusbar",function(g){var n=YAHOO.lang,e=YAHOO.env.ua.ie,b=document.createElement("div");g.Statusbar=function(i){this.editor=i;this.config=i.config;this.lang=g.lang[this.config.language]};n.augmentObject(g.Statusbar.prototype,{init:function(){for(var i=this.config.statusbar,j=this.editor.plugins,c,k=0,f=i.length;k<f;++k)if(c=i[k])c in j&&this._addItem(j[c]);else this._addSep()},_addItem:function(i){var j;j=this.lang;if(!i.lang)i.lang=n.merge(j.common,this.lang[i.name]||{});
b.innerHTML='<div class="ks-editor-statusbar-item ks-editor-{NAME} ks-inline-block"></div>'.replace("{NAME}",i.name);i.domEl=j=b.firstChild;this._addToToolbar(j);i.editor=this.editor;i.init&&i.init();i.inited=true},_addSep:function(){b.innerHTML='<div class="ks-editor-stripbar-sep kissy-inline-block"></div>';this._addToToolbar(b.firstChild)},_addToToolbar:function(i){if(e)i=g.Dom.setItemUnselectable(i);this.domEl.appendChild(i)}})});
KISSY.Editor.add("core~menu",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.env.ua,j;g.Menu={generateDropMenu:function(c,k,f){var a=document.createElement("div"),d=this;a.innerHTML='<div class="ks-editor-drop-menu-shadow"></div><div class="ks-editor-drop-menu-content"></div>';a.className="ks-editor-drop-menu";a.style.display="none";document.body.appendChild(a);b.on(k,"click",function(h){b.stopPropagation(h);c.activeDropMenu&&d._hide(c);if(c.activeDropMenu!=a){d._setDropMenuPosition(k,a,f);
c.activeDropMenu=a;c.activeDropButton=k;d._show(c)}else{c.activeDropMenu=null;c.activeDropButton=null}});b.on([document,c.contentDoc],"click",function(){if(c.activeDropMenu){d.hideActiveDropMenu(c);this==c.contentDoc&&c.contentWin.focus()}});this._initResizeEvent(k,a,f);return a.childNodes[1]},_setDropMenuPosition:function(c,k,f){var a=e.getRegion(c);c=a.left;a=a.bottom;if(f){c+=f[0];a+=f[1]}k.style.left=c+"px";k.style.top=a+"px"},_isVisible:function(c){if(!c)return false;return c.style.display!=
"none"},hideActiveDropMenu:function(c){this._hide(c);c.activeDropMenu=null;c.activeDropButton=null},_hide:function(c){var k=c.activeDropMenu;c=c.activeDropButton;if(k){j&&(j.style.display="none");k.style.display="none"}c&&e.removeClass(c,"ks-editor-toolbar-button-selected")},_show:function(c){var k=c.activeDropMenu;c=c.activeDropButton;if(k){k.style.display="";if(i.ie===6){this._updateShimRegion(k);j.style.display=""}}c&&e.addClass(c,"ks-editor-toolbar-button-selected")},_updateShimRegion:function(c){if(c)if(i.ie===
6){j||this._initShim();this._setShimRegion(c)}},_initResizeEvent:function(c,k,f){var a=this,d;b.on(window,"resize",function(){d&&clearTimeout(d);d=setTimeout(function(){a._isVisible(k)&&a._setDropMenuPosition(c,k,f)},50)})},_initShim:function(){j=document.createElement("iframe");j.src="about:blank";j.className="ks-editor-drop-menu-shim";j.style.position="absolute";j.style.display="none";j.style.border="none";document.body.appendChild(j)},_setShimRegion:function(c){if(j&&this._isVisible(c)){c=e.getRegion(c);
if(c.width>0){j.style.left=c.left+"px";j.style.top=c.top+"px";j.style.width=c.width-1+"px";j.style.height=c.height-1+"px"}}}}});KISSY.Editor.add("smilies~config~default",function(g){g.Smilies=g.Smilies||{};g.Smilies["default"]={name:"default",mode:"icons",cols:5,fileNames:["smile","confused","cool","cry","eek","angry","wink","sweat","lol","stun","razz","shy","rolleyes","sad","happy","yes","no","heart","idea","rose"],fileExt:"gif"}});
KISSY.Editor.add("smilies~config~wangwang",function(g){g.Smilies=g.Smilies||{};g.Smilies.wangwang={name:"wangwang",mode:"sprite",base:"http://a.tbcdn.cn/sys/wangwang/smiley/48x48/",spriteStyle:"background: url(http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png) no-repeat -1px 0; width: 288px; height: 235px",unitStyle:"width: 24px; height: 24px",filePattern:{start:0,end:98,step:1},fileExt:"gif"}});
KISSY.Editor.add("plugins~base",function(g){var n=g.PLUGIN_TYPE;g.addPlugin("bold,italic,underline,strikeThrough,insertOrderedList,insertUnorderedList".split(","),{type:n.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~color",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.env.ua.ie,j=["000","444","666","999","CCC","EEE","F3F3F3","FFF"],c=["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],k=["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000",
"B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"];g.addPlugin(["foreColor","backColor"],{type:g.PLUGIN_TYPE.TOOLBAR_MENU_BUTTON,color:"",_indicator:null,swatches:null,dropMenu:null,range:null,init:function(){var f=this.domEl,a=f.getElementsByTagName("span")[0].parentNode;this.color=this._getDefaultColor();e.addClass(f,"ks-editor-toolbar-color-button");a.innerHTML='<div class="ks-editor-toolbar-color-button-indicator" style="border-bottom-color:'+
this.color+'">'+a.innerHTML+"</div>";this._indicator=a.firstChild;this._renderUI();this._bindUI();this.swatches=e.getElementsByClassName("ks-editor-palette-colorswatch","div",this.dropMenu)},_renderUI:function(){this.dropMenu=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._generatePalettes();i&&g.Dom.setItemUnselectable(this.dropMenu)},_bindUI:function(){this._bindPickEvent();b.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();i&&this.editor.contentDoc.selection.empty();
this._updateSelectedColor(this.color)},this,true)},_generatePalettes:function(){var f="";f+=this._getPaletteTable(j);f+=this._getPaletteTable(c);f+=this._getPaletteTable(k);this.dropMenu.innerHTML=f},_getPaletteTable:function(f){var a,d=f.length,h,l="<tr>";a=0;for(d=f.length;a<d;++a){if(a!=0&&a%8==0)l+="</tr><tr>";h=g.Color.toRGB("#"+f[a]).toUpperCase();l+='<td class="ks-editor-palette-cell"><div class="ks-editor-palette-colorswatch" title="{COLOR}" style="background-color:{COLOR}"></div></td>'.replace(/{COLOR}/g,
h)}l+="</tr>";return'<div class="ks-editor-palette-table"><table><tbody>{TR}</tbody></table></div>'.replace("{TR}",l)},_bindPickEvent:function(){var f=this;b.on(this.dropMenu,"click",function(a){var d=b.getTarget(a).getAttribute("title");d&&d.indexOf("RGB")===0&&f._doAction(d);b.stopPropagation(a);g.Menu.hideActiveDropMenu(f.editor)})},_doAction:function(f){if(f){this.setColor(g.Color.toHex(f));f=this.range;i&&f.select&&f.select();this.editor.execCommand(this.name,this.color)}},setColor:function(f){this.color=
f;this._updateIndicatorColor(f);this._updateSelectedColor(f)},_updateIndicatorColor:function(f){this._indicator.style.borderBottomColor=f},_updateSelectedColor:function(f){var a,d,h,l=this.swatches;a=0;for(d=l.length;a<d;++a){h=l[a];g.Color.toHex(h.style.backgroundColor)==f?e.addClass(h.parentNode,"ks-editor-palette-cell-selected"):e.removeClass(h.parentNode,"ks-editor-palette-cell-selected")}},_getDefaultColor:function(){return this.name=="foreColor"?"#000000":"#ffffff"}})});
KISSY.Editor.add("plugins~font",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.env.ua,j={"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7};g.addPlugin(["fontName","fontSize"],{type:g.PLUGIN_TYPE.TOOLBAR_SELECT,selectedValue:"",selectHead:null,selectList:null,options:[],items:null,selectedItem:null,range:null,init:function(){this.options=this.lang.options;this.selectHead=this.domEl.getElementsByTagName("span")[0];this._renderUI();this._bindUI()},_renderUI:function(){this.selectList=
g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._renderSelectList();this.items=this.selectList.getElementsByTagName("li")},_bindUI:function(){this._bindPickEvent();b.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();i.ie&&this.editor.contentDoc.selection.empty();if(this.selectedValue)this._updateSelectedOption(this.selectedValue);else if(this.selectedItem){e.removeClass(this.selectedItem,"ks-editor-option-selected");this.selectedItem=null}},this,true)},_renderSelectList:function(){var c=
"",k=this.options,f,a;for(f in k){a=k[f];c+='<li class="ks-editor-option" data-value="{VALUE}"><span class="ks-editor-option-checkbox"></span><span style="{STYLE}">{KEY}</span></li>'.replace("{VALUE}",a).replace("{STYLE}",this._getOptionStyle(f,a)).replace("{KEY}",f)}this.selectList.innerHTML='<ul class="ks-editor-select-list">{LI}</ul>'.replace("{LI}",c);e.addClass(this.selectList,"ks-editor-drop-menu-"+this.name)},_bindPickEvent:function(){var c=this;b.on(this.selectList,"click",function(k){var f=
b.getTarget(k);if(f.nodeName!="LI")f=e.getAncestorByTagName(f,"li");if(f){c._doAction(f.getAttribute("data-value"));b.stopPropagation(k);g.Menu.hideActiveDropMenu(c.editor)}});if(i.ie===6){b.on(this.items,"mouseenter",function(){e.addClass(this,"ks-editor-option-hover")});b.on(this.items,"mouseleave",function(){e.removeClass(this,"ks-editor-option-hover")})}},_doAction:function(c){if(c){this.selectedValue=c;this._setOption(c);c=this.range;i.ie&&c.select&&c.select();this.editor.execCommand(this.name,
this.selectedValue)}},_setOption:function(c){this._updateHeadText(this._getOptionKey(c));this._updateSelectedOption(c)},_getOptionStyle:function(c,k){return this.name=="fontName"?"font-family:"+k:"font-size:"+c+"px"},_getOptionKey:function(c){var k=this.options,f;for(f in k)if(k[f]==c)return f;return null},_updateHeadText:function(c){this.selectHead.innerHTML=c},_updateSelectedOption:function(c){var k=this.items,f,a=k.length,d;for(f=0;f<a;++f){d=k[f];if(d.getAttribute("data-value")==c){e.addClass(d,
"ks-editor-option-selected");this.selectedItem=d}else e.removeClass(d,"ks-editor-option-selected")}},updateState:function(){var c=this.editor.contentDoc,k=this.options,f=this.name,a,d;try{if(c.queryCommandEnabled(f)){d=c.queryCommandValue(f);if(i.webkit&&f=="fontSize")d=this._getWebkitFontSize(d);d&&(a=this._getOptionKey(d));if(a in k){if(d!=this.selectedValue){this.selectedValue=d;this._updateHeadText(a)}}else{this.selectedValue="";this._updateHeadText(this.lang.text)}}}catch(h){}},_getWebkitFontSize:function(c){if(c in
j)return j[c];return null}})});
KISSY.Editor.add("plugins~image",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=n.Connect,j=YAHOO.lang,c=YAHOO.env.ua,k=c.ie,f="ks-editor-image-tab-selected",a=/^(?:.*?:\/\/)?(.*?)\/.*$/,d={local:'<li rel="local" class="'+f+'">{tab_local}</li>',link:'<li rel="link">{tab_link}</li>',album:'<li rel="album">{tab_album}</li>'},h={tabs:["link"],upload:{actionUrl:"",filter:"png|gif|jpg|jpeg",filterMsg:"",linkFilter:"",linkFilterMsg:"",enableXdr:false,connectionSwf:"http://a.tbcdn.cn/yui/2.8.0r4/build/connection/connection.swf",formatResponse:function(l){var m=
[];for(var o in l)m.push(l[o]);return m},extraCode:""}};g.addPlugin("image",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,form:null,range:null,currentTab:null,currentPanel:null,uploadingPanel:null,actionsBar:null,init:function(){var l=this.editor.config.pluginsConfig[this.name]||{};h.upload.filterMsg=this.lang.upload_filter;h.upload.linkFilterMsg=this.lang.upload_linkFilter;this.config=j.merge(h,l);this.config.upload=j.merge(h.upload,l.upload||{});this._renderUI();this._bindUI();this.actionsBar=
e.getElementsByClassName("ks-editor-dialog-actions","div",this.dialog)[0];this.uploadingPanel=e.getElementsByClassName("ks-editor-image-uploading","div",this.dialog)[0];this.config.upload.enableXdr&&this._initXdrUpload()},_renderUI:function(){var l=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),m=this.lang;m.local_extraCode=this.config.upload.extraCode;l.className+=" ks-editor-image";l.innerHTML='<form action="javascript: void(0)"><ul class="ks-editor-image-tabs ks-clearfix"></ul><div class="ks-editor-image-tab-content" rel="local" style="display: none"><label>{label_local}</label><input type="file" size="40" name="imgFile" unselectable="on" />{local_extraCode}</div><div class="ks-editor-image-tab-content" rel="link"><label>{label_link}</label><input name="imgUrl" size="50" /></div><div class="ks-editor-image-tab-content" rel="album" style="display: none"><label>{label_album}</label><p style="width: 300px">\ufffd\ufffd\u03b4\u02b5\ufffd\ufffd...</p></div><div class="ks-editor-image-uploading" style="display: none"><p style="width: 300px">{uploading}</p></div><div class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span></div></form>'.replace(/\{([^}]+)\}/g,
function(o,p){return p in m?m[p]:p});this.dialog=l;this.form=l.getElementsByTagName("form")[0];k&&g.Dom.setItemUnselectable(l);this._renderTabs()},_renderTabs:function(){function l(x){for(var s=0,y=x.getAttribute("rel"),t=0;t<z;t++){v[t]&&e.removeClass(v[t],f);q[t].style.display="none";if(q[t].getAttribute("rel")==y)s=t}c.ie===6&&g.Menu._updateShimRegion(o.dialog);e.addClass(x,f);q[s].style.display="";o.currentTab=x.getAttribute("rel");o.currentPanel=q[s]}for(var m=this.lang,o=this,p=e.getElementsByClassName("ks-editor-image-tabs",
"ul",this.dialog)[0],q=e.getElementsByClassName("ks-editor-image-tab-content","div",this.dialog),r=this.config.tabs,u="",w=0,A=r.length;w<A;w++)u+=d[r[w]];p.innerHTML=u.replace(/\{([^}]+)\}/g,function(x,s){return s in m?m[s]:s});var v=p.childNodes,z=q.length;v.length===1&&e.addClass(this.dialog,"ks-editor-image-no-tab");l(v[0]);b.on(v,"click",function(){l(this)})},_bindUI:function(){var l=this;b.on(this.domEl,"click",function(){if(l.dialog.style.visibility===k?"hidden":"visible")l._syncUI()});b.on(this.dialog,
"click",function(m){var o=b.getTarget(m),p=l.currentTab;switch(o.className){case "ks-editor-btn-ok":if(p==="local"){b.stopPropagation(m);l._insertLocalImage()}else l._insertWebImage();break;case "ks-editor-btn-cancel":break;default:b.stopPropagation(m)}})},_initXdrUpload:function(){for(var l=this.config.tabs,m=0,o=l.length;m<o;m++)if(l[m]==="local"){i.transport(this.config.upload.connectionSwf);break}},_insertLocalImage:function(){var l=this.form,m=this.config.upload,o=l.imgFile.value,p=m.actionUrl,
q=this;if(o&&p){if(m.filter!=="*"){o=o.substring(o.lastIndexOf(".")+1).toLowerCase();if(m.filter.indexOf(o)==-1){alert(m.filterMsg);q.form.reset();return}}this.uploadingPanel.style.display="";this.currentPanel.style.display="none";this.actionsBar.style.display="none";c.ie===6&&g.Menu._updateShimRegion(this.dialog);i.setForm(l,true);i.asyncRequest("post",p,{upload:function(r){try{var u=m.formatResponse(j.JSON.parse(r.responseText));if(u[0]=="0"){q._insertImage(u[1]);q._hideDialog()}else q._onUploadError(u[1])}catch(w){q._onUploadError(j.dump(w)+
"\no = "+j.dump(r)+"\n[from upload catch code]")}},xdr:m.enableXdr})}else q._hideDialog()},_onUploadError:function(l){alert(this.lang.upload_error+"\n\n"+l);this._hideDialog()},_insertWebImage:function(){var l=this.form.imgUrl.value||"",m=this.config.upload,o=m.linkFilter,p,q;if(p=a.exec(l))q=p[1];if(l&&q){if(o&&o!=="*")if(("|"+o.toLowerCase()+"|").indexOf("|"+q.toLowerCase()+"|")===-1){alert(m.linkFilterMsg);return}this._insertImage(l)}},_hideDialog:function(){var l=this.editor.activeDropMenu;l&&
e.isAncestor(l,this.dialog)&&g.Menu.hideActiveDropMenu(this.editor);this.editor.contentWin.focus()},_syncUI:function(){this.range=g.Range.saveRange(this.editor);this.form.reset();this.uploadingPanel.style.display="none";this.currentPanel.style.display="";this.actionsBar.style.display=""},_insertImage:function(l,m){l=j.trim(l);if(l.length!==0){var o=this.editor,p=this.range;if(window.getSelection){var q=o.contentDoc.createElement("img");q.src=l;m&&q.setAttribute("alt",m);p.deleteContents();p.insertNode(q);
if(c.webkit){m=o.contentWin.getSelection();m.addRange(p);m.collapseToEnd()}else p.setStartAfter(q);o.contentWin.focus()}else if(document.selection){o.contentWin.focus();if("text"in p){p.select();o='<img src="'+l+'"';m&&(o+=' "alt="'+m+'"');o+=">";p.pasteHTML(o)}else p.execCommand("insertImage",false,l)}}}})});KISSY.Editor.add("plugins~indent",function(g){g.addPlugin(["indent","outdent"],{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~justify",function(g){var n=["justifyLeft","justifyCenter","justifyRight"];g.addPlugin(n,{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState(n)}})});
KISSY.Editor.add("plugins~keystroke",function(g){var n=YAHOO.util.Event,e=YAHOO.env.ua;g.addPlugin("keystroke",{type:g.PLUGIN_TYPE.FUNC,init:function(){var b=this.editor;e.ie&&e.ie<8&&n.on(b.contentDoc,"keydown",function(j){j.keyCode==9&&this.selection.empty()});var i=b.textarea.form;i&&(new YAHOO.util.KeyListener(b.contentDoc,{ctrl:true,keys:13},{fn:function(){if(!b.sourceMode)b.textarea.value=b.getData();i.submit()}})).enable()}})});
KISSY.Editor.add("plugins~link",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.lang,j=YAHOO.env.ua,c=j.ie;n=g.PLUGIN_TYPE;var k=g.Range,f=(new Date).getTime(),a=/^\w+:\/\/.*|#.*$/,d=['<form onsubmit="return false"><ul><li class="ks-editor-link-href"><label>{href}</label><input name="href" style="width: 220px" value="http://" type="text" /></li><li class="ks-editor-link-target"><input name="target" id="target_"',f,' type="checkbox" /> <label for="target_"',f,'>{target}</label></li><li class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span><span class="ks-editor-link-remove">{remove}</span></li></ul></form>'].join("");
g.addPlugin("link",{type:n.TOOLBAR_BUTTON,dialog:null,form:null,range:null,init:function(){this._renderUI();this._bindUI()},_renderUI:function(){var h=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),l=this.lang;h.className+=" ks-editor-link";h.innerHTML=d.replace(/\{([^}]+)\}/g,function(m,o){return l[o]?l[o]:o});this.dialog=h;this.form=h.getElementsByTagName("form")[0];j.webkit&&(this.form.target.parentNode.style.display="none");c&&g.Dom.setItemUnselectable(h)},_bindUI:function(){var h=this.form,
l=this;b.on(this.domEl,"click",function(){if(l.dialog.style.visibility===c?"hidden":"visible")l._syncUI()});b.on(this.dialog,"click",function(m){switch(b.getTarget(m).className){case "ks-editor-btn-ok":l._createLink(h.href.value,h.target.checked);break;case "ks-editor-btn-cancel":break;case "ks-editor-link-remove":l._unLink();break;default:b.stopPropagation(m)}})},_syncUI:function(){this.range=g.Range.saveRange(this.editor);var h=this.form,l;l=k.getCommonAncestor(this.range);if(l=l.nodeName=="A"?
l:e.getAncestorByTagName(l,"A")){h.href.value=l.href;h.target.checked=l.target==="_blank";e.removeClass(h,"ks-editor-link-newlink-mode")}else{h.href.value="http://";h.target.checked=false;e.addClass(h,"ks-editor-link-newlink-mode")}setTimeout(function(){h.href.select()},50)},_createLink:function(h,l){h=this._getValidHref(h);if(h.length===0)this._unLink();else{var m=this.range,o=document.createElement("div"),p;p=k.getCommonAncestor(m);if(p=p.nodeName=="A"?p:e.getAncestorByTagName(p,"A")){p.href=h;
l?p.setAttribute("target","_blank"):p.removeAttribute("target")}else{p=document.createElement("a");p.href=h;l&&p.setAttribute("target","_blank");if(c){m.select&&m.select();if("text"in m){p.innerHTML=m.htmlText||h;o.innerHTML="";o.appendChild(p);m.pasteHTML(o.innerHTML)}else this.editor.execCommand("createLink",h)}else if(j.webkit)this.editor.execCommand("createLink",h);else{if(m.collapsed)p.innerHTML=h;else for(h=m.cloneContents();h.firstChild;)p.appendChild(h.firstChild);m.deleteContents();m.insertNode(p);
m.selectNode(p)}}}},_getValidHref:function(h){if((h=i.trim(h))&&!a.test(h))h="http://"+h;return h},_unLink:function(){var h=this.editor,l=this.range,m=k.getSelectedText(l),o=k.getCommonAncestor(l);if(!m&&o.nodeType==3){h=o.parentNode;h.nodeName=="A"&&h.parentNode.replaceChild(o,h)}else{l.select&&l.select();h.execCommand("unLink",null)}}})});
KISSY.Editor.add("plugins~resize",function(g){var n=YAHOO.util.Event;g.addPlugin("resize",{type:g.PLUGIN_TYPE.STATUSBAR_ITEM,contentEl:null,currentHeight:0,init:function(){this.contentEl=this.editor.container.childNodes[1];this.currentHeight=parseInt(this.contentEl.style.height);this.renderUI();this.bindUI()},renderUI:function(){var e=this.lang;this.domEl.innerHTML='<span class="ks-editor-resize-larger" title="{larger_title}">{larger_text}</span><span class="ks-editor-resize-smaller" title="{smaller_title}">{smaller_text}</span>'.replace(/\{([^}]+)\}/g,
function(b,i){return e[i]?e[i]:i})},bindUI:function(){var e=this.domEl.getElementsByTagName("span"),b=e[1];n.on(e[0],"click",function(){this.currentHeight+=100;this._doResize()},this,true);n.on(b,"click",function(){if(this.currentHeight<100)this.currentHeight=0;else this.currentHeight-=100;this._doResize()},this,true)},_doResize:function(){this.contentEl.style.height=this.currentHeight+"px";this.editor.textarea.style.height=this.currentHeight+"px"}})});
KISSY.Editor.add("plugins~save",function(g){var n=YAHOO.util.Event,e={b:{tag:"strong"},i:{tag:"em"},u:{tag:"span",style:"text-decoration:underline"},strike:{tag:"span",style:"text-decoration:line-through"}};g.addPlugin("save",{type:g.PLUGIN_TYPE.FUNC,init:function(){var b=this.editor,i=b.textarea,j=i.form;j&&n.on(j,"submit",function(){if(!b.sourceMode)i.value=b.getData()})},filterData:function(b){b=b.replace(/<(\/?)([^>\s]+)([^>]*)>/g,function(i,j,c,k){c=c.toLowerCase();i=e[c];c=c;if(i&&!k){c=i.tag;
if(!j&&i.style)c+=' style="'+i.style+'"'}return"<"+j+c+k+">"});if(b.indexOf("mso")>0)b=this.filterWord(b);return b},filterWord:function(b){b=b.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3");b=b.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3");b=b.replace(/<H(\d)([^>]*)>/gi,"<h$1>");b=b.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>");b=b.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");b=b.replace(/<meta[^>]*>/ig,"");b=b.replace(/<link rel="\S+" href="file:[^>]*">/ig,
"");b=b.replace(/<!--\[if gte mso [0-9]{1,2}\]>[\s\S]*?<!\[endif\]--\>/ig,"");b=b.replace(/<style>[\s\S]*?mso[\s\S]*?<\/style>/ig,"");b=b.replace(/ lang=".+?"/ig,"");b=b.replace(/<o:p><\/o:p>/ig,"");b=b.replace(/ class="Mso.+?"/ig,"");return b=b.replace(/<\\?\?xml[^>]*>/ig,"")}})});
KISSY.Editor.add("plugins~smiley",function(g){var n=YAHOO.util.Event,e=YAHOO.lang,b=YAHOO.env.ua,i={tabs:["default"]};g.addPlugin("smiley",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,range:null,init:function(){this.config=e.merge(i,this.editor.config.pluginsConfig[this.name]||{});this._renderUI();this._bindUI()},_renderUI:function(){var j=g.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);j.className+=" ks-editor-smiley-dialog";this.dialog=j;this._renderDialog();b.ie&&g.Dom.setItemUnselectable(j)},
_renderDialog:function(){var j=g.Smilies[this.config.tabs[0]],c=j.mode;if(c==="icons")this._renderIcons(j);else c==="sprite"&&this._renderSprite(j)},_renderIcons:function(j){var c=this.editor.config.base+"smilies/"+j.name+"/",k=j.fileNames,f="."+j.fileExt;j=j.cols;var a=[],d,h=k.length,l;a.push('<div class="ks-editor-smiley-icons">');for(d=0;d<h;d++){l=k[d];a.push('<img src="'+c+l+f+'" alt="'+l+'" title="'+l+'" />');d%j===j-1&&a.push("<br />")}a.push("</div");this.dialog.innerHTML=a.join("")},_renderSprite:function(j){var c=
j.base,k=j.filePattern,f="."+j.fileExt,a=k.end+1;k=k.step;var d,h=[];h.push('<div class="ks-editor-smiley-sprite ks-clearfix" style="'+j.spriteStyle+'">');for(d=0;d<a;d+=k)h.push('<span data-icon="'+c+d+f+'" style="'+j.unitStyle+'"></span>');h.push("</div");this.dialog.innerHTML=h.join("")},_bindUI:function(){var j=this;n.on(this.domEl,"click",function(){j.range=g.Range.saveRange(j.editor)});n.on(this.dialog,"click",function(c){var k=n.getTarget(c);switch(k.nodeName){case "IMG":j._insertImage(k.src,
k.getAttribute("alt"));break;case "SPAN":j._insertImage(k.getAttribute("data-icon"),"");break;default:n.stopPropagation(c)}})},_insertImage:function(j,c){j=e.trim(j);if(j.length!==0){var k=this.editor,f=this.range;if(window.getSelection){var a=k.contentDoc.createElement("img");a.src=j;a.setAttribute("alt",c);f.deleteContents();f.insertNode(a);if(b.webkit){j=k.contentWin.getSelection();j.addRange(f);j.collapseToEnd()}else f.setStartAfter(a);k.contentWin.focus()}else if(document.selection)"text"in f?
f.pasteHTML('<img src="'+j+'" alt="'+c+'" />'):k.execCommand("insertImage",j)}}})});
KISSY.Editor.add("plugins~source",function(g){var n=YAHOO.util.Dom,e=YAHOO.env.ua;g.addPlugin("source",{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,init:function(){var b=this.editor;this.iframe=b.contentWin.frameElement;this.textarea=b.textarea;this.iframe.parentNode.appendChild(b.textarea);n.addClass(this.domEl,"ks-editor-toolbar-source-button")},exec:function(){var b=this.editor,i=b.sourceMode;if(i)b.contentDoc.body.innerHTML=this.textarea.value;else this.textarea.value=b.getContentDocData();e.ie&&e.ie<8&&
b.contentDoc.selection.empty();this.textarea.style.display=i?"none":"";this.iframe.style.display=i?"":"none";b.sourceMode=!i;this._updateButtonState()},_updateButtonState:function(){var b=this.editor;if(b.sourceMode){n.addClass(b.container,"ks-editor-src-mode");n.addClass(this.domEl,"ks-editor-toolbar-button-selected")}else{n.removeClass(b.container,"ks-editor-src-mode");n.removeClass(this.domEl,"ks-editor-toolbar-button-selected")}}})});
KISSY.Editor.add("plugins~undo",function(g){g.addPlugin(["undo","redo"],{type:g.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name)}})});
KISSY.Editor.add("plugins~wordcount",function(g){var n=YAHOO.util,e=n.Dom,b=n.Event,i=YAHOO.lang,j={total:5E4,threshold:100};g.addPlugin("wordcount",{type:g.PLUGIN_TYPE.STATUSBAR_ITEM,total:Infinity,remain:Infinity,threshold:0,remainEl:null,init:function(){var c=i.merge(j,this.editor.config.pluginsConfig[this.name]||{});this.total=c.total;this.threshold=c.threshold;this.renderUI();this.bindUI();var k=this;setTimeout(function(){k.syncUI()},50)},renderUI:function(){this.domEl.innerHTML=this.lang.tmpl.replace("%remain%",
"<em>"+this.total+"</em>");this.remainEl=this.domEl.getElementsByTagName("em")[0]},bindUI:function(){var c=this.editor;b.on(c.textarea,"keyup",this.syncUI,this,true);b.on(c.contentDoc,"keyup",this.syncUI,this,true);b.on(c.container,"click",this.syncUI,this,true)},syncUI:function(){this.remain=this.total-this.editor.getData().length;this.remainEl.innerHTML=this.remain;this.remain<=this.threshold?e.addClass(this.domEl,"ks-editor-wordcount-alarm"):e.removeClass(this.domEl,"ks-editor-wordcount-alarm")}})});
