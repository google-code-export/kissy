/*
Copyright 2010, KISSY UI Library v1.0dev
MIT Licensed
build: 416 Jan 17 22:28
*/
if(typeof KISSY==="undefined"||!KISSY){function KISSY(i){var m=this;if(!(m instanceof KISSY))return new KISSY(i);m._init();m._config(i);m._setup();return m}}
(function(i,m,h){var d=Array.prototype.slice,k=function(b,a,c,f){if(!a||!b)return b;if(c===h)c=true;var e,j,g;if(f&&(g=f.length))for(e=0;e<g;e++){j=f[e];if(j in a)if(c||!(j in b))b[j]=a[j]}else for(j in a)if(c||!(j in b))b[j]=a[j];return b};k(m.prototype,{add:function(b,a,c,f){m.Env.mods[b]={name:b,fn:a,version:c,details:f||{}};return this},_init:function(){var b=this;b.version="1.0dev";b.Env={mods:{},_used:{},_attached:{}};b.Config={debug:true}},_config:function(b){k(this.Config,b)},_setup:function(){this.use("kissy-core")},
use:function(){function b(o){if(!e[o]){var p=f[o],q;if(p){e[o]=true;q=p.details.submodules}n.push(o);if(q){if(typeof q==="string")q=[q];o=0;for(p=q.length;o<p;o++)b(q[o])}}}var a=this,c=d.call(arguments,0),f=m.Env.mods,e=a.Env._used,j=c.length,g=c[j-1],l,n=[];if(typeof g==="function")c.pop();else g=null;if(c[0]==="*"){c=[];for(l in f)c.push(l);g&&c.push(g);return a.use.apply(a,c)}for(l=0;l<j;l++)b(c[l]);a._attach(n);g&&g(a);return a},_attach:function(b){var a=m.Env.mods,c=this.Env._attached,f,e=b.length,
j,g;for(f=0;f<e;f++){j=b[f];g=a[j];if(!c[j]&&g){c[j]=true;g.fn&&g.fn(this)}}},mix:k,merge:function(){var b=arguments,a={},c,f=b.length;for(c=0;c<f;++c)k(a,b[c]);return a},extend:function(b,a,c,f){if(!a||!b)return b;var e=Object.prototype,j=a.prototype,g=function(l){function n(){}n.prototype=l;return new n}(j);b.prototype=g;g.constructor=b;b.superclass=j;if(a!==Object&&j.constructor===e.constructor)j.constructor=a;c&&k(g,c);f&&k(b,f);return b},augment:function(b,a,c,f){return k(b.prototype,a.prototype,
c,f)},each:function(b,a,c){var f=b&&b.length||0,e;for(e=0;e<f;e++)a.call(c||this,b[e],e,b);return this},ready:function(){},weave:function(b,a,c,f){var e=[c[f],b];a==="before"&&e.reverse();c[f]=function(){for(var j=0;j<2;j++)e[j].apply(this,arguments)};return this},cloneTo:function(b){function a(c){if(!(this instanceof a))return new a(c);a.superclass.constructor.call(this,c)}m.extend(a,m,null,m);return i[b]=a},namespace:function(){var b=arguments,a=b.length,c=this,f,e,j;if(typeof c==="object")c=c.constructor;
for(f=0;f<a;f++){j=(""+b[f]).split(".");for(e=i[j[0]]===c?1:0;e<j.length;e++){c[j[e]]=c[j[e]]||{};c=c[j[e]]}}return c},log:function(b,a,c){if(this.Config.debug){c&&(b=c+": "+b);if(i.console!==h&&console.log)console[a&&console[a]?a:"log"](b)}return this}});k(m,m.prototype);m._init()})(window,KISSY);
KISSY.add("editor",function(i){function m(h,d){var k=m;if(!(this instanceof k))return new k(h,d);k._isReady||k._setup();return new k.Instance(h,d)}i.mix(m,{version:"1.0",lang:{},plugins:{},addPlugin:function(h,d){h=typeof h=="string"?[h]:h;var k=this.plugins,b,a,c;a=0;for(c=h.length;a<c;++a){b=h[a];k[b]||(k[b]=i.merge(d,{name:b}))}},_isReady:false,_setup:function(){this._loadModules();this._isReady=true},_attached:{},_loadModules:function(){var h=KISSY.Editor.Env.mods,d=this._attached,k,b;for(k in h)if(b=
h[k]){d[k]=b;b.fn&&b.fn(this)}}});i.Editor=m});KISSY.Editor={Env:{mods:{}},add:function(i,m,h){this.Env.mods[i]={name:i,fn:m,details:h||{}};return this}};
KISSY.Editor.add("config",function(i){i.config={base:"",language:"zh-cn",theme:"default",toolbar:["source","","fontName","fontSize","bold","italic","underline","strikeThrough","foreColor","backColor","","link","smiley","image","","insertOrderedList","insertUnorderedList","outdent","indent","justifyLeft","justifyCenter","justifyRight"],statusbar:["wordcount","resize"],pluginsConfig:{}}});
KISSY.Editor.add("lang~en",function(i){i.lang.en={source:{text:"Source",title:"Source"},undo:{text:"Undo",title:"Undo (Ctrl+Z)"},redo:{text:"Redo",title:"Redo (Ctrl+Y)"},fontName:{text:"Font Name",title:"Font Name",options:{Arial:"Arial","Times New Roman":"Times New Roman","Arial Black":"Arial Black","Arial Narrow":"Arial Narrow","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Garamond:"Garamond",Georgia:"Georgia",Tahoma:"Tahoma","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"}},fontSize:{text:"Size",
title:"Font size",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"Bold",title:"Bold (Ctrl+B)"},italic:{text:"Italic",title:"Italick (Ctrl+I)"},underline:{text:"Underline",title:"Underline (Ctrl+U)"},strikeThrough:{text:"Strikeout",title:"Strikeout"},link:{text:"Link",title:"Insert/Edit link",href:"URL:",target:"Open link in new window",remove:"Remove link"},blockquote:{text:"Blockquote",title:"Insert blockquote"},smiley:{text:"Smiley",title:"Insert smiley"},image:{text:"Image",
title:"Insert image",tab_link:"Web Image",tab_local:"Local Image",tab_album:"Album Image",label_link:"Enter image web address:",label_local:"Browse your computer for the image file to upload:",label_album:"Select the image from your album:",uploading:"Uploading...",upload_error:"Exception occurs when uploading file.",upload_filter:"Only allow PNG, GIF, JPG image type.",ok:"Insert"},insertOrderedList:{text:"Numbered List",title:"Numbered List (Ctrl+7)"},insertUnorderedList:{text:"Bullet List",title:"Bullet List (Ctrl+8)"},
outdent:{text:"Decrease Indent",title:"Decrease Indent"},indent:{text:"Increase Indent",title:"Increase Indent"},justifyLeft:{text:"Left Justify",title:"Left Justify (Ctrl+L)"},justifyCenter:{text:"Center Justify",title:"Center Justify (Ctrl+E)"},justifyRight:{text:"Right Justify",title:"Right Justify (Ctrl+R)"},foreColor:{text:"Text Color",title:"Text Color"},backColor:{text:"Text Background Color",title:"Text Background Color"},maximize:{text:"Maximize",title:"Maximize"},removeformat:{text:"Remove Format",
title:"Remove Format"},wordcount:{tmpl:"Remain %remain% words (include html code)"},resize:{larger_text:"Larger",larger_title:"Enlarge the editor",smaller_text:"Smaller",smaller_title:"Shrink the editor"},common:{ok:"OK",cancel:"Cancel"}}});
KISSY.Editor.add("lang~zh-cn",function(i){i.lang["zh-cn"]={source:{text:"\u6e90\u7801",title:"\u6e90\u7801"},undo:{text:"\u64a4\u9500",title:"\u64a4\u9500"},redo:{text:"\u91cd\u505a",title:"\u91cd\u505a"},fontName:{text:"\u5b57\u4f53",title:"\u5b57\u4f53",options:{"\u5b8b\u4f53":"\u5b8b\u4f53","\u9ed1\u4f53":"\u9ed1\u4f53","\u96b6\u4e66":"\u96b6\u4e66","\u6977\u4f53":"\u6977\u4f53_GB2312","\u5fae\u8f6f\u96c5\u9ed1":"\u5fae\u8f6f\u96c5\u9ed1",Georgia:"Georgia","Times New Roman":"Times New Roman",Impact:"Impact","Courier New":"Courier New",Arial:"Arial",Verdana:"Verdana",Tahoma:"Tahoma"}},fontSize:{text:"\u5927\u5c0f",title:"\u5927\u5c0f",options:{"8":"1","10":"2","12":"3","14":"4","18":"5","24":"6","36":"7"}},bold:{text:"\u7c97\u4f53",
title:"\u7c97\u4f53"},italic:{text:"\u659c\u4f53",title:"\u659c\u4f53"},underline:{text:"\u4e0b\u5212\u7ebf",title:"\u4e0b\u5212\u7ebf"},strikeThrough:{text:"\u5220\u9664\u7ebf",title:"\u5220\u9664\u7ebf"},link:{text:"\u94fe\u63a5",title:"\u63d2\u5165/\u7f16\u8f91\u94fe\u63a5",href:"URL:",target:"\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5",remove:"\u79fb\u9664\u94fe\u63a5"},blockquote:{text:"\u5f15\u7528",title:"\u5f15\u7528"},smiley:{text:"\u8868\u60c5",title:"\u63d2\u5165\u8868\u60c5"},image:{text:"\u56fe\u7247",title:"\u63d2\u5165\u56fe\u7247",tab_link:"\u7f51\u7edc\u56fe\u7247",tab_local:"\u672c\u5730\u4e0a\u4f20",tab_album:"\u6211\u7684\u76f8\u518c",label_link:"\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a",label_local:"\u8bf7\u9009\u62e9\u672c\u5730\u56fe\u7247\uff1a",label_album:"\u8bf7\u9009\u62e9\u76f8\u518c\u56fe\u7247\uff1a",uploading:"\u6b63\u5728\u4e0a\u4f20...",upload_error:"\u5bf9\u4e0d\u8d77\uff0c\u4e0a\u4f20\u6587\u4ef6\u65f6\u53d1\u751f\u4e86\u9519\u8bef\uff1a",upload_filter:"\u4ec5\u652f\u6301 JPG, PNG \u548c GIF \u56fe\u7247\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u3002",
ok:"\u63d2\u5165"},insertOrderedList:{text:"\u6709\u5e8f\u5217\u8868",title:"\u6709\u5e8f\u5217\u8868"},insertUnorderedList:{text:"\u65e0\u5e8f\u5217\u8868",title:"\u65e0\u5e8f\u5217\u8868"},outdent:{text:"\u51cf\u5c11\u7f29\u8fdb",title:"\u51cf\u5c11\u7f29\u8fdb"},indent:{text:"\u589e\u52a0\u7f29\u8fdb",title:"\u589e\u52a0\u7f29\u8fdb"},justifyLeft:{text:"\u5de6\u5bf9\u9f50",title:"\u5de6\u5bf9\u9f50"},justifyCenter:{text:"\u5c45\u4e2d\u5bf9\u9f50",title:"\u5c45\u4e2d\u5bf9\u9f50"},justifyRight:{text:"\u53f3\u5bf9\u9f50",title:"\u53f3\u5bf9\u9f50"},foreColor:{text:"\u6587\u672c\u989c\u8272",title:"\u6587\u672c\u989c\u8272"},backColor:{text:"\u80cc\u666f\u989c\u8272",title:"\u80cc\u666f\u989c\u8272"},maximize:{text:"\u5168\u5c4f\u7f16\u8f91",title:"\u5168\u5c4f\u7f16\u8f91"},removeformat:{text:"\u6e05\u9664\u683c\u5f0f",title:"\u6e05\u9664\u683c\u5f0f"},wordcount:{tmpl:"\u8fd8\u53ef\u4ee5\u8f93\u5165 %remain% \u5b57\uff08\u542b html \u4ee3\u7801\uff09"},resize:{larger_text:"\u589e\u5927",
larger_title:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller_text:"\u7f29\u5c0f",smaller_title:"\u7f29\u5c0f\u7f16\u8f91\u533a\u57df"},common:{ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88"}}});KISSY.Editor.add("core~plugin",function(i){i.PLUGIN_TYPE={CUSTOM:0,TOOLBAR_SEPARATOR:1,TOOLBAR_BUTTON:2,TOOLBAR_MENU_BUTTON:4,TOOLBAR_SELECT:8,STATUSBAR_ITEM:16,FUNC:32}});
KISSY.Editor.add("core~dom",function(i){var m=YAHOO.env.ua;i.Dom={getText:function(h){return h?h.textContent||"":""},setItemUnselectable:function(h){var d,k,b,a,c;d=h.getElementsByTagName("*");k=-1;for(b=d.length;k<b;++k){c=k==-1?h:d[k];(a=c.nodeName)&&a!="INPUT"&&c.setAttribute("unselectable","on")}return h},BLOCK_ELEMENTS:{blockquote:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,p:1,address:1,center:1,pre:1,form:1,fieldset:1,caption:1,table:1,tbody:1,tr:1,th:1,td:1,ul:1,ol:1,dl:1,dt:1,dd:1,li:1}};
if(m.ie)i.Dom.getText=function(h){return h?h.innerText||"":""}});
KISSY.Editor.add("core~color",function(i){var m=parseInt,h=RegExp;i.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(d){this.re_RGB.test(d)||(d=this.toHex(d));if(this.re_hex.exec(d))d=
"rgb("+[m(h.$1,16),m(h.$2,16),m(h.$3,16)].join(", ")+")";return d},toHex:function(d){d=this.KEYWORDS[d]||d;if(this.re_RGB.exec(d)){d=(h.$1>>0).toString(16);var k=(h.$2>>0).toString(16),b=(h.$3>>0).toString(16);d=[d.length==1?"0"+d:d,k.length==1?"0"+k:k,b.length==1?"0"+b:b].join("")}if(d.length<6)d=d.replace(this.re_hex3,"$1$1");if(d!=="transparent"&&d.indexOf("#")<0)d="#"+d;return d.toLowerCase()},int2hex:function(d){d>>=0;return this.toHex("rgb("+(d&255)+","+(d>>8&255)+","+(d>>16&255)+")")}}});
KISSY.Editor.add("core~command",function(i){var m=YAHOO.env.ua,h={backColor:m.gecko?"hiliteColor":"backColor"};i.Command={exec:function(d,k,b,a){k=h[k]||k;this._preExec(d,k,a);d.execCommand(k,false,b)},_preExec:function(d,k,b){if(m.gecko){k=typeof b==="undefined"?"bold,italic,underline,strikeThrough".indexOf(k)===-1:b;d.execCommand("styleWithCSS",false,k)}}}});
KISSY.Editor.add("core~range",function(i){var m=YAHOO.env.ua.ie;i.Range={getSelectionRange:function(h){var d=h.document,k;if(h.getSelection){h=h.getSelection();if(h.getRangeAt)k=h.getRangeAt(0);else{k=d.createRange();k.setStart(h.anchorNode,h.anchorOffset);k.setEnd(h.focusNode,h.focusOffset)}}else if(d.selection)k=d.selection.createRange();return k},getCommonAncestor:function(h){return h.startContainer||h.parentElement&&h.parentElement()||h.commonParentElement&&h.commonParentElement()},getSelectedText:function(h){if("text"in
h)return h.text;return h.toString?h.toString():""},saveRange:function(h){m&&h.contentWin.focus();return h.getSelectionRange()}}});
KISSY.Editor.add("core~instance",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.lang,b=YAHOO.env.ua,a=b.ie;i.Instance=function(c,f){this.textarea=h.get(c);this.config=k.merge(i.config,f||{});this.sourceMode=false;this.toolbar=new i.Toolbar(this);this.statusbar=new i.Statusbar(this);this._init()};k.augmentObject(i.Instance.prototype,{_init:function(){this._renderUI();this._initPlugins();this._initAutoFocus()},_renderUI:function(){this._renderContainer();this._setupContentPanel()},_initPlugins:function(){var c,
f;f=i.plugins;var e=[];for(c in f)e[c]=k.merge(f[c]);this.plugins=e;this.toolbar.init();this.statusbar.init();for(c in e){f=e[c];if(!f.inited)if(f.type===i.PLUGIN_TYPE.FUNC){f.editor=this;f.init&&f.init();f.inited=true}}},_renderContainer:function(){var c=this.textarea,f=h.getRegion(c),e=f.right-f.left-2+"px",j=f.bottom-f.top-2+"px";f=document.createElement("div");f.className="ks-editor";f.style.width=e;f.innerHTML='<div class="ks-editor-toolbar"></div><div class="ks-editor-content"><iframe frameborder="0" allowtransparency="1"></iframe></div><div class="ks-editor-statusbar"></div>';
e=f.childNodes[1];e.style.width="100%";e.style.height=j;e=e.childNodes[0];e.style.width="100%";e.style.height="100%";e.setAttribute("frameBorder",0);c.style.display="none";h.insertBefore(f,c);this.container=f;this.toolbar.domEl=f.childNodes[0];this.contentWin=e.contentWindow;this.contentDoc=e.contentWindow.document;this.statusbar.domEl=f.childNodes[2]},_setupContentPanel:function(){var c=this.contentDoc,f=this.config;f=f.base+"themes/"+f.theme+"/"+("content"+(f.debug?"":"-min")+".css");var e=this;
c.open();c.write('<!doctype html><html><head><title>Rich Text Area</title><meta http-equiv="content-type" content="text/html; charset=gb18030" /><link type="text/css" href="{CONTENT_CSS}" rel="stylesheet" /></head><body spellcheck="false" class="ks-editor-post">{CONTENT}</body></html>'.replace("{CONTENT_CSS}",f).replace("{CONTENT}",this.textarea.value));c.close();if(a)c.body.contentEditable="true";else c.designMode="on";a&&d.on(c,"click",function(){c.activeElement.parentNode.nodeType===9&&e._focusToEnd()})},
_initAutoFocus:function(){this.config.autoFocus&&this._focusToEnd()},_focusToEnd:function(){this.contentWin.focus();var c=this.contentDoc.body.lastChild,f=i.Range.getSelectionRange(this.contentWin);if(b.ie){try{f.moveToElementText(c)}catch(e){}f.collapse(false);f.select()}else{try{f.setEnd(c,c.childNodes.length)}catch(j){}f.collapse(false)}},focus:function(){this._focusToEnd()},execCommand:function(c,f,e){this.contentWin.focus();i.Command.exec(this.contentDoc,c,f,e)},getData:function(){if(this.sourceMode)return this.textarea.value;
return this.getContentDocData()},getContentDocData:function(){var c="",f=i.plugins.save;c=this.contentDoc.body.innerHTML;if(c=="<br>")c="";if(f&&f.filterData)c=f.filterData(c);return c},getSelectionRange:function(){return i.Range.getSelectionRange(this.contentWin)}})});
KISSY.Editor.add("core~toolbar",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.lang,b=YAHOO.env.ua.ie,a=b===6,c=i.PLUGIN_TYPE,f=document.createElement("div");i.Toolbar=function(e){this.editor=e;this.config=e.config;this.lang=i.lang[this.config.language];this.items=[];this.stateItems=[]};k.augmentObject(i.Toolbar.prototype,{init:function(){for(var e=this.config.toolbar,j=this.editor.plugins,g,l=0,n=e.length;l<n;++l)if(g=e[l]){if(g in j){g=j[g];this._addItem(g);this.items.push(g);"fontName,fontSize,bold,italic,underline,strikeThroughinsertOrderedList,insertUnorderedListjustifyLeft,justifyCenter,justifyRight".indexOf(g.name)!==
-1&&this.stateItems.push(g)}}else this._addSeparator();this._initUpdateState()},_addItem:function(e){var j,g=e.type;j=this.lang;if(!e.lang)e.lang=k.merge(j.common,this.lang[e.name]||{});j='<div class="ks-editor-toolbar-button ks-inline-block" title="{TITLE}"><div class="ks-editor-toolbar-button-outer-box"><div class="ks-editor-toolbar-button-inner-box"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div></div></div>'.replace("{TITLE}",e.lang.title||"").replace("{NAME}",
e.name).replace("{TEXT}",e.lang.text||"");if(a)j=j.replace("outer-box","outer-box ks-inline-block").replace("inner-box","inner-box ks-inline-block");f.innerHTML=j;e.domEl=j=f.firstChild;if(g==c.TOOLBAR_MENU_BUTTON||g==c.TOOLBAR_SELECT){this._renderMenuButton(e);g==c.TOOLBAR_SELECT&&this._renderSelect(e)}this._bindItemUI(e);this._addToToolbar(j);e.editor=this.editor;e.init&&e.init();e.inited=true},_renderMenuButton:function(e){var j=e.domEl,g=j.getElementsByTagName("span")[0].parentNode;h.addClass(j,
"ks-editor-toolbar-menu-button");g.innerHTML='<div class="ks-editor-toolbar-menu-button-caption ks-inline-block"><span class="ks-editor-toolbar-item ks-editor-toolbar-{NAME}">{TEXT}</span></div><div class="ks-editor-toolbar-menu-button-dropdown ks-inline-block"></div>'.replace("{NAME}",e.name).replace("{TEXT}",e.lang.text||"")},_renderSelect:function(e){h.addClass(e.domEl,"ks-editor-toolbar-select")},_bindItemUI:function(e){var j=e.domEl;e.exec&&d.on(j,"click",function(){e.exec()});d.on(j,"mousedown",
function(){h.addClass(j,"ks-editor-toolbar-button-active")});d.on(j,"mouseup",function(){h.removeClass(j,"ks-editor-toolbar-button-active")});d.on(j,"mouseout",function(g){g=d.getRelatedTarget(g);var l;try{if(j.contains)l=j.contains(g);else if(j.compareDocumentPosition)l=j.compareDocumentPosition(g)&8}catch(n){l=false}l||h.removeClass(j,"ks-editor-toolbar-button-active")});if(a){d.on(j,"mouseenter",function(){h.addClass(j,"ks-editor-toolbar-button-hover")});d.on(j,"mouseleave",function(){h.removeClass(j,
"ks-editor-toolbar-button-hover")})}},_addSeparator:function(){f.innerHTML='<div class="ks-editor-stripbar-sep ks-inline-block"></div>';this._addToToolbar(f.firstChild)},_addToToolbar:function(e){if(b)e=i.Dom.setItemUnselectable(e);this.domEl.appendChild(e)},_initUpdateState:function(){var e=this.editor.contentDoc,j=this;d.on(e,"click",function(){j.updateState()});d.on(e,"keyup",function(g){g=g.keyCode;if(g>=33&&g<=40||g===8||g===13||g===46)j.updateState()})},updateState:function(e){var j=this.stateItems,
g;e=e?e.join("|"):"";for(var l=0,n=j.length;l<n;l++){g=j[l];e&&e.indexOf(g.name)===-1||(g.updateState?g.updateState():this.updateItemState(g))}},updateItemState:function(e){var j=this.editor.contentDoc;try{if(j.queryCommandEnabled(e.name))j.queryCommandState(e.name)?h.addClass(e.domEl,"ks-editor-toolbar-button-selected"):h.removeClass(e.domEl,"ks-editor-toolbar-button-selected")}catch(g){}}})});
KISSY.Editor.add("core~statusbar",function(i){var m=YAHOO.lang,h=YAHOO.env.ua.ie,d=document.createElement("div");i.Statusbar=function(k){this.editor=k;this.config=k.config;this.lang=i.lang[this.config.language]};m.augmentObject(i.Statusbar.prototype,{init:function(){for(var k=this.config.statusbar,b=this.editor.plugins,a,c=0,f=k.length;c<f;++c)if(a=k[c])a in b&&this._addItem(b[a]);else this._addSep()},_addItem:function(k){var b;b=this.lang;if(!k.lang)k.lang=m.merge(b.common,this.lang[k.name]||{});
d.innerHTML='<div class="ks-editor-statusbar-item ks-editor-{NAME} ks-inline-block"></div>'.replace("{NAME}",k.name);k.domEl=b=d.firstChild;this._addToToolbar(b);k.editor=this.editor;k.init&&k.init();k.inited=true},_addSep:function(){d.innerHTML='<div class="ks-editor-stripbar-sep kissy-inline-block"></div>';this._addToToolbar(d.firstChild)},_addToToolbar:function(k){if(h)k=i.Dom.setItemUnselectable(k);this.domEl.appendChild(k)}})});
KISSY.Editor.add("core~menu",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.env.ua,b;i.Menu={generateDropMenu:function(a,c,f){var e=document.createElement("div"),j=this;e.innerHTML='<div class="ks-editor-drop-menu-shadow"></div><div class="ks-editor-drop-menu-content"></div>';e.className="ks-editor-drop-menu";e.style.display="none";document.body.appendChild(e);d.on(c,"click",function(g){d.stopPropagation(g);a.activeDropMenu&&j._hide(a);if(a.activeDropMenu!=e){j._setDropMenuPosition(c,e,f);
a.activeDropMenu=e;a.activeDropButton=c;j._show(a)}else{a.activeDropMenu=null;a.activeDropButton=null}});d.on([document,a.contentDoc],"click",function(){if(a.activeDropMenu){j.hideActiveDropMenu(a);this==a.contentDoc&&a.contentWin.focus()}});this._initResizeEvent(c,e,f);return e.childNodes[1]},_setDropMenuPosition:function(a,c,f){var e=h.getRegion(a);a=e.left;e=e.bottom;if(f){a+=f[0];e+=f[1]}c.style.left=a+"px";c.style.top=e+"px"},_isVisible:function(a){if(!a)return false;return a.style.display!=
"none"},hideActiveDropMenu:function(a){this._hide(a);a.activeDropMenu=null;a.activeDropButton=null},_hide:function(a){var c=a.activeDropMenu;a=a.activeDropButton;if(c){b&&(b.style.display="none");c.style.display="none"}a&&h.removeClass(a,"ks-editor-toolbar-button-selected")},_show:function(a){var c=a.activeDropMenu;a=a.activeDropButton;if(c){c.style.display="";if(k.ie===6){this._updateShimRegion(c);b.style.display=""}}a&&h.addClass(a,"ks-editor-toolbar-button-selected")},_updateShimRegion:function(a){if(a)if(k.ie===
6){b||this._initShim();this._setShimRegion(a)}},_initResizeEvent:function(a,c,f){var e=this,j;d.on(window,"resize",function(){j&&clearTimeout(j);j=setTimeout(function(){e._isVisible(c)&&e._setDropMenuPosition(a,c,f)},50)})},_initShim:function(){b=document.createElement("iframe");b.src="about:blank";b.className="ks-editor-drop-menu-shim";b.style.position="absolute";b.style.display="none";b.style.border="none";document.body.appendChild(b)},_setShimRegion:function(a){if(b&&this._isVisible(a)){a=h.getRegion(a);
if(a.width>0){b.style.left=a.left+"px";b.style.top=a.top+"px";b.style.width=a.width-1+"px";b.style.height=a.height-1+"px"}}}}});KISSY.Editor.add("smilies~config~default",function(i){i.Smilies=i.Smilies||{};i.Smilies["default"]={name:"default",mode:"icons",cols:5,fileNames:["smile","confused","cool","cry","eek","angry","wink","sweat","lol","stun","razz","shy","rolleyes","sad","happy","yes","no","heart","idea","rose"],fileExt:"gif"}});
KISSY.Editor.add("smilies~config~wangwang",function(i){i.Smilies=i.Smilies||{};i.Smilies.wangwang={name:"wangwang",mode:"sprite",base:"http://a.tbcdn.cn/sys/wangwang/smiley/48x48/",spriteStyle:"background: url(http://a.tbcdn.cn/sys/wangwang/smiley/sprite.png) no-repeat -1px 0; width: 288px; height: 235px",unitStyle:"width: 24px; height: 24px",filePattern:{start:0,end:98,step:1},fileExt:"gif"}});
KISSY.Editor.add("plugins~base",function(i){var m=i.PLUGIN_TYPE;i.addPlugin("bold,italic,underline,strikeThrough,insertOrderedList,insertUnorderedList".split(","),{type:m.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~color",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.env.ua.ie,b=["000","444","666","999","CCC","EEE","F3F3F3","FFF"],a=["F00","F90","FF0","0F0","0FF","00F","90F","F0F"],c=["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D2E9","EAD1DC","EA9999","F9CB9C","FFE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD","E06666","F6B26B","FFD966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BAD","CC0000","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A64D79","990000",
"B45F06","BF9000","38761D","134F5C","0B5394","351C75","741B47","660000","783F04","7F6000","274E13","0C343D","073763","20124D","4C1130"];i.addPlugin(["foreColor","backColor"],{type:i.PLUGIN_TYPE.TOOLBAR_MENU_BUTTON,color:"",_indicator:null,swatches:null,dropMenu:null,range:null,init:function(){var f=this.domEl,e=f.getElementsByTagName("span")[0].parentNode;this.color=this._getDefaultColor();h.addClass(f,"ks-editor-toolbar-color-button");e.innerHTML='<div class="ks-editor-toolbar-color-button-indicator" style="border-bottom-color:'+
this.color+'">'+e.innerHTML+"</div>";this._indicator=e.firstChild;this._renderUI();this._bindUI();this.swatches=h.getElementsByClassName("ks-editor-palette-colorswatch","div",this.dropMenu)},_renderUI:function(){this.dropMenu=i.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._generatePalettes();k&&i.Dom.setItemUnselectable(this.dropMenu)},_bindUI:function(){this._bindPickEvent();d.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();k&&this.editor.contentDoc.selection.empty();
this._updateSelectedColor(this.color)},this,true)},_generatePalettes:function(){var f="";f+=this._getPaletteTable(b);f+=this._getPaletteTable(a);f+=this._getPaletteTable(c);this.dropMenu.innerHTML=f},_getPaletteTable:function(f){var e,j=f.length,g,l="<tr>";e=0;for(j=f.length;e<j;++e){if(e!=0&&e%8==0)l+="</tr><tr>";g=i.Color.toRGB("#"+f[e]).toUpperCase();l+='<td class="ks-editor-palette-cell"><div class="ks-editor-palette-colorswatch" title="{COLOR}" style="background-color:{COLOR}"></div></td>'.replace(/{COLOR}/g,
g)}l+="</tr>";return'<div class="ks-editor-palette-table"><table><tbody>{TR}</tbody></table></div>'.replace("{TR}",l)},_bindPickEvent:function(){var f=this;d.on(this.dropMenu,"click",function(e){var j=d.getTarget(e).getAttribute("title");j&&j.indexOf("RGB")===0&&f._doAction(j);d.stopPropagation(e);i.Menu.hideActiveDropMenu(f.editor)})},_doAction:function(f){if(f){this.setColor(i.Color.toHex(f));f=this.range;k&&f.select&&f.select();this.editor.execCommand(this.name,this.color)}},setColor:function(f){this.color=
f;this._updateIndicatorColor(f);this._updateSelectedColor(f)},_updateIndicatorColor:function(f){this._indicator.style.borderBottomColor=f},_updateSelectedColor:function(f){var e,j,g,l=this.swatches;e=0;for(j=l.length;e<j;++e){g=l[e];i.Color.toHex(g.style.backgroundColor)==f?h.addClass(g.parentNode,"ks-editor-palette-cell-selected"):h.removeClass(g.parentNode,"ks-editor-palette-cell-selected")}},_getDefaultColor:function(){return this.name=="foreColor"?"#000000":"#ffffff"}})});
KISSY.Editor.add("plugins~font",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.env.ua,b={"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7};i.addPlugin(["fontName","fontSize"],{type:i.PLUGIN_TYPE.TOOLBAR_SELECT,selectedValue:"",selectHead:null,selectList:null,options:[],items:null,selectedItem:null,range:null,init:function(){this.options=this.lang.options;this.selectHead=this.domEl.getElementsByTagName("span")[0];this._renderUI();this._bindUI()},_renderUI:function(){this.selectList=
i.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);this._renderSelectList();this.items=this.selectList.getElementsByTagName("li")},_bindUI:function(){this._bindPickEvent();d.on(this.domEl,"click",function(){this.range=this.editor.getSelectionRange();k.ie&&this.editor.contentDoc.selection.empty();if(this.selectedValue)this._updateSelectedOption(this.selectedValue);else if(this.selectedItem){h.removeClass(this.selectedItem,"ks-editor-option-selected");this.selectedItem=null}},this,true)},_renderSelectList:function(){var a=
"",c=this.options,f,e;for(f in c){e=c[f];a+='<li class="ks-editor-option" data-value="{VALUE}"><span class="ks-editor-option-checkbox"></span><span style="{STYLE}">{KEY}</span></li>'.replace("{VALUE}",e).replace("{STYLE}",this._getOptionStyle(f,e)).replace("{KEY}",f)}this.selectList.innerHTML='<ul class="ks-editor-select-list">{LI}</ul>'.replace("{LI}",a);h.addClass(this.selectList,"ks-editor-drop-menu-"+this.name)},_bindPickEvent:function(){var a=this;d.on(this.selectList,"click",function(c){var f=
d.getTarget(c);if(f.nodeName!="LI")f=h.getAncestorByTagName(f,"li");if(f){a._doAction(f.getAttribute("data-value"));d.stopPropagation(c);i.Menu.hideActiveDropMenu(a.editor)}});if(k.ie===6){d.on(this.items,"mouseenter",function(){h.addClass(this,"ks-editor-option-hover")});d.on(this.items,"mouseleave",function(){h.removeClass(this,"ks-editor-option-hover")})}},_doAction:function(a){if(a){this.selectedValue=a;this._setOption(a);a=this.range;k.ie&&a.select&&a.select();this.editor.execCommand(this.name,
this.selectedValue)}},_setOption:function(a){this._updateHeadText(this._getOptionKey(a));this._updateSelectedOption(a)},_getOptionStyle:function(a,c){return this.name=="fontName"?"font-family:"+c:"font-size:"+a+"px"},_getOptionKey:function(a){var c=this.options,f;for(f in c)if(c[f]==a)return f;return null},_updateHeadText:function(a){this.selectHead.innerHTML=a},_updateSelectedOption:function(a){var c=this.items,f,e=c.length,j;for(f=0;f<e;++f){j=c[f];if(j.getAttribute("data-value")==a){h.addClass(j,
"ks-editor-option-selected");this.selectedItem=j}else h.removeClass(j,"ks-editor-option-selected")}},updateState:function(){var a=this.editor.contentDoc,c=this.options,f=this.name,e,j;try{if(a.queryCommandEnabled(f)){j=a.queryCommandValue(f);if(k.webkit&&f=="fontSize")j=this._getWebkitFontSize(j);j&&(e=this._getOptionKey(j));if(e in c){if(j!=this.selectedValue){this.selectedValue=j;this._updateHeadText(e)}}else{this.selectedValue="";this._updateHeadText(this.lang.text)}}}catch(g){}},_getWebkitFontSize:function(a){if(a in
b)return b[a];return null}})});
KISSY.Editor.add("plugins~image",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=m.Connect,b=YAHOO.lang,a=YAHOO.env.ua,c=a.ie,f="ks-editor-image-tab-selected",e={local:'<li rel="local" class="'+f+'">{tab_local}</li>',link:'<li rel="link">{tab_link}</li>',album:'<li rel="album">{tab_album}</li>'},j={tabs:["link"],upload:{actionUrl:"",filter:"png|gif|jpg|jpeg",filterMsg:"",enableXdr:false,connectionSwf:"http://a.tbcdn.cn/yui/2.8.0r4/build/connection/connection.swf",formatResponse:function(g){var l=[];
for(var n in g)l.push(g[n]);return l},extraCode:""}};i.addPlugin("image",{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,form:null,range:null,currentTab:null,currentPanel:null,uploadingPanel:null,actionsBar:null,init:function(){var g=this.editor.config.pluginsConfig[this.name]||{};j.upload.filterMsg=this.lang.upload_filter;this.config=b.merge(j,g);this.config.upload=b.merge(j.upload,g.upload||{});this._renderUI();this._bindUI();this.actionsBar=h.getElementsByClassName("ks-editor-dialog-actions",
"div",this.dialog)[0];this.uploadingPanel=h.getElementsByClassName("ks-editor-image-uploading","div",this.dialog)[0];this.config.upload.enableXdr&&this._initXdrUpload()},_renderUI:function(){var g=i.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),l=this.lang;l.local_extraCode=this.config.upload.extraCode;g.className+=" ks-editor-image";g.innerHTML='<form action="javascript: void(0)"><ul class="ks-editor-image-tabs ks-clearfix"></ul><div class="ks-editor-image-tab-content" rel="local" style="display: none"><label>{label_local}</label><input type="file" size="40" name="imgFile" unselectable="on" />{local_extraCode}</div><div class="ks-editor-image-tab-content" rel="link"><label>{label_link}</label><input name="imgUrl" size="50" /></div><div class="ks-editor-image-tab-content" rel="album" style="display: none"><label>{label_album}</label><p style="width: 300px">\u5c1a\u672a\u5b9e\u73b0...</p></div><div class="ks-editor-image-uploading" style="display: none"><p style="width: 300px">{uploading}</p></div><div class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span></div></form>'.replace(/\{([^}]+)\}/g,
function(n,o){return o in l?l[o]:o});this.dialog=g;this.form=g.getElementsByTagName("form")[0];c&&i.Dom.setItemUnselectable(g);this._renderTabs()},_renderTabs:function(){function g(w){for(var r=0,x=w.getAttribute("rel"),s=0;s<y;s++){u[s]&&h.removeClass(u[s],f);p[s].style.display="none";if(p[s].getAttribute("rel")==x)r=s}a.ie===6&&i.Menu._updateShimRegion(n.dialog);h.addClass(w,f);p[r].style.display="";n.currentTab=w.getAttribute("rel");n.currentPanel=p[r]}for(var l=this.lang,n=this,o=h.getElementsByClassName("ks-editor-image-tabs",
"ul",this.dialog)[0],p=h.getElementsByClassName("ks-editor-image-tab-content","div",this.dialog),q=this.config.tabs,t="",v=0,z=q.length;v<z;v++)t+=e[q[v]];o.innerHTML=t.replace(/\{([^}]+)\}/g,function(w,r){return r in l?l[r]:r});var u=o.childNodes,y=p.length;u.length===1&&h.addClass(this.dialog,"ks-editor-image-no-tab");g(u[0]);d.on(u,"click",function(){g(this)})},_bindUI:function(){var g=this;d.on(this.domEl,"click",function(){if(g.dialog.style.visibility===c?"hidden":"visible")g._syncUI()});d.on(this.dialog,
"click",function(l){var n=d.getTarget(l),o=g.currentTab;switch(n.className){case "ks-editor-btn-ok":if(o==="local"){d.stopPropagation(l);g._insertLocalImage()}else g._insertWebImage();break;case "ks-editor-btn-cancel":break;default:d.stopPropagation(l)}})},_initXdrUpload:function(){for(var g=this.config.tabs,l=0,n=g.length;l<n;l++)if(g[l]==="local"){k.transport(this.config.upload.connectionSwf);break}},_insertLocalImage:function(){var g=this.form,l=this.config.upload,n=g.imgFile.value,o=l.actionUrl,
p=this;if(n&&o){if(l.filter!=="*"){n=n.substring(n.lastIndexOf(".")+1).toLowerCase();if(l.filter.indexOf(n)==-1){alert(l.filterMsg);p.form.reset();return}}this.uploadingPanel.style.display="";this.currentPanel.style.display="none";this.actionsBar.style.display="none";a.ie===6&&i.Menu._updateShimRegion(this.dialog);k.setForm(g,true);k.asyncRequest("post",o,{upload:function(q){try{var t=l.formatResponse(b.JSON.parse(q.responseText));if(t[0]=="0"){p._insertImage(t[1]);p._hideDialog()}else p._onUploadError(t[1])}catch(v){p._onUploadError(b.dump(v)+
"\no = "+b.dump(q)+"\n[from upload catch code]")}},xdr:l.enableXdr})}else p._hideDialog()},_onUploadError:function(g){alert(this.lang.upload_error+"\n\n"+g);this._hideDialog()},_insertWebImage:function(){var g=this.form.imgUrl.value;g&&this._insertImage(g)},_hideDialog:function(){var g=this.editor.activeDropMenu;g&&h.isAncestor(g,this.dialog)&&i.Menu.hideActiveDropMenu(this.editor);this.editor.contentWin.focus()},_syncUI:function(){this.range=i.Range.saveRange(this.editor);this.form.reset();this.uploadingPanel.style.display=
"none";this.currentPanel.style.display="";this.actionsBar.style.display=""},_insertImage:function(g,l){g=b.trim(g);if(g.length!==0){var n=this.editor,o=this.range;if(window.getSelection){var p=n.contentDoc.createElement("img");p.src=g;l&&p.setAttribute("alt",l);o.deleteContents();o.insertNode(p);if(a.webkit){l=n.contentWin.getSelection();l.addRange(o);l.collapseToEnd()}else o.setStartAfter(p);n.contentWin.focus()}else if(document.selection){n.contentWin.focus();if("text"in o){o.select();n='<img src="'+
g+'"';l&&(n+=' "alt="'+l+'"');n+=">";o.pasteHTML(n)}else o.execCommand("insertImage",false,g)}}}})});KISSY.Editor.add("plugins~indent",function(i){i.addPlugin(["indent","outdent"],{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState()}})});
KISSY.Editor.add("plugins~justify",function(i){var m=["justifyLeft","justifyCenter","justifyRight"];i.addPlugin(m,{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name);this.editor.toolbar.updateState(m)}})});
KISSY.Editor.add("plugins~keystroke",function(i){var m=YAHOO.util.Event,h=YAHOO.env.ua;i.addPlugin("keystroke",{type:i.PLUGIN_TYPE.FUNC,init:function(){var d=this.editor;h.ie&&h.ie<8&&m.on(d.contentDoc,"keydown",function(b){b.keyCode==9&&this.selection.empty()});var k=d.textarea.form;k&&(new YAHOO.util.KeyListener(d.contentDoc,{ctrl:true,keys:13},{fn:function(){if(!d.sourceMode)d.textarea.value=d.getData();k.submit()}})).enable()}})});
KISSY.Editor.add("plugins~link",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.lang,b=YAHOO.env.ua,a=b.ie;m=i.PLUGIN_TYPE;var c=i.Range,f=(new Date).getTime(),e=/^\w+:\/\/.*|#.*$/,j=['<form onsubmit="return false"><ul><li class="ks-editor-link-href"><label>{href}</label><input name="href" style="width: 220px" value="http://" type="text" /></li><li class="ks-editor-link-target"><input name="target" id="target_"',f,' type="checkbox" /> <label for="target_"',f,'>{target}</label></li><li class="ks-editor-dialog-actions"><button name="ok" class="ks-editor-btn-ok">{ok}</button><span class="ks-editor-btn-cancel">{cancel}</span><span class="ks-editor-link-remove">{remove}</span></li></ul></form>'].join("");
i.addPlugin("link",{type:m.TOOLBAR_BUTTON,dialog:null,form:null,range:null,init:function(){this._renderUI();this._bindUI()},_renderUI:function(){var g=i.Menu.generateDropMenu(this.editor,this.domEl,[1,0]),l=this.lang;g.className+=" ks-editor-link";g.innerHTML=j.replace(/\{([^}]+)\}/g,function(n,o){return l[o]?l[o]:o});this.dialog=g;this.form=g.getElementsByTagName("form")[0];b.webkit&&(this.form.target.parentNode.style.display="none");a&&i.Dom.setItemUnselectable(g)},_bindUI:function(){var g=this.form,
l=this;d.on(this.domEl,"click",function(){if(l.dialog.style.visibility===a?"hidden":"visible")l._syncUI()});d.on(this.dialog,"click",function(n){switch(d.getTarget(n).className){case "ks-editor-btn-ok":l._createLink(g.href.value,g.target.checked);break;case "ks-editor-btn-cancel":break;case "ks-editor-link-remove":l._unLink();break;default:d.stopPropagation(n)}})},_syncUI:function(){this.range=i.Range.saveRange(this.editor);var g=this.form,l;l=c.getCommonAncestor(this.range);if(l=l.nodeName=="A"?
l:h.getAncestorByTagName(l,"A")){g.href.value=l.href;g.target.checked=l.target==="_blank";h.removeClass(g,"ks-editor-link-newlink-mode")}else{g.href.value="http://";g.target.checked=false;h.addClass(g,"ks-editor-link-newlink-mode")}setTimeout(function(){g.href.select()},50)},_createLink:function(g,l){g=this._getValidHref(g);if(g.length===0)this._unLink();else{var n=this.range,o=document.createElement("div"),p;p=c.getCommonAncestor(n);if(p=p.nodeName=="A"?p:h.getAncestorByTagName(p,"A")){p.href=g;
l?p.setAttribute("target","_blank"):p.removeAttribute("target")}else{p=document.createElement("a");p.href=g;l&&p.setAttribute("target","_blank");if(a){n.select&&n.select();if("text"in n){p.innerHTML=n.htmlText||g;o.innerHTML="";o.appendChild(p);n.pasteHTML(o.innerHTML)}else this.editor.execCommand("createLink",g)}else if(b.webkit)this.editor.execCommand("createLink",g);else{if(n.collapsed)p.innerHTML=g;else for(g=n.cloneContents();g.firstChild;)p.appendChild(g.firstChild);n.deleteContents();n.insertNode(p);
n.selectNode(p)}}}},_getValidHref:function(g){if((g=k.trim(g))&&!e.test(g))g="http://"+g;return g},_unLink:function(){var g=this.editor,l=this.range,n=c.getSelectedText(l),o=c.getCommonAncestor(l);if(!n&&o.nodeType==3){g=o.parentNode;g.nodeName=="A"&&g.parentNode.replaceChild(o,g)}else{l.select&&l.select();g.execCommand("unLink",null)}}})});
KISSY.Editor.add("plugins~resize",function(i){var m=YAHOO.util.Event;i.addPlugin("resize",{type:i.PLUGIN_TYPE.STATUSBAR_ITEM,contentEl:null,currentHeight:0,init:function(){this.contentEl=this.editor.container.childNodes[1];this.currentHeight=parseInt(this.contentEl.style.height);this.renderUI();this.bindUI()},renderUI:function(){var h=this.lang;this.domEl.innerHTML='<span class="ks-editor-resize-larger" title="{larger_title}">{larger_text}</span><span class="ks-editor-resize-smaller" title="{smaller_title}">{smaller_text}</span>'.replace(/\{([^}]+)\}/g,
function(d,k){return h[k]?h[k]:k})},bindUI:function(){var h=this.domEl.getElementsByTagName("span"),d=h[1];m.on(h[0],"click",function(){this.currentHeight+=100;this._doResize()},this,true);m.on(d,"click",function(){if(this.currentHeight<100)this.currentHeight=0;else this.currentHeight-=100;this._doResize()},this,true)},_doResize:function(){this.contentEl.style.height=this.currentHeight+"px";this.editor.textarea.style.height=this.currentHeight+"px"}})});
KISSY.Editor.add("plugins~save",function(i){var m=YAHOO.util.Event,h={b:{tag:"strong"},i:{tag:"em"},u:{tag:"span",style:"text-decoration:underline"},strike:{tag:"span",style:"text-decoration:line-through"}};i.addPlugin("save",{type:i.PLUGIN_TYPE.FUNC,init:function(){var d=this.editor,k=d.textarea,b=k.form;b&&m.on(b,"submit",function(){if(!d.sourceMode)k.value=d.getData()})},filterData:function(d){d=d.replace(/<(\/?)([^>\s]+)([^>]*)>/g,function(k,b,a,c){a=a.toLowerCase();k=h[a];a=a;if(k&&!c){a=k.tag;
if(!b&&k.style)a+=' style="'+k.style+'"'}return"<"+b+a+c+">"});if(d.indexOf("mso")>0)d=this.filterWord(d);return d},filterWord:function(d){d=d.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3");d=d.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3");d=d.replace(/<H(\d)([^>]*)>/gi,"<h$1>");d=d.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>");d=d.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");d=d.replace(/<meta[^>]*>/ig,"");d=d.replace(/<link rel="\S+" href="file:[^>]*">/ig,
"");d=d.replace(/<!--\[if gte mso [0-9]{1,2}\]>[\s\S]*?<!\[endif\]--\>/ig,"");d=d.replace(/<style>[\s\S]*?mso[\s\S]*?<\/style>/ig,"");d=d.replace(/ lang=".+?"/ig,"");d=d.replace(/<o:p><\/o:p>/ig,"");return d=d.replace(/ class="Mso.+?"/ig,"")}})});
KISSY.Editor.add("plugins~smiley",function(i){var m=YAHOO.util.Event,h=YAHOO.lang,d=YAHOO.env.ua,k={tabs:["default"]};i.addPlugin("smiley",{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,config:{},dialog:null,range:null,init:function(){this.config=h.merge(k,this.editor.config.pluginsConfig[this.name]||{});this._renderUI();this._bindUI()},_renderUI:function(){var b=i.Menu.generateDropMenu(this.editor,this.domEl,[1,0]);b.className+=" ks-editor-smiley-dialog";this.dialog=b;this._renderDialog();d.ie&&i.Dom.setItemUnselectable(b)},
_renderDialog:function(){var b=i.Smilies[this.config.tabs[0]],a=b.mode;if(a==="icons")this._renderIcons(b);else a==="sprite"&&this._renderSprite(b)},_renderIcons:function(b){var a=this.editor.config.base+"smilies/"+b.name+"/",c=b.fileNames,f="."+b.fileExt;b=b.cols;var e=[],j,g=c.length,l;e.push('<div class="ks-editor-smiley-icons">');for(j=0;j<g;j++){l=c[j];e.push('<img src="'+a+l+f+'" alt="'+l+'" title="'+l+'" />');j%b===b-1&&e.push("<br />")}e.push("</div");this.dialog.innerHTML=e.join("")},_renderSprite:function(b){var a=
b.base,c=b.filePattern,f="."+b.fileExt,e=c.end+1;c=c.step;var j,g=[];g.push('<div class="ks-editor-smiley-sprite ks-clearfix" style="'+b.spriteStyle+'">');for(j=0;j<e;j+=c)g.push('<span data-icon="'+a+j+f+'" style="'+b.unitStyle+'"></span>');g.push("</div");this.dialog.innerHTML=g.join("")},_bindUI:function(){var b=this;m.on(this.domEl,"click",function(){b.range=i.Range.saveRange(b.editor)});m.on(this.dialog,"click",function(a){var c=m.getTarget(a);switch(c.nodeName){case "IMG":b._insertImage(c.src,
c.getAttribute("alt"));break;case "SPAN":b._insertImage(c.getAttribute("data-icon"),"");break;default:m.stopPropagation(a)}})},_insertImage:function(b,a){b=h.trim(b);if(b.length!==0){var c=this.editor,f=this.range;if(window.getSelection){var e=c.contentDoc.createElement("img");e.src=b;e.setAttribute("alt",a);f.deleteContents();f.insertNode(e);if(d.webkit){b=c.contentWin.getSelection();b.addRange(f);b.collapseToEnd()}else f.setStartAfter(e);c.contentWin.focus()}else if(document.selection)"text"in f?
f.pasteHTML('<img src="'+b+'" alt="'+a+'" />'):c.execCommand("insertImage",b)}}})});
KISSY.Editor.add("plugins~source",function(i){var m=YAHOO.util.Dom,h=YAHOO.env.ua;i.addPlugin("source",{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,init:function(){var d=this.editor;this.iframe=d.contentWin.frameElement;this.textarea=d.textarea;this.iframe.parentNode.appendChild(d.textarea);m.addClass(this.domEl,"ks-editor-toolbar-source-button")},exec:function(){var d=this.editor,k=d.sourceMode;if(k)d.contentDoc.body.innerHTML=this.textarea.value;else this.textarea.value=d.getContentDocData();h.ie&&h.ie<8&&
d.contentDoc.selection.empty();this.textarea.style.display=k?"none":"";this.iframe.style.display=k?"":"none";d.sourceMode=!k;this._updateButtonState()},_updateButtonState:function(){var d=this.editor;if(d.sourceMode){m.addClass(d.container,"ks-editor-src-mode");m.addClass(this.domEl,"ks-editor-toolbar-button-selected")}else{m.removeClass(d.container,"ks-editor-src-mode");m.removeClass(this.domEl,"ks-editor-toolbar-button-selected")}}})});
KISSY.Editor.add("plugins~undo",function(i){i.addPlugin(["undo","redo"],{type:i.PLUGIN_TYPE.TOOLBAR_BUTTON,exec:function(){this.editor.execCommand(this.name)}})});
KISSY.Editor.add("plugins~wordcount",function(i){var m=YAHOO.util,h=m.Dom,d=m.Event,k=YAHOO.lang,b={total:5E4,threshold:100};i.addPlugin("wordcount",{type:i.PLUGIN_TYPE.STATUSBAR_ITEM,total:Infinity,remain:Infinity,threshold:0,remainEl:null,init:function(){var a=k.merge(b,this.editor.config.pluginsConfig[this.name]||{});this.total=a.total;this.threshold=a.threshold;this.renderUI();this.bindUI();var c=this;setTimeout(function(){c.syncUI()},50)},renderUI:function(){this.domEl.innerHTML=this.lang.tmpl.replace("%remain%",
"<em>"+this.total+"</em>");this.remainEl=this.domEl.getElementsByTagName("em")[0]},bindUI:function(){var a=this.editor;d.on(a.textarea,"keyup",this.syncUI,this,true);d.on(a.contentDoc,"keyup",this.syncUI,this,true);d.on(a.container,"click",this.syncUI,this,true)},syncUI:function(){this.remain=this.total-this.editor.getData().length;this.remainEl.innerHTML=this.remain;this.remain<=this.threshold?h.addClass(this.domEl,"ks-editor-wordcount-alarm"):h.removeClass(this.domEl,"ks-editor-wordcount-alarm")}})});
