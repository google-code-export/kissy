/*
Copyright (c) 2009, Kissy UI Library. All rights reserved.
MIT Licensed.
http://kissy.googlecode.com/

Date: 2009-12-30 12:18:33
Revision: 380
*/
if(typeof KISSY==="undefined"||!KISSY){function KISSY(b){var a=this;if(!(a instanceof arguments.callee)){return new arguments.callee(b)}a._init();a._config(b);a._setup();return a}}(function(a){var d=window,c="undefined",e=Array.prototype.slice,b=function(k,j,h,n){if(!j||!k){return k}if(typeof h===c){h=true}var g,m,f;if(n&&(f=n.length)){for(g=0;g<f;g++){m=n[g];if(m in j){if(h||!(m in k)){k[m]=j[m]}}}}else{for(m in j){if(h||!(m in k)){k[m]=j[m]}}}return k};b(a.prototype,{add:function(g,i,f,h){a.Env.mods[g]={name:g,fn:i,version:f,details:h||{}};return this},_init:function(){var f=this;f.version="@VERSION@";f.Env={mods:{},_used:{},_attached:{}};f.config={debug:true}},_config:function(f){b(this.config,f)},_setup:function(){this.use("kissy-core")},use:function(){var j=this,s=e.call(arguments,0),u=a.Env.mods,v=j.Env._used,m=s.length,t=s[m-1],p,n,h,g=[];if(typeof t==="function"){s.pop()}else{t=null}if(s[0]==="*"){s=[];for(n in u){s.push(n)}if(t){s.push(t)}return j.use.apply(j,s)}function q(k){if(v[k]){return}var f=u[k],i,o,l;if(f){v[k]=true;l=f.details.submodules}g.push(k);if(l){if(typeof l==="string"){l=[l]}for(i=0,o=l.length;i<o;i++){q(l[i])}}}for(p=0;p<m;p++){q(s[p])}j._attach(g);if(t){t(j)}return j},_attach:function(o){var n=a.Env.mods,k=this.Env._attached,j,g=o.length,h,f;for(j=0;j<g;j++){h=o[j];f=n[h];if(!k[h]&&f){k[h]=true;if(f.fn){f.fn(this)}}}},mix:b,merge:function(){var g=arguments,j={},h,f=g.length;for(h=0;h<f;++h){b(j,g[h],true)}return j},extend:function(j,i,g,m){if(!i||!j){return j}var f=Object.prototype,l=function(p){function n(){}n.prototype=p;return new n()},k=i.prototype,h=l(k);j.prototype=h;h.constructor=j;j.superclass=k;if(i!==Object&&k.constructor===f.constructor){k.constructor=i}if(g){b(h,g)}if(m){b(j,m)}return j},augment:function(h,g,f,i){return b(h.prototype,g.prototype,f,i)},each:function(f,j,k){var g=(f&&f.length)||0,h;for(h=0;h<g;h++){j.call(k||this,f[h],h,f)}return this},ready:function(){},weave:function(h,g,i,j){var f=[i[j],h];if(g==="before"){f.reverse()}i[j]=function(){for(var l=0,k=e.call(arguments,0);l<2;l++){f[l].apply(this,k)}};return this},cloneTo:function(f){function g(h){if(!(this instanceof g)){return new g(h)}g.superclass.constructor.call(this,h)}a.extend(g,a,null,a);return(d[f]=g)},namespace:function(){var g=arguments,f=g.length,n=this,k,h,m;if(typeof n==="object"){n=n.constructor}for(k=0;k<f;k++){m=(""+g[k]).split(".");for(h=(d[m[0]]===n)?1:0;h<m.length;h++){n[m[h]]=n[m[h]]||{};n=n[m[h]]}}return n},log:function(h,f,g){var i=this.config;if(i.debug){g&&(h=g+": "+h);if(typeof console!==c&&console.log){console[f&&console[f]?f:"log"](h)}}return this}});b(a,a.prototype);a._init()})(KISSY);KISSY.add("datalazyload",function(g){var a=YAHOO.util,h=a.Dom,n=a.Event,j=YAHOO.lang,k=window,m=document,l="data-lazyload-src",o="ks-datalazyload",f=l+"-custom",b=o+"-custom",d={AUTO:"auto",MANUAL:"manual"},i="default",e={mod:d.MANUAL,diff:i,placeholder:"http://a.tbcdn.cn/kissy/1.0.2/build/datalazyload/dot.gif"};function c(r,q){var p=this;if(!(p instanceof arguments.callee)){return new arguments.callee(r,q)}if(typeof q==="undefined"){q=r;r=[m]}if(!j.isArray(r)){r=[h.get(r)||m]}p.containers=r;p.config=g.merge(e,q||{});p.callbacks={els:[],fns:[]};setTimeout(function(){p._init()},0)}g.mix(c.prototype,{_init:function(){var p=this;p.threshold=p._getThreshold();p._filterItems();if(p._getItemsLength()){p._initLoadEvent()}},_initLoadEvent:function(){var s,r=this;n.on(k,"scroll",p);n.on(k,"resize",function(){r.threshold=r._getThreshold();p()});if(r._getItemsLength()){n.onDOMReady(function(){q()})}function p(){if(s){return}s=setTimeout(function(){q();s=null},100)}function q(){r._loadItems();if(r._getItemsLength()===0){n.removeListener(k,"scroll",p);n.removeListener(k,"resize",p)}}},_filterItems:function(){var B=this,q=B.containers,w=B.threshold,A=B.config.placeholder,r=B.config.mod===d.MANUAL,p,y,v,u,t,x,s,D,C=[],z=[];for(p=0,y=q.length;p<y;++p){v=q[p].getElementsByTagName("img");for(t=0,x=v.length;t<x;++t){s=v[t];D=s.getAttribute(l);if(r){if(D){s.src=A;C.push(s)}}else{if(h.getY(s)>w&&!D){s.setAttribute(l,s.src);s.src=A;C.push(s)}}}u=q[p].getElementsByTagName("textarea");for(t=0,x=u.length;t<x;++t){if(h.hasClass(u[t],o)){z.push(u[t])}}}B.images=C;B.areaes=z},_loadItems:function(){var p=this;p._loadImgs();p._loadAreaes();p._fireCallbacks()},_loadImgs:function(){var r=this,w=r.images,t=h.getDocumentScrollTop(),p=r.threshold+t,s,q,v,u=[];for(s=0;q=w[s++];){if(h.getY(q)<=p){r._loadImgSrc(q)}else{u.push(q)}}r.images=u},_loadImgSrc:function(q,p){p=p||l;var r=q.getAttribute(p);if(r&&q.src!=r){q.src=r;q.removeAttribute(p)}},_loadAreaes:function(){var q=this,u=q.areaes,v=h.getDocumentScrollTop(),p=q.threshold+v,r,t,s,w=[];for(r=0;t=u[r++];){s=t.parentNode;if(h.getY(s)<=p){s.innerHTML=t.value}else{w.push(t)}}q.areaes=w},_fireCallbacks:function(){var z=this,v=z.callbacks,s=v.els,y=v.fns,p=h.getDocumentScrollTop(),u=z.threshold+p,t,q,x,w=[],r=[];for(t=0;(q=s[t])&&(x=y[t++]);){if(h.getY(q)<=u){x.call(q)}else{w.push(q);r.push(x)}}v.els=w;v.fns=r},addCallback:function(q,p){q=h.get(q);if(q&&typeof p==="function"){this.callbacks.els.push(q);this.callbacks.fns.push(p)}},_getThreshold:function(){var q=this.config.diff,p=h.getViewportHeight();if(q===i){return 2*p}else{return p+q}},_getItemsLength:function(){var p=this;return p.images.length+p.areaes.length+p.callbacks.els.length},loadCustomLazyData:function(t,s,q){var r=this,p,u;if(!j.isArray(t)){t=[h.get(t)]}g.each(t,function(w){switch(s){case"textarea-data":p=w.getElementsByTagName("textarea")[0];if(p&&h.hasClass(p,q||b)){w.innerHTML=p.value}break;default:if(w.nodeName==="IMG"){u=[w]}else{u=w.getElementsByTagName("img")}for(var x=0,v=u.length;x<v;x++){r._loadImgSrc(u[x],q||f)}}})}});g.mix(c,c.prototype,true,["loadCustomLazyData","_loadImgSrc"]);g.DataLazyload=c});KISSY.add("widget",function(a){function b(c,e){var d=this;if(!(d instanceof b)){return new b(c,e)}d.container=YAHOO.util.Dom.get(c);d.config=e||{}}a.Widget=b});KISSY.add("switchable",function(g){var c=YAHOO.util,i=c.Dom,o=c.Event,k=YAHOO.lang,l="undefined",d="display",a="block",n="none",b="forward",f="backward",j="switchable",m="beforeSwitch",h="onSwitch",e="ks-switchable-";function p(){}p.Config={mackupType:0,navCls:e+"nav",contentCls:e+"content",triggerCls:e+"trigger",panelCls:e+"panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"active",steps:1,viewSize:[]};g.Widget.prototype.switchable=function(r){var q=this;r=r||{};if(r.panelCls){p.Config.mackupType=1}else{if(r.panels){p.Config.mackupType=2}}q.config[j]=g.merge(p.Config,r||{});q.triggers=q.triggers||[];q.panels=q.panels||[];if(typeof q.activeIndex===l){q.activeIndex=q.config[j].activeIndex}g.mix(q,p.prototype,false);q._initSwitchable();return q};g.mix(p.prototype,{_initSwitchable:function(){var r=this,q=r.config[j];if(r.panels.length===0){r._parseSwitchableMackup()}r.createEvent(m);r.createEvent(h);if(q.hasTriggers){r._bindTriggers()}},_parseSwitchableMackup:function(){var A=this,r=A.container,v=A.config[j],B=v.hasTriggers,q,w,y=[],x=[],u,s,t,z=i.getElementsByClassName;switch(v.mackupType){case 0:q=z(v.navCls,"*",r)[0];if(q){y=i.getChildren(q)}w=z(v.contentCls,"*",r)[0];x=i.getChildren(w);break;case 1:y=z(v.triggerCls,"*",r);x=z(v.panelCls,"*",r);break;case 2:y=v.triggers;x=v.panels;break}s=x.length;A.length=s/v.steps;if(B&&s>0&&y.length===0){y=A._generateTriggersMackup(A.length)}if(B){for(u=0,t=y.length;u<t;u++){A.triggers.push(y[u])}}for(u=0;u<s;u++){A.panels.push(x[u])}A.content=w||x[0].parentNode},_generateTriggersMackup:function(r){var t=this,s=t.config[j],v=document.createElement("UL"),q,u;v.className=s.navCls;for(u=0;u<r;u++){q=document.createElement("LI");if(u===t.activeIndex){q.className=s.activeTriggerCls}q.innerHTML=u+1;v.appendChild(q)}t.container.appendChild(v);return i.getChildren(v)},_bindTriggers:function(){var s=this,r=s.config[j],v=s.triggers,t,u,q=v.length;for(u=0;u<q;u++){(function(w){t=v[w];o.on(t,"click",function(){s._onFocusTrigger(w)});o.on(t,"focus",function(){s._onFocusTrigger(w)});if(r.triggerType==="mouse"){o.on(t,"mouseenter",function(){s._onMouseEnterTrigger(w)});o.on(t,"mouseleave",function(){s._onMouseLeaveTrigger(w)})}})(u)}},_onFocusTrigger:function(r){var q=this;if(q.activeIndex===r){return}if(q.switchTimer){q.switchTimer.cancel()}q.switchTo(r)},_onMouseEnterTrigger:function(r){var q=this;if(q.activeIndex!==r){q.switchTimer=k.later(q.config[j].delay*1000,q,function(){q.switchTo(r)})}},_onMouseLeaveTrigger:function(){var q=this;if(q.switchTimer){q.switchTimer.cancel()}},switchTo:function(r,x){var y=this,s=y.config[j],u=y.triggers,t=y.panels,z=y.activeIndex,v=s.steps,w=z*v,q=r*v;if(r===z){return y}if(!y.fireEvent(m,r)){return y}if(s.hasTriggers){y._switchTrigger(z>-1?u[z]:null,u[r])}if(typeof x===l){x=r>z?b:b}y._switchView(t.slice(w,w+v),t.slice(q,q+v),r,x);y.activeIndex=r;return y},_switchTrigger:function(s,q){var r=this.config[j].activeTriggerCls;if(s){i.removeClass(s,r)}i.addClass(q,r)},_switchView:function(s,r,q){i.setStyle(s,d,n);i.setStyle(r,d,a);this.fireEvent(h,q)},prev:function(){var r=this,q=r.activeIndex;r.switchTo(q>0?q-1:r.length-1,f)},next:function(){var r=this,q=r.activeIndex;r.switchTo(q<r.length-1?q+1:0,b)}});g.augment(p,c.EventProvider);g.Switchable=p});KISSY.add("switchable-autoplay",function(c){var e=YAHOO.util,b=e.Event,d=YAHOO.lang,f="switchable",a=c.Switchable;c.mix(a.Config,{autoplay:false,interval:5,pauseOnHover:true});c.weave(function(){var h=this,g=h.config[f];if(!g.autoplay){return}if(g.pauseOnHover){b.on(h.container,"mouseenter",function(){h.paused=true});b.on(h.container,"mouseleave",function(){h.paused=false})}h.autoplayTimer=d.later(g.interval*1000,h,function(){if(h.paused){return}h.switchTo(h.activeIndex<h.length-1?h.activeIndex+1:0)},null,true)},"after",a.prototype,"_initSwitchable")});KISSY.add("switchable-effect",function(i){var d=YAHOO.util,j=d.Dom,l="switchable",h="display",a="block",n="none",p="opacity",g="z-index",k="relative",f="absolute",c="scrollx",b="scrolly",e="fade",o=i.Switchable,m;i.mix(o.Config,{effect:n,duration:0.5,easing:d.Easing.easeNone});o.Effects={none:function(r,q,s){j.setStyle(r,h,n);j.setStyle(q,h,a);s()},fade:function(v,q,w){if(v.length!==1){throw new Error("fade effect only supports steps == 1.")}var s=this,r=s.config[l],u=v[0],t=q[0];if(s.anim){s.anim.stop()}j.setStyle(t,p,1);s.anim=new d.Anim(u,{opacity:{to:0}},r.duration,r.easing);s.anim.onComplete.subscribe(function(){s.anim=null;j.setStyle(t,g,9);j.setStyle(u,g,1);w()});s.anim.animate()},scroll:function(u,r,w,s){var x=this,t=x.config[l],y=t.effect===c,v=x.viewSize[y?0:1]*s,q={};q[y?"left":"top"]={to:-v};if(x.anim){x.anim.stop()}x.anim=new d.Anim(x.content,q,t.duration,t.easing);x.anim.onComplete.subscribe(function(){x.anim=null;w()});x.anim.animate()}};m=o.Effects;m[c]=m[b]=m.scroll;i.weave(function(){var x=this,t=x.config[l],z=t.effect,u=x.panels,v=t.steps,y=x.activeIndex,w=y*v,q=w+v-1,r,s=u.length;x.viewSize=[t.viewSize[0]||u[0].offsetWidth*v,t.viewSize[0]||u[0].offsetHeight*v];if(z!==n){for(r=0;r<s;r++){u[r].style.display=a}switch(z){case c:case b:x.content.style.position=f;x.content.parentNode.style.position=k;if(z===c){j.setStyle(u,"float","left");this.content.style.width=x.viewSize[0]*(s/v)+"px"}break;case e:for(r=0;r<s;r++){j.setStyle(u[r],p,(r>=w&&r<=q)?1:0);u[r].style.position=f;u[r].style.zIndex=(r>=w&&r<=q)?9:1}break}}},"after",o.prototype,"_initSwitchable");i.mix(o.prototype,{_switchView:function(x,q,t,w){var s=this,r=s.config[l],v=r.effect,u=typeof v==="function"?v:m[v];u.call(s,x,q,function(){s.fireEvent("onSwitch",t)},t,w)}})});KISSY.add("switchable-circular",function(k){var e=YAHOO.util,m="switchable",l="relative",f="left",h="top",i="px",g="",d="forward",j="backward",c="scrollx",a="scrolly",o=k.Switchable;k.mix(o.Config,{circular:false});function p(y,s,C,v,A){var E=this,w=E.config[m],x=E.length,D=E.activeIndex,F=w.effect===c,q=F?f:h,u=E.viewSize[F?0:1],B=-u*v,r={},t,z=A===j;t=(z&&D===0&&v===x-1)||(A===d&&D===x-1&&v===0);if(t){B=b.call(E,E.panels,v,z,q,u)}r[q]={to:B};if(E.anim){E.anim.stop()}E.anim=new e.Anim(E.content,r,w.duration,w.easing);E.anim.onComplete.subscribe(function(){if(t){n.call(E,E.panels,v,z,q,u)}E.anim=null;C()});E.anim.animate()}function b(x,u,y,q,v){var C=this,w=C.config[m],z=w.steps,t=C.length,r=y?t-1:0,B=r*z,A=(r+1)*z,s;for(s=B;s<A;s++){x[s].style.position=l;x[s].style[q]=(y?"-":g)+v*t+i}return y?v:-v*t}function n(x,u,y,q,v){var C=this,w=C.config[m],z=w.steps,t=C.length,r=y?t-1:0,B=r*z,A=(r+1)*z,s;for(s=B;s<A;s++){x[s].style.position=g;x[s].style[q]=g}C.content.style[q]=y?-v*(t-1)+i:g}k.weave(function(){var s=this,q=s.config[m],t=q.effect,r=o.Effects;if(!q.circular||(t!==c&&t!==a)){return}r[c]=r[a]=r.scroll=p},"after",o.prototype,"_initSwitchable")});KISSY.add("switchable-lazyload",function(c){var a=YAHOO.util,d=a.Dom,e="switchable",g="beforeSwitch",h="img-src",f="textarea-data",i={},j=c.Switchable,b=c.DataLazyload;i[h]="data-lazyload-src-custom";i[f]="ks-datalazyload-custom";c.mix(j.Config,{lazyDataType:"",lazyDataFlag:""});c.weave(function(){var m=this,l=m.config[e],o=l.lazyDataType,k=l.lazyDataFlag||i[o];if(!b||!o||!k){return}m.subscribe(g,p);function p(r){var q=l.steps,t=r*q,s=t+q;b.loadCustomLazyData(m.panels.slice(t,s),o,k);if(n()){m.unsubscribe(g,p)}}function n(){var t,r,s,q;if(o===h){t=m.container.getElementsByTagName("img");for(s=0,q=t.length;s<q;s++){if(t[s].getAttribute(k)){return false}}}else{if(o===f){r=m.container.getElementsByTagName("textarea");for(s=0,q=r.length;s<q;s++){if(d.hasClass(r[s],k)){return false}}}}return true}},"after",j.prototype,"_initSwitchable")});KISSY.add("tabs",function(b){var c="switchable";function a(d,f){var e=this;if(!(e instanceof a)){return new a(d,f)}a.superclass.constructor.call(e,d,f);e.switchable(e.config);e.config=e.config[c];e.config[c]=e.config}b.extend(a,b.Widget);b.Tabs=a});KISSY.add("slide",function(b){var d="switchable",a={autoplay:true,circular:true};function c(e,g){var f=this;if(!(f instanceof c)){return new c(e,g)}g=b.merge(a,g||{});c.superclass.constructor.call(f,e,g);f.switchable(f.config);f.config=f.config[d];f.config[d]=f.config}b.extend(c,b.Widget);b.Slide=c});KISSY.add("carousel",function(b){var d="switchable",a={circular:true};function c(e,g){var f=this;if(!(f instanceof c)){return new c(e,g)}g=b.merge(a,g||{});c.superclass.constructor.call(f,e,g);f.switchable(f.config);f.config=f.config[d];f.config[d]=f.config}b.extend(c,b.Widget);b.Carousel=c});KISSY.add("megamenu",function(f){var c=YAHOO.util,g=c.Dom,l=c.Event,i=YAHOO.lang,k="none",a="block",b='<span class="{hook_cls}"></span>',h="switchable",e="ks-megamenu-",d={hideDelay:0.5,viewCls:e+"view",closeBtnCls:e+"closebtn",showCloseBtn:true,activeIndex:-1};function j(m,o){var n=this;if(!(n instanceof j)){return new j(m,o)}o=f.merge(d,o||{});j.superclass.constructor.call(n,m,o);n.switchable(n.config);n.config=n.config[h];n.config[h]=n.config;n._init()}f.extend(j,f.Widget);f.mix(j.prototype,{_init:function(){var m=this;m._initView();if(m.config.showCloseBtn){m._initCloseBtn()}},_onFocusTrigger:function(n){var m=this;if(m.activeIndex===n){return}if(m.switchTimer){m.switchTimer.cancel()}if(m.hideTimer){m.hideTimer.cancel()}m.switchTo(n)},_onMouseEnterTrigger:function(n){var m=this;if(m.hideTimer){m.hideTimer.cancel()}m.switchTimer=i.later(m.config.delay*1000,m,function(){m.switchTo(n)})},_onMouseLeaveTrigger:function(){var m=this;if(m.switchTimer){m.switchTimer.cancel()}m.hideTimer=i.later(m.config.hideDelay*1000,m,function(){m.hide()})},_initView:function(){var o=this,n=o.config,m=g.getElementsByClassName(n.viewCls,"*",o.container)[0];if(!m){m=document.createElement("DIV");m.className=n.viewCls;o.container.appendChild(m)}l.on(m,"mouseenter",function(){if(o.hideTimer){o.hideTimer.cancel()}});l.on(m,"mouseleave",function(){o.hideTimer=i.later(n.hideDelay*1000,o,"hide")});o.viewContent=m;o.view=m},_initCloseBtn:function(){var n=this,o,m=n.view;m.innerHTML=b.replace("{hook_cls}",n.config.closeBtnCls);l.on(m.firstChild,"click",function(){n.hide()});o=document.createElement("div");m.appendChild(o);n.viewContent=o},_switchView:function(m,n,p){var o=this;o.view.style.display=a;o.viewContent.innerHTML=n[0].innerHTML;o.fireEvent("onSwitch",p)},hide:function(){var m=this;g.removeClass(m.triggers[m.activeIndex],m.config.activeTriggerCls);m.view.style.display=k;m.activeIndex=-1}});f.MegaMenu=j});KISSY.add("suggest",function(a){if(KISSY.Suggest){a.Suggest=KISSY.Suggest;return}a.Suggest=KISSY.Suggest=(function(){var e=YAHOO.util,d=e.Dom,x=e.Event,g=YAHOO.lang,f=window,y=document,i=y.getElementsByTagName("head")[0],q=YAHOO.env.ua.ie,j=(q===6),r="g_ks_suggest_callback",m="suggest-style",b="suggest-container",w="suggest-key",c="suggest-result",p="selected",v="suggest-bottom",u="suggest-close-btn",t="suggest-shim",l="beforeDataRequest",k="onDataReturn",h="beforeShow",s="onItemSelect",o={containerClass:"",containerWidth:"auto",resultFormat:"\u7ea6%result%\u6761\u7ed3\u679c",showCloseBtn:false,closeBtnText:"\u5173\u95ed",useShim:j,timerDelay:200,autoFocus:false,submitFormOnClickSelect:true};function n(A,B,z){if(!(this instanceof arguments.callee)){return new arguments.callee(A,B,z)}this.textInput=d.get(A);this.dataSource=B;this.JSONDataSource=g.isObject(B)?B:null;this.returnedData=null;this.config=g.merge(o,z||{});this.container=null;this.query="";this.queryParams="";this._timer=null;this._isRunning=false;this.dataScript=null;this._dataCache={};this._latestScriptTime="";this._scriptDataIsOut=false;this._onKeyboardSelecting=false;this.selectedItem=null;this._init()}a.mix(n.prototype,{_init:function(){this._initTextInput();this._initContainer();if(this.config.useShim){this._initShim()}this._initStyle();this.createEvent(l);this.createEvent(k);this.createEvent(h);this.createEvent(s);this._initResizeEvent()},_initTextInput:function(){var z=this;this.textInput.setAttribute("autocomplete","off");x.on(this.textInput,"blur",function(){z.stop();z.hide()});if(this.config.autoFocus){this.textInput.focus()}var A=0;x.on(this.textInput,"keydown",function(B){var C=B.keyCode;switch(C){case 27:z.hide();z.textInput.value=z.query;break;case 13:z.textInput.blur();if(z._onKeyboardSelecting){if(z.textInput.value==z._getSelectedItemKey()){z.fireEvent(s,z.textInput.value)}}z._submitForm();break;case 40:case 38:if(A++==0){if(z._isRunning){z.stop()}z._onKeyboardSelecting=true;z.selectItem(C==40)}else{if(A==3){A=0}}break}if(C!=40&&C!=38){if(!z._isRunning){z.start()}z._onKeyboardSelecting=false}});x.on(this.textInput,"keyup",function(){A=0})},_initContainer:function(){var z=y.createElement("div"),A=this.config.containerClass;z.className=b;if(A){z.className+=" "+A}z.style.position="absolute";z.style.visibility="hidden";this.container=z;this._setContainerRegion();this._initContainerEvent();y.body.insertBefore(z,y.body.firstChild)},_setContainerRegion:function(){var B=d.getRegion(this.textInput);var C=B.left,z=B.right-C-2;z=z>0?z:0;var A=y.documentMode;if(A===7&&(q===7||q===8)){C-=2}else{if(YAHOO.env.ua.gecko){C++}}this.container.style.left=C+"px";this.container.style.top=B.bottom+"px";if(this.config.containerWidth=="auto"){this.container.style.width=z+"px"}else{this.container.style.width=this.config.containerWidth}},_initContainerEvent:function(){var z=this;x.on(this.container,"mousemove",function(B){var C=x.getTarget(B);if(C.nodeName!="LI"){C=d.getAncestorByTagName(C,"li")}if(d.isAncestor(z.container,C)){if(C!=z.selectedItem){z._removeSelectedItem();z._setSelectedItem(C)}}});var A=null;this.container.onmousedown=function(B){B=B||f.event;A=B.target||B.srcElement;z.textInput.onbeforedeactivate=function(){f.event.returnValue=false;z.textInput.onbeforedeactivate=null};return false};x.on(this.container,"mouseup",function(B){if(!z._isInContainer(x.getXY(B))){return}var C=x.getTarget(B);if(C!=A){return}if(C.className==u){z.hide();return}if(C.nodeName!="LI"){C=d.getAncestorByTagName(C,"li")}if(d.isAncestor(z.container,C)){z._updateInputFromSelectItem(C);z.fireEvent(s,z.textInput.value);z.textInput.blur();z._submitForm()}})},_submitForm:function(){if(this.config.submitFormOnClickSelect){var A=this.textInput.form;if(!A){return}if(y.createEvent){var z=y.createEvent("MouseEvents");z.initEvent("submit",true,false);A.dispatchEvent(z)}else{if(y.createEventObject){A.fireEvent("onsubmit")}}A.submit()}},_isInContainer:function(A){var z=d.getRegion(this.container);return A[0]>=z.left&&A[0]<=z.right&&A[1]>=z.top&&A[1]<=z.bottom},_initShim:function(){var z=y.createElement("iframe");z.src="about:blank";z.className=t;z.style.position="absolute";z.style.visibility="hidden";z.style.border="none";this.container.shim=z;this._setShimRegion();y.body.insertBefore(z,y.body.firstChild)},_setShimRegion:function(){var z=this.container,A=z.shim;if(A){A.style.left=(parseInt(z.style.left)-2)+"px";A.style.top=z.style.top;A.style.width=(parseInt(z.style.width)+2)+"px"}},_initStyle:function(){var A=d.get(m);if(A){return}var z=".suggest-container{background:white;border:1px solid #999;z-index:99999}.suggest-shim{z-index:99998}.suggest-container li{color:#404040;padding:1px 0 2px;font-size:12px;line-height:18px;float:left;width:100%}.suggest-container li.selected{background-color:#39F;cursor:default}.suggest-key{float:left;text-align:left;padding-left:5px}.suggest-result{float:right;text-align:right;padding-right:5px;color:green}.suggest-container li.selected span{color:#FFF;cursor:default}.suggest-bottom{padding:0 5px 5px}.suggest-close-btn{float:right}.suggest-container li,.suggest-bottom{overflow:hidden;zoom:1;clear:both}.suggest-container{*margin-left:2px;_margin-left:-2px;_margin-top:-3px}";A=y.createElement("style");A.id=m;A.type="text/css";i.appendChild(A);if(A.styleSheet){A.styleSheet.cssText=z}else{A.appendChild(y.createTextNode(z))}},_initResizeEvent:function(){var A=this,z;x.on(f,"resize",function(){if(z){clearTimeout(z)}z=setTimeout(function(){A._setContainerRegion();A._setShimRegion()},50)})},start:function(){n.focusInstance=this;var z=this;z._timer=setTimeout(function(){z.updateContent();z._timer=setTimeout(arguments.callee,z.config.timerDelay)},z.config.timerDelay);this._isRunning=true},stop:function(){n.focusInstance=null;clearTimeout(this._timer);this._isRunning=false},show:function(){if(this.isVisible()){return}var z=this.container,B=z.shim;z.style.visibility="";if(B){if(!B.style.height){var A=d.getRegion(z);B.style.height=(A.bottom-A.top-2)+"px"}B.style.visibility=""}},hide:function(){if(!this.isVisible()){return}var z=this.container,A=z.shim;if(A){A.style.visibility="hidden"}z.style.visibility="hidden"},isVisible:function(){return this.container.style.visibility!="hidden"},updateContent:function(){if(!this._needUpdate()){return}this._updateQueryValueFromInput();var z=this.query;if(!g.trim(z).length){this._fillContainer("");this.hide();return}if(typeof this._dataCache[z]!="undefined"){this.returnedData="using cache";this._fillContainer(this._dataCache[z]);this._displayContainer()}else{if(this.JSONDataSource){this.handleResponse(this.JSONDataSource[z])}else{this.requestData()}}},_needUpdate:function(){return this.textInput.value!=this.query},requestData:function(){if(!q){this.dataScript=null}if(!this.dataScript){var z=y.createElement("script");z.type="text/javascript";z.charset="utf-8";i.insertBefore(z,i.firstChild);this.dataScript=z;if(!q){var A=new Date().getTime();this._latestScriptTime=A;z.setAttribute("time",A);x.on(z,"load",function(){this._scriptDataIsOut=z.getAttribute("time")!=this._latestScriptTime},this,true)}}this.queryParams="q="+encodeURIComponent(this.query)+"&code=utf-8&callback="+r;this.fireEvent(l,this.query);this.dataScript.src=this.dataSource+"?"+this.queryParams},handleResponse:function(F){if(this._scriptDataIsOut){return}this.returnedData=F;this.fireEvent(k,F);this.returnedData=this.formatData(this.returnedData);var D="";var B=this.returnedData.length;if(B>0){var E=y.createElement("ol");for(var C=0;C<B;++C){var A=this.returnedData[C];var z=this.formatItem(A.key,A.result);z.setAttribute("key",A.key);E.appendChild(z)}D=E}this._fillContainer(D);if(B>0){this.appendBottom()}if(g.trim(this.container.innerHTML)){this.fireEvent(h,this.container)}this._dataCache[this.query]=this.container.innerHTML;this._displayContainer()},formatData:function(D){var A=[];if(!D){return A}if(g.isArray(D.result)){D=D.result}var z=D.length;if(!z){return A}var C;for(var B=0;B<z;++B){C=D[B];if(g.isString(C)){A[B]={key:C}}else{if(g.isArray(C)&&C.length>=2){A[B]={key:C[0],result:C[1]}}else{A[B]=C}}}return A},formatItem:function(B,A){var z=y.createElement("li");var D=y.createElement("span");D.className=w;D.appendChild(y.createTextNode(B));z.appendChild(D);if(typeof A!="undefined"){var C=this.config.resultFormat.replace("%result%",A);if(g.trim(C)){var E=y.createElement("span");E.className=c;E.appendChild(y.createTextNode(C));z.appendChild(E)}}return z},appendBottom:function(){var z=y.createElement("div");z.className=v;if(this.config.showCloseBtn){var A=y.createElement("a");A.href="javascript: void(0)";A.setAttribute("target","_self");A.className=u;A.appendChild(y.createTextNode(this.config.closeBtnText));z.appendChild(A)}if(g.trim(z.innerHTML)){this.container.appendChild(z)}},_fillContainer:function(z){if(z.nodeType==1){this.container.innerHTML="";this.container.appendChild(z)}else{this.container.innerHTML=z}this.selectedItem=null},_displayContainer:function(){if(g.trim(this.container.innerHTML)){this.show()}else{this.hide()}},selectItem:function(B){var A=this.container.getElementsByTagName("li");if(A.length==0){return}if(!this.isVisible()){this.show();return}var z;if(!this.selectedItem){z=A[B?0:A.length-1]}else{z=d[B?"getNextSibling":"getPreviousSibling"](this.selectedItem);if(!z){this.textInput.value=this.query}}this._removeSelectedItem();if(z){this._setSelectedItem(z);this._updateInputFromSelectItem()}},_removeSelectedItem:function(){d.removeClass(this.selectedItem,p);this.selectedItem=null},_setSelectedItem:function(z){d.addClass((z),p);this.selectedItem=(z)},_getSelectedItemKey:function(){if(!this.selectedItem){return""}return this.selectedItem.getAttribute("key")},_updateQueryValueFromInput:function(){this.query=this.textInput.value},_updateInputFromSelectItem:function(){this.textInput.value=this._getSelectedItemKey(this.selectedItem)}});a.augment(n,e.EventProvider);f[r]=function(z){if(!n.focusInstance){return}setTimeout(function(){n.focusInstance.handleResponse(z)},0)};return n})()});
