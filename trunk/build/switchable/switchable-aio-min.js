/*
Copyright 2010, KISSY UI Library v0.9dev
MIT Licensed
build: 444 Jan 23 23:34
*/
KISSY.add("switchable",function(g){function i(){}var o=YAHOO.util,n=o.Dom,h=o.Event,d=YAHOO.lang;i.Config={mackupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"active",steps:1,viewSize:[]};g.Widget.prototype.switchable=function(a){var b=this;a=a||{};if(!("mackupType"in a))if(a.panelCls)a.mackupType=1;else if(a.panels)a.mackupType=
2;b.config.switchable=g.merge(i.Config,a||{});b.triggers=b.triggers||[];b.panels=b.panels||[];if(typeof b.activeIndex==="undefined")b.activeIndex=b.config.switchable.activeIndex;g.mix(b,i.prototype,false);b._initSwitchable();return b};g.mix(i.prototype,{_initSwitchable:function(){var a=this,b=a.config.switchable;a.panels.length===0&&a._parseSwitchableMackup();a.createEvent("beforeSwitch");a.createEvent("onSwitch");b.hasTriggers&&a._bindTriggers()},_parseSwitchableMackup:function(){var a=this,b=a.container,
c=a.config.switchable,e=c.hasTriggers,f,k=[],l=[],q=n.getElementsByClassName;switch(c.mackupType){case 0:if(f=q(c.navCls,"*",b)[0])k=n.getChildren(f);f=q(c.contentCls,"*",b)[0];l=n.getChildren(f);break;case 1:k=q(c.triggerCls,"*",b);l=q(c.panelCls,"*",b);break;case 2:k=c.triggers;l=c.panels;break}b=l.length;a.length=b/c.steps;if(e&&b>0&&k.length===0)k=a._generateTriggersMackup(a.length);if(e){c=0;for(e=k.length;c<e;c++)a.triggers.push(k[c])}for(c=0;c<b;c++)a.panels.push(l[c]);a.content=f||l[0].parentNode},
_generateTriggersMackup:function(a){var b=this,c=b.config.switchable,e=document.createElement("UL"),f,k;e.className=c.navCls;for(k=0;k<a;k++){f=document.createElement("LI");if(k===b.activeIndex)f.className=c.activeTriggerCls;f.innerHTML=k+1;e.appendChild(f)}b.container.appendChild(e);return n.getChildren(e)},_bindTriggers:function(){var a=this,b=a.config.switchable,c=a.triggers,e,f,k=c.length;for(f=0;f<k;f++)(function(l){e=c[l];h.on(e,"click",function(){a._onFocusTrigger(l)});h.on(e,"focus",function(){a._onFocusTrigger(l)});
if(b.triggerType==="mouse"){h.on(e,"mouseenter",function(){a._onMouseEnterTrigger(l)});h.on(e,"mouseleave",function(){a._onMouseLeaveTrigger(l)})}})(f)},_onFocusTrigger:function(a){var b=this;if(b.activeIndex!==a){b.switchTimer&&b.switchTimer.cancel();b.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b.activeIndex!==a)b.switchTimer=d.later(b.config.switchable.delay*1E3,b,function(){b.switchTo(a)})},_onMouseLeaveTrigger:function(){var a=this;a.switchTimer&&a.switchTimer.cancel()},switchTo:function(a,
b){var c=this,e=c.config.switchable,f=c.triggers,k=c.panels,l=c.activeIndex,q=e.steps,r=l*q,j=a*q;if(a===l)return c;if(!c.fireEvent("beforeSwitch",a))return c;if(e.hasTriggers)c._switchTrigger(l>-1?f[l]:null,f[a]);if(typeof b==="undefined")b=a>l?"forward":"forward";c._switchView(k.slice(r,r+q),k.slice(j,j+q),a,b);c.activeIndex=a;return c},_switchTrigger:function(a,b){var c=this.config.switchable.activeTriggerCls;a&&n.removeClass(a,c);n.addClass(b,c)},_switchView:function(a,b,c){n.setStyle(a,"display",
"none");n.setStyle(b,"display","block");this.fireEvent("onSwitch",c)},prev:function(){var a=this,b=a.activeIndex;a.switchTo(b>0?b-1:a.length-1,"backward")},next:function(){var a=this,b=a.activeIndex;a.switchTo(b<a.length-1?b+1:0,"forward")}});g.augment(i,o.EventProvider);g.Switchable=i});
KISSY.add("switchable-autoplay",function(g){var i=YAHOO.util.Event,o=YAHOO.lang,n=g.Switchable;g.mix(n.Config,{autoplay:false,interval:5,pauseOnHover:true});g.weave(function(){var h=this,d=h.config.switchable;if(d.autoplay){if(d.pauseOnHover){i.on(h.container,"mouseenter",function(){h.paused=true});i.on(h.container,"mouseleave",function(){setTimeout(function(){h.paused=false},d.interval*1E3)})}h.autoplayTimer=o.later(d.interval*1E3,h,function(){h.paused||h.switchTo(h.activeIndex<h.length-1?h.activeIndex+
1:0)},null,true)}},"after",n.prototype,"_initSwitchable")});
KISSY.add("switchable-effect",function(g){var i=YAHOO.util,o=i.Dom,n=g.Switchable,h;g.mix(n.Config,{effect:"none",duration:0.5,easing:i.Easing.easeNone});n.Effects={none:function(d,a,b){o.setStyle(d,"display","none");o.setStyle(a,"display","block");b()},fade:function(d,a,b){if(d.length!==1)throw new Error("fade effect only supports steps == 1.");var c=this,e=c.config.switchable,f=d[0],k=a[0];c.anim&&c.anim.stop();o.setStyle(k,"opacity",1);c.anim=new i.Anim(f,{opacity:{to:0}},e.duration,e.easing);
c.anim.onComplete.subscribe(function(){c.anim=null;o.setStyle(k,"z-index",9);o.setStyle(f,"z-index",1);b()});c.anim.animate()},scroll:function(d,a,b,c){var e=this;d=e.config.switchable;a=d.effect==="scrollx";var f={};f[a?"left":"top"]={to:-(e.viewSize[a?0:1]*c)};e.anim&&e.anim.stop();e.anim=new i.Anim(e.content,f,d.duration,d.easing);e.anim.onComplete.subscribe(function(){e.anim=null;b()});e.anim.animate()}};h=n.Effects;h.scrollx=h.scrolly=h.scroll;g.weave(function(){var d=this,a=d.config.switchable,
b=a.effect,c=d.panels,e=a.steps,f=d.activeIndex*e,k=f+e-1,l=c.length;d.viewSize=[a.viewSize[0]||c[0].offsetWidth*e,a.viewSize[0]||c[0].offsetHeight*e];if(b!=="none"){for(a=0;a<l;a++)c[a].style.display="block";switch(b){case "scrollx":case "scrolly":d.content.style.position="absolute";d.content.parentNode.style.position="relative";if(b==="scrollx"){o.setStyle(c,"float","left");this.content.style.width=d.viewSize[0]*(l/e)+"px"}break;case "fade":for(a=0;a<l;a++){o.setStyle(c[a],"opacity",a>=f&&a<=k?
1:0);c[a].style.position="absolute";c[a].style.zIndex=a>=f&&a<=k?9:1}break}}},"after",n.prototype,"_initSwitchable");g.mix(n.prototype,{_switchView:function(d,a,b,c){var e=this,f=e.config.switchable.effect;(typeof f==="function"?f:h[f]).call(e,d,a,function(){e.fireEvent("onSwitch",b)},b,c)}})});
KISSY.add("switchable-circular",function(g){function i(j,p,u,s,v){var m=this;j=m.config[d];p=m.length;var w=m.activeIndex,t=j.scrollType===q,x=t?b:c,y=m.viewSize[t?0:1];t=-y*s;var A={},B,z=v===l;if(B=z&&w===0&&s===p-1||v===k&&w===p-1&&s===0)t=o.call(m,m.panels,s,z,x,y);A[x]={to:t};m.anim&&m.anim.stop();m.anim=new h.Anim(m.content,A,j.duration,j.easing);m.anim.onComplete.subscribe(function(){B&&n.call(m,m.panels,s,z,x,y);m.anim=null;u()});m.anim.animate()}function o(j,p,u,s,v){var m=this;p=m.config[d].steps;
m=m.length;var w=u?m-1:0,t=(w+1)*p;for(p=w*p;p<t;p++){j[p].style.position=a;j[p].style[s]=(u?"-":f)+v*m+e}return u?v:-v*m}function n(j,p,u,s,v){p=this;var m=p.config[d].steps,w=p.length,t=u?w-1:0,x=(t+1)*m;for(m=t*m;m<x;m++){j[m].style.position=f;j[m].style[s]=f}p.content.style[s]=u?-v*(w-1)+e:f}var h=YAHOO.util,d="switchable",a="relative",b="left",c="top",e="px",f="",k="forward",l="backward",q="scrollx",r=g.Switchable;g.mix(r.Config,{circular:false});g.weave(function(){var j=this.config[d];if(j.circular&&
(j.effect===q||j.effect==="scrolly")){j.scrollType=j.effect;j.effect=i}},"after",r.prototype,"_initSwitchable")});
KISSY.add("switchable-lazyload",function(g){var i=YAHOO.util.Dom,o="beforeSwitch",n="img-src",h="textarea-data",d={},a=g.Switchable,b=g.DataLazyload;d[n]="data-lazyload-src-custom";d[h]="ks-datalazyload-custom";g.mix(a.Config,{lazyDataType:"",lazyDataFlag:""});g.weave(function(){function c(r){var j=k.steps;r=r*j;b.loadCustomLazyData(f.panels.slice(r,r+j),l,q);e()&&f.unsubscribe(o,c)}function e(){var r,j,p;if(l===n){r=f.container.getElementsByTagName("img");j=0;for(p=r.length;j<p;j++)if(r[j].getAttribute(q))return false}else if(l===
h){r=f.container.getElementsByTagName("textarea");j=0;for(p=r.length;j<p;j++)if(i.hasClass(r[j],q))return false}return true}var f=this,k=f.config.switchable,l=k.lazyDataType,q=k.lazyDataFlag||d[l];!b||!l||!q||f.subscribe(o,c)},"after",a.prototype,"_initSwitchable")});
KISSY.add("tabs",function(g){function i(n,h){var d=this;if(!(d instanceof i))return new i(n,h);i.superclass.constructor.call(d,n,h);d.switchable(d.config);d.config=d.config[o];d.config[o]=d.config}var o="switchable";g.extend(i,g.Widget);g.Tabs=i});
KISSY.add("slide",function(g){function i(h,d){var a=this;if(!(a instanceof i))return new i(h,d);d=g.merge(n,d||{});i.superclass.constructor.call(a,h,d);a.switchable(a.config);a.config=a.config[o];a.config[o]=a.config}var o="switchable",n={autoplay:true,circular:true};g.extend(i,g.Widget);g.Slide=i});
KISSY.add("carousel",function(g){function i(h,d){var a=this;if(!(a instanceof i))return new i(h,d);d=g.merge(n,d||{});i.superclass.constructor.call(a,h,d);a.switchable(a.config);a.config=a.config[o];a.config[o]=a.config}var o="switchable",n={circular:true};g.extend(i,g.Widget);g.Carousel=i});
