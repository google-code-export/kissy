/*
Copyright 2010, KISSY UI Library v1.0.5
MIT Licensed
build: 542 Apr 8 23:11
*/
KISSY.add("switchable",function(d,k){function o(a,b){b=b||{};if(!("markupType"in b))if(b.panelCls)b.markupType=1;else if(b.panels)b.markupType=2;b=d.merge(o.Config,b);this.container=d.get(a);this.config=b;this.triggers=this.triggers||[];this.panels=this.panels||[];if(this.activeIndex===k)this.activeIndex=b.activeIndex;this._init()}var f=d.DOM,n=d.Event,r=document,c=o.prototype;o.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",
triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"active",steps:1,viewSize:[]};o.Plugins=[];d.mix(c,{_init:function(){var a=this,b=a.config;a.panels.length===0&&a._parseMarkup();b.hasTriggers&&a._bindTriggers();d.each(o.Plugins,function(e){e.init&&e.init(a)})},_parseMarkup:function(){var a=this.container,b=this.config,e=b.hasTriggers,g,i=[],j=[];switch(b.markupType){case 0:if(g=d.get("."+b.navCls,a))i=f.children(g);g=d.get("."+b.contentCls,a);j=f.children(g);
break;case 1:i=d.query("."+b.triggerCls,a);j=d.query("."+b.panelCls,a);break;case 2:i=b.triggers;j=b.panels;break}a=j.length;this.length=a/b.steps;if(e&&a>0&&i.length===0)i=this._generateTriggersMarkup(this.length);this.triggers=d.makeArray(i);this.panels=d.makeArray(j);this.content=g||j[0].parentNode},_generateTriggersMarkup:function(a){var b=this.config,e=r.createElement("UL"),g,i;e.className=b.navCls;for(i=0;i<a;i++){g=r.createElement("LI");if(i===this.activeIndex)g.className=b.activeTriggerCls;
g.innerHTML=i+1;e.appendChild(g)}this.container.appendChild(e);return f.children(e)},_bindTriggers:function(){var a=this,b=a.config,e=a.triggers,g,i,j=e.length;for(i=0;i<j;i++)(function(h){g=e[h];n.on(g,"click focus",function(){a._onFocusTrigger(h)});if(b.triggerType==="mouse"){n.on(g,"mouseenter",function(){a._onMouseEnterTrigger(h)});n.on(g,"mouseleave",function(){a._onMouseLeaveTrigger(h)})}})(i)},_onFocusTrigger:function(a){if(this.activeIndex!==a){this.switchTimer&&this.switchTimer.cancel();
this.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b.activeIndex!==a)b.switchTimer=d.later(function(){b.switchTo(a)},b.config.delay*1E3)},_onMouseLeaveTrigger:function(){this.switchTimer&&this.switchTimer.cancel()},switchTo:function(a,b){var e=this.config,g=this.triggers,i=this.panels,j=this.activeIndex,h=e.steps,m=j*h,p=a*h;if(a===j)return this;if(this.fire("beforeSwitch",{toIndex:a})===false)return this;if(e.hasTriggers)this._switchTrigger(j>-1?g[j]:null,g[a]);if(b===k)b=a>j?"forward":
"forward";this._switchView(i.slice(m,m+h),i.slice(p,p+h),a,b);this.activeIndex=a;return this},_switchTrigger:function(a,b){var e=this.config.activeTriggerCls;a&&f.removeClass(a,e);f.addClass(b,e)},_switchView:function(a,b){f.css(a,"display","none");f.css(b,"display","block");this.fire("switch")},prev:function(){var a=this.activeIndex;this.switchTo(a>0?a-1:this.length-1,"backward")},next:function(){var a=this.activeIndex;this.switchTo(a<this.length-1?a+1:0,"forward")}});d.mix(c,d.EventTarget);d.Switchable=
o});
KISSY.add("switchable-autoplay",function(d){var k=d.Event,o=d.Switchable;d.mix(o.Config,{autoplay:false,interval:5,pauseOnHover:true});o.Plugins.push({name:"autoplay",init:function(f){var n=f.config;if(n.autoplay){if(n.pauseOnHover){k.on(f.container,"mouseenter",function(){f.paused=true});k.on(f.container,"mouseleave",function(){setTimeout(function(){f.paused=false},n.interval*1E3)})}f.autoplayTimer=d.later(function(){f.paused||f.switchTo(f.activeIndex<f.length-1?f.activeIndex+1:0)},n.interval*1E3,
true)}}})});
KISSY.add("switchable-effect",function(d){var k=YAHOO.util,o=d.DOM,f=k.Dom,n=d.Switchable,r;d.mix(n.Config,{effect:"none",duration:0.5,easing:k.Easing.easeNone});n.Effects={none:function(c,a,b){o.css(c,"display","none");o.css(a,"display","block");b()},fade:function(c,a,b){c.length!==1&&d.error("fade effect only supports steps == 1.");var e=this,g=e.config,i=c[0],j=a[0];e.anim&&e.anim.stop();f.setStyle(j,"opacity",1);e.anim=new k.Anim(i,{opacity:{to:0}},g.duration,g.easing);e.anim.onComplete.subscribe(function(){e.anim=null;
f.setStyle(j,"z-index",9);f.setStyle(i,"z-index",1);b()});e.anim.animate()},scroll:function(c,a,b,e){var g=this;c=g.config;a=c.effect==="scrollx";var i={};i[a?"left":"top"]={to:-(g.viewSize[a?0:1]*e)};g.anim&&g.anim.stop();g.anim=new k.Anim(g.content,i,c.duration,c.easing);g.anim.onComplete.subscribe(function(){g.anim=null;b()});g.anim.animate()}};r=n.Effects;r.scrollx=r.scrolly=r.scroll;n.Plugins.push({name:"effect",init:function(c){var a=c.config,b=a.effect,e=c.panels,g=a.steps,i=c.activeIndex*
g,j=i+g-1,h=e.length;c.viewSize=[a.viewSize[0]||e[0].offsetWidth*g,a.viewSize[0]||e[0].offsetHeight*g];if(b!=="none"){for(a=0;a<h;a++)e[a].style.display="block";switch(b){case "scrollx":case "scrolly":c.content.style.position="absolute";c.content.parentNode.style.position="relative";if(b==="scrollx"){f.setStyle(e,"float","left");c.content.style.width=c.viewSize[0]*(h/g)+"px"}break;case "fade":for(a=0;a<h;a++){f.setStyle(e[a],"opacity",a>=i&&a<=j?1:0);e[a].style.position="absolute";e[a].style.zIndex=
a>=i&&a<=j?9:1}break}}}});d.mix(n.prototype,{_switchView:function(c,a,b,e){var g=this,i=g.config.effect;(d.isFunction(i)?i:r[i]).call(g,c,a,function(){g.fire("switch")},b,e)}})});
KISSY.add("switchable-circular",function(d){function k(h,m,p,q,s){var l=this;h=l.config;m=l.length;var t=l.activeIndex,u=h.scrollType===i,v=u?r:c,w=l.viewSize[u?0:1];u=-w*q;var y={},z,x=s===g;if(z=x&&t===0&&q===m-1||s===e&&t===m-1&&q===0)u=o.call(l,l.panels,q,x,v,w);y[v]={to:u};l.anim&&l.anim.stop();l.anim=new YAHOO.util.Anim(l.content,y,h.duration,h.easing);l.anim.onComplete.subscribe(function(){z&&f.call(l,l.panels,q,x,v,w);l.anim=null;p()});l.anim.animate()}function o(h,m,p,q,s){var l=this.config.steps;
m=this.length;var t=p?m-1:0,u=(t+1)*l;for(l=t*l;l<u;l++){h[l].style.position=n;h[l].style[q]=(p?"-":b)+s*m+a}return p?s:-s*m}function f(h,m,p,q,s){var l=this.config.steps;m=this.length;var t=p?m-1:0,u=(t+1)*l;for(l=t*l;l<u;l++){h[l].style.position=b;h[l].style[q]=b}this.content.style[q]=p?-s*(m-1)+a:b}var n="relative",r="left",c="top",a="px",b="",e="forward",g="backward",i="scrollx",j=d.Switchable;d.mix(j.Config,{circular:false});j.Plugins.push({name:"circular",init:function(h){h=h.config;if(h.circular&&
(h.effect===i||h.effect==="scrolly")){h.scrollType=h.effect;h.effect=k}}})});
KISSY.add("switchable-lazyload",function(d){var k=d.DOM,o="beforeSwitch",f="img-src",n="textarea-data",r={},c=d.Switchable,a=d.DataLazyload;r[f]="data-lazyload-src-custom";r[n]="ks-datalazyload-custom";d.mix(c.Config,{lazyDataType:"",lazyDataFlag:""});c.Plugins.push({name:"autoplay",init:function(b){function e(m){var p=i.steps;m=m.toIndex*p;a.loadCustomLazyData(b.panels.slice(m,m+p),j,h);g()&&b.detach(o,e)}function g(){var m,p,q;if(j===f){m=d.query("img",b.container);p=0;for(q=m.length;p<q;p++)if(k.attr(m[p],
h))return false}else if(j===n){m=d.query("textarea",b.container);p=0;for(q=m.length;p<q;p++)if(k.hasClass(m[p],h))return false}return true}var i=b.config,j=i.lazyDataType,h=i.lazyDataFlag||r[j];!a||!j||!h||b.on(o,e)}})});KISSY.add("tabs",function(d){function k(o,f){if(!(this instanceof k))return new k(o,f);k.superclass.constructor.call(this,o,f)}d.extend(k,d.Switchable);d.Tabs=k});
KISSY.add("slide",function(d){function k(f,n){if(!(this instanceof k))return new k(f,n);n=d.merge(o,n||{});k.superclass.constructor.call(this,f,n)}var o={autoplay:true,circular:true};d.extend(k,d.Switchable);d.Slide=k});KISSY.add("carousel",function(d){function k(f,n){if(!(this instanceof k))return new k(f,n);n=d.merge(o,n||{});k.superclass.constructor.call(this,f,n)}var o={circular:true};d.extend(k,d.Switchable);d.Carousel=k});
KISSY.add("coversflow",function(d){function k(c,a){if(!(this instanceof k))return new k(c,a);a=d.merge(r,a||{});k.superclass.constructor.call(this,c,a);this._initFlow()}var o=YAHOO.util.Dom,f=d.DOM,n=d.Event,r={flowLength:4,aspectRatio:1.964,step:150,width:500,height:350,offset:0,animSpeed:50,autoSwitchToMiddle:true,hasTriggers:false,circular:true};d.extend(k,d.Switchable);d.augment(k,{_initFlow:function(){var c=this,a=c.config;c.busy=false;c.curFrame=0;c.targetFrame=0;c.zIndex=c.length;c.region=
o.getRegion(c.container);c.maxFocus=a.flowLength*a.step;c.maxHeight=c.region.height+Math.round(c.region.height/a.aspectRatio);c.middleLine=c.region.width/2;c.triggers=c.panels;c.on("beforeSwitch",function(b){b=b.toIndex;c.perIndex=b;c.targetFrame=-b*c.config.step;return!c.busy});a.autoSwitchToMiddle?c.switchTo(Math.floor(c.length/2)):c._frame(0)},_switchView:function(){var c=this.config;if(this.targetFrame<this.curFrame-1||this.targetFrame>this.curFrame+1){this._frame(this.curFrame+(this.targetFrame-
this.curFrame)/3);this._timer=d.later(this._switchView,c.animSpeed,false,this);this.busy=true}else{this.fire("finished");this.busy=false}},_frame:function(c){var a=this,b=a.config,e=a.panels,g=a.region,i=a.middleLine-b.offset,j,h;a.curFrame=c;var m=0;for(e=e.length;m<e;m++){j=a.panels[m];h=m*-b.step;if(h+a.maxFocus<a.targetFrame||h-a.maxFocus>a.targetFrame)f.css(j,"visibility","hidden");else{h=Math.sqrt(1E4+c*c)+100;var p=c/h*i+i,q=b.width/b.height*90/h*i,s=0;if(q>a.maxHeight)q=a.maxHeight;s=b.width/
b.height*q;f.css(j,"left",p-72/h*i+"px");if(q&&s){f.css(j,"height",q+"px");f.css(j,"width",s+"px");f.css(j,"top",g.height/2-q/2+"px")}f.css(j,"zIndex",a.zIndex*100-Math.ceil(h));f.css(j,"visibility","visible");(function(l){n.remove(j);a.perIndex===l?n.add(j,"click",function(){return a.fire("onCurrent",{panel:j,index:l})}):n.add(j,"click",function(t){t.preventDefault();a.switchTo(l)})})(m)}a.fire("tween",{panel:j,index:m});c+=b.step}}});d.CoversFlow=k});
