/*
Copyright 2010, KISSY UI Library v1.0.4
MIT Licensed
build: 480 Mar 11 14:06
*/
KISSY.add("switchable",function(h,i){function l(a,b){var c=this;b=b||{};if(!("mackupType"in b))if(b.panelCls)b.mackupType=1;else if(b.panels)b.mackupType=2;b=h.merge(l.Config,b);c.container=h.get(a);c.config=b;c.triggers=c.triggers||[];c.panels=c.panels||[];if(c.activeIndex===i)c.activeIndex=b.activeIndex;c._init()}var p=YAHOO.util,f=p.Dom,g=p.Event,j=YAHOO.lang,d=document;l.Config={mackupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",
triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"active",steps:1,viewSize:[]};l.Plugins=[];h.mix(l.prototype,{_init:function(){var a=this,b=a.config;a.panels.length===0&&a._parseMackup();a.createEvent("beforeSwitch");a.createEvent("onSwitch");b.hasTriggers&&a._bindTriggers();h.each(l.Plugins,function(c){c.init&&c.init(a)})},_parseMackup:function(){var a=this,b=a.container,c=a.config,n=c.hasTriggers,m,q=[],e=[];switch(c.mackupType){case 0:if(m=h.get("."+
c.navCls,b))q=f.getChildren(m);m=h.get("."+c.contentCls,b);e=f.getChildren(m);break;case 1:q=h.query("."+c.triggerCls,b);e=h.query("."+c.panelCls,b);break;case 2:q=c.triggers;e=c.panels;break}b=e.length;a.length=b/c.steps;if(n&&b>0&&q.length===0)q=a._generateTriggersMackup(a.length);if(n){c=0;for(n=q.length;c<n;c++)a.triggers.push(q[c])}for(c=0;c<b;c++)a.panels.push(e[c]);a.content=m||e[0].parentNode},_generateTriggersMackup:function(a){var b=this,c=b.config,n=d.createElement("UL"),m,q;n.className=
c.navCls;for(q=0;q<a;q++){m=d.createElement("LI");if(q===b.activeIndex)m.className=c.activeTriggerCls;m.innerHTML=q+1;n.appendChild(m)}b.container.appendChild(n);return f.getChildren(n)},_bindTriggers:function(){var a=this,b=a.config,c=a.triggers,n,m,q=c.length;for(m=0;m<q;m++)(function(e){n=c[e];g.on(n,"click",function(){a._onFocusTrigger(e)});g.on(n,"focus",function(){a._onFocusTrigger(e)});if(b.triggerType==="mouse"){g.on(n,"mouseenter",function(){a._onMouseEnterTrigger(e)});g.on(n,"mouseleave",
function(){a._onMouseLeaveTrigger(e)})}})(m)},_onFocusTrigger:function(a){var b=this;if(b.activeIndex!==a){b.switchTimer&&b.switchTimer.cancel();b.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b.activeIndex!==a)b.switchTimer=j.later(b.config.delay*1E3,b,function(){b.switchTo(a)})},_onMouseLeaveTrigger:function(){var a=this;a.switchTimer&&a.switchTimer.cancel()},switchTo:function(a,b){var c=this,n=c.config,m=c.triggers,q=c.panels,e=c.activeIndex,k=n.steps,r=e*k,s=a*k;if(a===e)return c;
if(!c.fireEvent("beforeSwitch",a))return c;if(n.hasTriggers)c._switchTrigger(e>-1?m[e]:null,m[a]);if(b===i)b=a>e?"forward":"forward";c._switchView(q.slice(r,r+k),q.slice(s,s+k),a,b);c.activeIndex=a;return c},_switchTrigger:function(a,b){var c=this.config.activeTriggerCls;a&&f.removeClass(a,c);f.addClass(b,c)},_switchView:function(a,b,c){f.setStyle(a,"display","none");f.setStyle(b,"display","block");this.fireEvent("onSwitch",c)},prev:function(){var a=this,b=a.activeIndex;a.switchTo(b>0?b-1:a.length-
1,"backward")},next:function(){var a=this,b=a.activeIndex;a.switchTo(b<a.length-1?b+1:0,"forward")}});h.augment(l,p.EventProvider);h.Switchable=l});
KISSY.add("switchable-autoplay",function(h){var i=YAHOO.util.Event,l=YAHOO.lang,p=h.Switchable;h.mix(p.Config,{autoplay:false,interval:5,pauseOnHover:true});p.Plugins.push({name:"autoplay",init:function(f){var g=f.config;if(g.autoplay){if(g.pauseOnHover){i.on(f.container,"mouseenter",function(){f.paused=true});i.on(f.container,"mouseleave",function(){setTimeout(function(){f.paused=false},g.interval*1E3)})}f.autoplayTimer=l.later(g.interval*1E3,f,function(){f.paused||f.switchTo(f.activeIndex<f.length-
1?f.activeIndex+1:0)},null,true)}}})});
KISSY.add("switchable-effect",function(h){var i=YAHOO.util,l=i.Dom,p=h.Switchable,f;h.mix(p.Config,{effect:"none",duration:0.5,easing:i.Easing.easeNone});p.Effects={none:function(g,j,d){l.setStyle(g,"display","none");l.setStyle(j,"display","block");d()},fade:function(g,j,d){if(g.length!==1)throw new Error("fade effect only supports steps == 1.");var a=this,b=a.config,c=g[0],n=j[0];a.anim&&a.anim.stop();l.setStyle(n,"opacity",1);a.anim=new i.Anim(c,{opacity:{to:0}},b.duration,b.easing);a.anim.onComplete.subscribe(function(){a.anim=
null;l.setStyle(n,"z-index",9);l.setStyle(c,"z-index",1);d()});a.anim.animate()},scroll:function(g,j,d,a){var b=this;g=b.config;j=g.effect==="scrollx";var c={};c[j?"left":"top"]={to:-(b.viewSize[j?0:1]*a)};b.anim&&b.anim.stop();b.anim=new i.Anim(b.content,c,g.duration,g.easing);b.anim.onComplete.subscribe(function(){b.anim=null;d()});b.anim.animate()}};f=p.Effects;f.scrollx=f.scrolly=f.scroll;p.Plugins.push({name:"effect",init:function(g){var j=g.config,d=j.effect,a=g.panels,b=j.steps,c=g.activeIndex*
b,n=c+b-1,m=a.length;g.viewSize=[j.viewSize[0]||a[0].offsetWidth*b,j.viewSize[0]||a[0].offsetHeight*b];if(d!=="none"){for(j=0;j<m;j++)a[j].style.display="block";switch(d){case "scrollx":case "scrolly":g.content.style.position="absolute";g.content.parentNode.style.position="relative";if(d==="scrollx"){l.setStyle(a,"float","left");g.content.style.width=g.viewSize[0]*(m/b)+"px"}break;case "fade":for(j=0;j<m;j++){l.setStyle(a[j],"opacity",j>=c&&j<=n?1:0);a[j].style.position="absolute";a[j].style.zIndex=
j>=c&&j<=n?9:1}break}}}});h.mix(p.prototype,{_switchView:function(g,j,d,a){var b=this,c=b.config.effect;(typeof c==="function"?c:f[c]).call(b,g,j,function(){b.fireEvent("onSwitch",d)},d,a)}})});
KISSY.add("switchable-circular",function(h){function i(e,k,r,s,u){var o=this;e=o.config;k=o.length;var v=o.activeIndex,t=e.scrollType===m,w=t?j:d,x=o.viewSize[t?0:1];t=-x*s;var z={},A,y=u===n;if(A=y&&v===0&&s===k-1||u===c&&v===k-1&&s===0)t=l.call(o,o.panels,s,y,w,x);z[w]={to:t};o.anim&&o.anim.stop();o.anim=new f.Anim(o.content,z,e.duration,e.easing);o.anim.onComplete.subscribe(function(){A&&p.call(o,o.panels,s,y,w,x);o.anim=null;r()});o.anim.animate()}function l(e,k,r,s,u){var o=this;k=o.config.steps;
o=o.length;var v=r?o-1:0,t=(v+1)*k;for(k=v*k;k<t;k++){e[k].style.position=g;e[k].style[s]=(r?"-":b)+u*o+a}return r?u:-u*o}function p(e,k,r,s,u){k=this;var o=k.config.steps,v=k.length,t=r?v-1:0,w=(t+1)*o;for(o=t*o;o<w;o++){e[o].style.position=b;e[o].style[s]=b}k.content.style[s]=r?-u*(v-1)+a:b}var f=YAHOO.util,g="relative",j="left",d="top",a="px",b="",c="forward",n="backward",m="scrollx",q=h.Switchable;h.mix(q.Config,{circular:false});q.Plugins.push({name:"circular",init:function(e){e=e.config;if(e.circular&&
(e.effect===m||e.effect==="scrolly")){e.scrollType=e.effect;e.effect=i}}})});
KISSY.add("switchable-lazyload",function(h){var i=YAHOO.util.Dom,l="beforeSwitch",p="img-src",f="textarea-data",g={},j=h.Switchable,d=h.DataLazyload;g[p]="data-lazyload-src-custom";g[f]="ks-datalazyload-custom";h.mix(j.Config,{lazyDataType:"",lazyDataFlag:""});j.Plugins.push({name:"autoplay",init:function(a){function b(e){var k=n.steps;e=e*k;d.loadCustomLazyData(a.panels.slice(e,e+k),m,q);c()&&a.unsubscribe(l,b)}function c(){var e,k,r;if(m===p){e=a.container.getElementsByTagName("img");k=0;for(r=
e.length;k<r;k++)if(e[k].getAttribute(q))return false}else if(m===f){e=a.container.getElementsByTagName("textarea");k=0;for(r=e.length;k<r;k++)if(i.hasClass(e[k],q))return false}return true}var n=a.config,m=n.lazyDataType,q=n.lazyDataFlag||g[m];!d||!m||!q||a.subscribe(l,b)}})});KISSY.add("tabs",function(h){function i(l,p){var f=this;if(!(f instanceof i))return new i(l,p);i.superclass.constructor.call(f,l,p)}h.extend(i,h.Switchable);h.Tabs=i});
KISSY.add("slide",function(h){function i(p,f){var g=this;if(!(g instanceof i))return new i(p,f);f=h.merge(l,f||{});i.superclass.constructor.call(g,p,f)}var l={autoplay:true,circular:true};h.extend(i,h.Switchable);h.Slide=i});KISSY.add("carousel",function(h){function i(p,f){var g=this;if(!(g instanceof i))return new i(p,f);f=h.merge(l,f||{});i.superclass.constructor.call(g,p,f)}var l={circular:true};h.extend(i,h.Switchable);h.Carousel=i});
KISSY.add("megamenu",function(h){function i(d,a){var b=this;if(!(b instanceof i))return new i(d,a);a=h.merge(j,a||{});i.superclass.constructor.call(b,d,a);b._initView();b.config.showCloseBtn&&b._initCloseBtn()}var l=YAHOO.util,p=l.Dom,f=l.Event,g=YAHOO.lang,j={hideDelay:0.5,viewCls:"ks-megamenu-view",closeBtnCls:"ks-megamenu-closebtn",showCloseBtn:true,activeIndex:-1};h.extend(i,h.Switchable);h.mix(i.prototype,{_onFocusTrigger:function(d){var a=this;if(a.activeIndex!==d){a.switchTimer&&a.switchTimer.cancel();
a.hideTimer&&a.hideTimer.cancel();a.switchTo(d)}},_onMouseEnterTrigger:function(d){var a=this;a.hideTimer&&a.hideTimer.cancel();a.switchTimer=g.later(a.config.delay*1E3,a,function(){a.switchTo(d)})},_onMouseLeaveTrigger:function(){var d=this;d.switchTimer&&d.switchTimer.cancel();d.hideTimer=g.later(d.config.hideDelay*1E3,d,function(){d.hide()})},_initView:function(){var d=this,a=d.config,b=p.getElementsByClassName(a.viewCls,"*",d.container)[0];if(!b){b=document.createElement("DIV");b.className=a.viewCls;
d.container.appendChild(b)}f.on(b,"mouseenter",function(){d.hideTimer&&d.hideTimer.cancel()});f.on(b,"mouseleave",function(){d.hideTimer=g.later(a.hideDelay*1E3,d,"hide")});d.viewContent=b;d.view=b},_initCloseBtn:function(){var d=this,a,b=d.view;b.innerHTML="<span class='{hook_cls}'></span>".replace("{hook_cls}",d.config.closeBtnCls);f.on(b.firstChild,"click",function(){d.hide()});a=document.createElement("div");b.appendChild(a);d.viewContent=a},_switchView:function(d,a,b){d=this;d.view.style.display=
"block";d.viewContent.innerHTML=a[0].innerHTML;d.fireEvent("onSwitch",b)},hide:function(){var d=this;p.removeClass(d.triggers[d.activeIndex],d.config.activeTriggerCls);d.view.style.display="none";d.activeIndex=-1}});h.MegaMenu=i});
